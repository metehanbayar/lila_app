Gizli / Kişisel Veri
1
VAKIFBANK SANAL POS ENTEGRASYON KILAVUZU
Bu doküman T.VAKIFLAR BANKASI T.A.O. tarafından hazırlanmış olup, bütün tasarım
ve çoğaltma hakları T.VAKIFLAR BANKASI T.A.O.’ ya aittir. Dokümanın bütünü ya da
herhangi bir kısmı, T.VAKIFLAR BANKASI T.A.O.’nun yazılı izni olmaksızın,
çoğaltılamaz ve kaynak gösterilemez.
Gizli / Kişisel Veri
2
DOKÜMAN TARİHÇESİ
Versiyon Açıklama Tarih
1.0 VakıfBank VPOS 7/24 Entegrasyon Dokümanı
Hazırlandı.
25.08.2015
1.2 Referanslı İşlemler, Sorgulama İşlemleri ve Mutabakat
Sorguları eklenmiştir. 01.09.2015
1.3 Tekrarlı Tahsilat Sistemi ve Üye İşyeri Yardımcı Servisleri
ile Üye İşyeri Entegrasyon İpuçları eklendi. 19.10.2015
1.4 ECI değerleri detaylandırıldı. 16.12.2015
1.5
MasterCard için “A” status cevabı ile işleme half secure
devam edilmesi durumunda provizyon mesajına CAVV
datasının gönderilmesi bilgisi eklenmiştir.
Kart Aktiflik Sorgusu İşlem tipi eklenmiştir.
09.05.2016
1.6
• Erişim adreslerine Port bilgileri eklenmiştir.
• Troy Kartlar için Brand Name eklenmiştir.
• Amex kart Brand Name değeri güncellenmiştir.
• Puan harcama, VFT satış ve Ön provizyon örnekleri
eklenmiştir.
• Sanal POS XML cevap tablosuna “TLAmount” bilgisi
eklenmiştir.
• “SurchargeAmount” formatı güncellenmiştir.
• Tarım Kart işlem tipleri eklenmiştir.
08.02.2017
1.7
• Enrollment istek mesajına eklenen bayi ve alt bayi
tipleri
• Sanal POS mesajına eklenen bayi alt bayi
(SubMerchant) tipleri
• ECI düzenlemeleri
• TROY kart ECI değerleri eklenmiştir.
06.04.2017
1.8 • PF/Alt Bayi XML örnekler eklenmiştir. 11.04.2017
1.9 • Veres N durumu detaylandırılmıştır. 26.03.2018
2.0 • Dokümanların içeriği güncellendi 16.07.2019
2.1 • PF-Bayi yapısıyla Ödeme alan işyerleri için Identity
bilgisiyle Ödeme alma metodu eklendi 15.06.2020
2.2 • Dokümanların içeriği güncellendi. 01.04.2021
2.3 • Dokümanların içeriği güncellendi. 27.04.2022
2.4 • TAVV parametre gönderimi güncellendi. 06.10.2023
2.5 • Hash hesaplama ve md status bilgileri ilave edildi. 18.12.2024
Gizli / Kişisel Veri
3
İçindekiler
DOKÜMAN TARİHÇESİ ...............................................................................................................................................2
1. GENEL AÇIKLAMA ..............................................................................................................................................8
2. TANIMLAR............................................................................................................................................................10
3. ERİŞİM ADRESLERİ...........................................................................................................................................11
4. 3D SECURE (MPI) VE SANAL POS İŞLEM AKIŞI......................................................................................12
5. ÜİY UYGULAMASINDA YAPILACAK GELİŞTİRMELER...........................................................................13
5.1. KİMLİK DOĞRULAMA İŞLEM AKIŞI ( Enrollment Aşaması)...........................................................15
5.1.1. Enrollment Kontrol İsteği (Kart, 3D Secure Programına dahil mi?)......................................16
5.1.2. Enrollment (Kart Kayıt) Kontrol Cevabı........................................................................................19
5.1.2.1. Enrollment Kontrol Cevabı (Başarılı) .............................................................................................20
5.1.2.2. Enrollment Kontrol Cevabı: “N”(Kart Kayıtlı Değil).......................................................................21
5.1.2.3. Enrollment Kontrol Cevabı (Hata Durumu) ...................................................................................22
5.2. PARes Aşaması (Kimlik Doğrulama Aşaması)................................................................................................23
5.2.1. PAReq Mesajının ACS’ye Gönderilmesi .................................................................................................23
5.2.2. Kimlik Doğrulama İşlem Sonucunun Alınması.......................................................................................24
5.2.2.1. ÜİY İşlem Sonuç URL’i.....................................................................................................................25
5.2.2.2. Kimlik Doğrulama İşlem Sonuçlarının Yorumlanması ...................................................................26
5.3 HASH HESAPLAMA...................................................................................................................................28
5.4 SANAL POS PROVİZYON AŞAMASI .....................................................................................................29
5.4.1 Peşin / Taksitli Satış İşlemi (Sale)...........................................................................................................37
5.4.1.1 3D Secure (Full Secure) İşlem.........................................................................................................37
5.4.1.2 Yarım 3D Secure (Half Secure) İşlem..............................................................................................38
5.4.1.3 Normal İşlem - Non Secure Örnek XML Provizyon İstek Mesajı ...................................................39
5.4.2 Vade Farklı Taksitli Satış İşlemi ..............................................................................................................40
5.4.2.1 VFT Satış Örnek XML İstek Mesajı..................................................................................................40
5.4.2.2 VFT Satış Örnek XML Cevap Mesajı ...............................................................................................41
5.4.3 Puan Harcama İşlemi..............................................................................................................................41
5.4.3.1 Puan Harcama Örnek XML İstek Mesajı ........................................................................................41
5.4.3.2 Puan Harcama Örnek XML Cevap Mesajı ......................................................................................42
5.4.4 Ön Provizyon İşlemi................................................................................................................................42
5.4.4.1 Ön Provizyon Örnek XML İstek Mesajı ..........................................................................................42
5.4.4.2 Ön Provizyon Örnek XML Cevap Mesajı ........................................................................................42
5.4.5 Surcharge Satış İşlemi.............................................................................................................................43
5.4.5.1 Surcharge Satış İsteği......................................................................................................................43
5.4.5.2 Surcharge Satış Cevabı ...................................................................................................................43
6. REFERANSLI İŞLEMLER..................................................................................................................................44
Gizli / Kişisel Veri
4
6.1. İptal (Cancel).................................................................................................................................................44
6.1.1. İptal İsteği ...............................................................................................................................................44
6.1.2. İptal Cevabı .............................................................................................................................................45
6.2. İade (Refund).................................................................................................................................................45
6.2.1. İade İsteği................................................................................................................................................45
6.2.2. İade Cevabı .............................................................................................................................................46
6.3. Ön Provizyon Kapama (Capture)................................................................................................................46
6.3.1. Ön Provizyon Kapama İsteği ..................................................................................................................46
6.3.2. Ön Provizyon Kapama Cevabı ................................................................................................................47
6.4. Teknik İptal (Reversal).................................................................................................................................47
6.4.1. Teknik İptal İsteği ...................................................................................................................................47
1.1.1. Teknik İptal Cevabı .................................................................................................................................48
7. 3DS ÜRÜNÜ ENTEGRASYONU ......................................................................................................................48
7.1. 3DS Satış İstek Mesajı.........................................................................................................................................49
7.2. 3DS Satış Cevap Mesajı ......................................................................................................................................49
8. SORGULAMA İŞLEMLERİ................................................................................................................................50
8.1. Puan Sorgulama (PointSearch)....................................................................................................................50
8.1.1. Puan Sorgu İsteği....................................................................................................................................50
8.1.1. Puan Sorgu Cevabı........................................................................................................................................51
8.2. Vade Farklı Taksit Sorgusu (VFTSearch)..................................................................................................51
8.2.1. Vade Farklı Taksitli İşlem Sorgu İsteği .........................................................................................................51
8.2.2. Vade Farklı Taksitli İşlem Sorgu Cevabı .................................................................................................52
8.3. Kampanya Sorgu (CampaignSearch) .........................................................................................................52
8.3.1. Kampanya Sorgu İsteği...........................................................................................................................52
8.3.2. Kampanya Sorgu Cevabı.........................................................................................................................52
8.4. Kart Aktiflik Sorgusu (CardTest)............................................................................................................53
8.4.1. Kart Aktiflik Kontrolü Sorgu İsteği .........................................................................................................53
8.4.2. Kart Aktiflik Kontrolü Sorgu Cevabı .......................................................................................................53
9. TARIM KART İŞLEMLERİ .................................................................................................................................54
9.1. Tarım Kart İşlemleri ....................................................................................................................................54
9.1.1. Tarım Kart Eşit Taksit (TKSale) ...............................................................................................................54
9.1.1.1. Tarım Kart Eşit Taksit Örnek XML İstek Mesajı..............................................................................54
9.1.1.2. Tarım Kart Eşit Taksit Örnek XML Cevap Mesajı ...........................................................................55
9.1.2. Tarım Kart Esnek Taksit (TKFlexSale).....................................................................................................55
9.1.2.1 Tarım Kart Esnek Taksit Örnek XML İstek Mesajı..............................................................................55
9.1.2.2 Tarım Kart Esnek Taksit Örnek XML Cevap Mesajı............................................................................56
9.2 Tarım Kart İptal İşlemleri ...........................................................................................................................56
Gizli / Kişisel Veri
5
9.3 Tarım Kart İade İşlemleri............................................................................................................................56
9.3.2 Tarım Kart Eşit Taksit İade İsteği............................................................................................................56
9.3.3 Tarım Kart Esnek Taksitli İşlemlerde İadeler.........................................................................................56
9.3.3.1 Tarım Kart Esnek Taksit İade İsteği ....................................................................................................56
9.3.3.2 Tarım Kart Esnek Taksit İade Cevabı..................................................................................................57
9.4 Tarım Kart Limit Sorgusu (TKLimitSearch) ............................................................................................57
9.4.1. Tarım Kart Limit Sorgu İsteği..................................................................................................................57
9.4.2. Tarım Kart Limit Sorgu Cevabı................................................................................................................58
9.5. Tarım Kart Üye İşyeri Ödeme Planı Sorgusu (TKPlanSearch) ...............................................................58
9.5.1. Tarım Kart Üye İşyeri Ödeme Planı Sorgu İsteği....................................................................................58
9.5.2. Tarım Kart Üye İşyeri Ödeme Planı Sorgu Cevabı .................................................................................59
10.PF/ALT BAYİ YAPISI PROVİZYON İŞLEMLERİ .............................................................................................60
10.1. SubMerchant Bilgisi İle Ödeme Alma ...............................................................................................60
10.1.1. PF/Alt Bayi 3D Secure Satış İşlemi................................................................................................62
10.1.1.1. Alt Bayi 3D Secure Satış İsteği..................................................................................................62
10.1.1.2. Alt Bayi 3D Secure Satış Cevabı...............................................................................................62
10.1.2. Alt Bayi Non Secure (Normal) Satış İşlemi..................................................................................63
10.1.2.1. Alt Bayi Non Secure (Normal) Satış İsteği..............................................................................63
10.1.2.2. Alt Bayi Non Secure (Normal Satış Cevabı............................................................................63
10.1.3. Alt Bayi İptal İşlemi............................................................................................................................64
10.1.3.1. Alt Bayi İptal İsteği .......................................................................................................................64
10.1.3.2. Alt Bayi İptal Cevabı....................................................................................................................64
10.1.4. Alt Bayi İade İşlemi ............................................................................................................................65
10.1.4.1. Alt Bayi İade İsteği .......................................................................................................................65
10.1.4.2. PF/Alt Bayi İade Cevabı..............................................................................................................65
10.2. Identity Bilgisi İle Ödeme Alma ..........................................................................................................67
10.2.1. İşlem Kuralları .....................................................................................................................................68
10.2.2. Identity’li Ana Bayi Non Secure Satış isteği...........................................................................................69
10.2.3. Identity’li Ana Bayi Non Secure Cevap Mesajı ......................................................................................69
10.2.4. Identity’li 3D Secure Satış İsteği.............................................................................................................70
10.2.5. Identity’li 3D Secure Cevap Mesajı ........................................................................................................70
10.2.6. Identity’li Alt Bayi Non Secure Satış İsteği.............................................................................................71
10.2.7. Identity’li Alt Bayi Non Secure Cevap Mesajı ........................................................................................71
11. MUTABAKAT SORGULARI..........................................................................................................................74
11.1. Başarılı İşlem Sorgulama (SettlementDetail) ................................................................................................74
11.1.1. Başarılı İşlem Sorgulama İsteği ..............................................................................................................75
11.1.2. Başarılı İşlem Sorgulama Cevabı ............................................................................................................75
Gizli / Kişisel Veri
6
11.2. Başarılı İşlem Kırılımı Sorgulama (Settlement).....................................................................................76
11.2.1. Başarılı İşlem Kırılımı Sorgulama İsteği..................................................................................................76
11.2.2. Başarılı İşlem Kırılımı Sorgulama Cevabı ...............................................................................................76
11.3. Kayıt Detay Sorgulama (Search).............................................................................................................79
11.3.1. Kayıt Detay Sorgulama İsteği.............................................................................................................79
11.3.2. Kayıt Detay Sorgulama Cevabı ...............................................................................................................79
11.4. Gün Sonu Alınacak Kayıtları Sorgulama (Succeeded OpenBatchTransactions) ...............................80
11.4.1. Gün Sonu Alınacak Kayıtlar Sorgu İsteği................................................................................................80
11.4.2. Gün Sonu Alınacak Kayıtlar Sorgu Cevabı..............................................................................................81
12.TEKRARLI TAHSİLAT SİSTEMİ (RECURRING PAYMENTS)................... Hata! Yer işareti tanımlanmamış.
12.1. Tekrarlı Tahsilat İşlem İsteği ve Cevabı.................................................................................................83
12.1.1. Recurring İşlem İsteği .............................................................................................................................83
12.1.2. Recurring İşlem Cevabı...........................................................................................................................84
12.2. Tekrarlı Tahsilat İşlem Sorgulama (SearchBatchTransactionSum)....................................................84
12.2.1. Talimatlı İşlem Sorgu İsteği ....................................................................................................................84
12.2.2. Talimatlı İşlem Sorgu Cevabı ..................................................................................................................85
12.3. Talimat Güncelleme..................................................................................................................................86
12.3.1. Talimat Güncelleme Sorgu İsteği ...........................................................................................................87
12.3.2. Talimat Güncelleme Sorgu Cevabı .........................................................................................................87
13. ÜYE İŞYERİ YARDIMCI SERVİSLERİ.........................................................................................................87
13.1. Müşteri Ekleme (CreateCustomer) .........................................................................................................88
13.1.1. Müşteri Ekleme İsteği.............................................................................................................................88
13.1.2. Müşteri Ekleme Cevabı...........................................................................................................................88
13.2. Müşteri Güncelleme (EditCustomer)......................................................................................................89
13.2.1. Müşteri Güncelleme İsteği .....................................................................................................................89
13.2.2. Müşteri Güncelleme Cevabı...................................................................................................................89
13.3. Kart Ekleme (CreateCustomerPan)........................................................................................................90
13.3.1. Kart Ekleme İsteği...................................................................................................................................90
13.3.2. Kart Ekleme Cevabı.................................................................................................................................90
13.4. Kart Güncelleme (EditCustomerPan).....................................................................................................91
13.4.1. Kart Güncelleme İsteği ...........................................................................................................................91
13.4.2. Kart Güncelleme Cevabı .........................................................................................................................91
13.5. Kart Silme (DeleteCustomerPan)............................................................................................................92
13.5.1. Kart Silme İsteği......................................................................................................................................92
13.5.2. Kart Silme Cevabı....................................................................................................................................92
13.6. PanCode ile Ödeme Alma ....................................................................................................................92
13.6.1. PanCode ile Provizyon İstek Mesaj Örneği............................................................................................92
Gizli / Kişisel Veri
7
13.6.2. PanCode ile Provizyon Cevap Mesaj Örneği..........................................................................................93
14. TÜM UYGULAMA CEVAP KODLARI VE AÇIKLAMALARI .........................................................................94
15. VPOS 7/24 SANAL POS ENTEGRASYON İPUÇLARI ...........................................................................................108
Gizli / Kişisel Veri
8
1. GENEL AÇIKLAMA
GET 7/24 MPI (3-D Secure) Platformu,
İnternet üzerinden yapılan kredi kartı veya banka kartı (debit kart) ile satın alma işlemlerinde, kartı kullanan
kişinin, kartın gerçek sahibi olduğunu doğrulamak amacıyla geliştirilmiştir. Kart sahibi, internetten yapacağı
alışverişlerde işlem anında kendi bankası tarafından kayıtlı cep telefonuna gönderilen sms OTP ile doğrulama
yaparak alışverişini tamamlayabilmektedir.
VISA tarafından geliştirilen 3-D Secure platformu MASTERCARD tarafından da desteklenmektedir. VISA’nın
3-D Secure platformundaki uygulaması Verified by VISA(VbV), MASTERCARD’ın aynı platform üzerindeki
uygulaması SecureCode adını almaktadır. Ayrıca BKM tarafından Güvenli Ödeme(GO) ile özelde TROY
logolu kartlar olmak üzere yurtiçi banka kredi ve debit kartları(Visa, MasterCard, Troy) bu platformdan
doğrulanabilmektedir.
Bütün uygulamalar 3-D Secure platformunun standartlarına uymakta ve platform bileşenleri uygulamalarda
benzer mesajlarla haberleşmektedir.
3-D Secure işlem gerçekleştirmek için önce müşteri kredi kartının, 3-D Secure programına dâhil olup olmadığı
Üye İşyeri tarafından sorgulanacak, ardından bu programa dâhilse, yine üye işyeri tarafından yapılacak bir
geliştirme ile işlem VISA, MASTERCARD ve TROY tarafından sunulan şifre giriş ekranlarına
yönlendirilecektir. Burada girilecek şifre ile kart sahibinin kimlik doğrulaması yapılacaktır.
3-D Secure için yapılan sorgulama sonucu, bir kartın 3-D Secure programına dâhil olup olmadığı kontrol
edilmektedir. Kart 3-D Secure programına dâhil ise 3-D Secure şifresini kullanabilecektir. 3-D Secure
programına dahil olmayan üye işyerleri işlemlerini Half-Secure olarak Sanal POS’a gönderebilirler veya işlemi
sonlandırabilirler. Kart 3D Secure programına dahil ve doğrulama başarılı bir şekilde yapılmışsa işyerinin
belirlediği başarılı url adresine bu bilgilen dönmektedir.
3-D Secure programına dâhil kartlar, VISA, MASTERCARD ve TROY tarafından sunulan şifre giriş
ekranlarında kart sahiplerince tanımlanan şifreyi girerek işlemlerini tamamlayacaklardır. Üye İşyerlerinden,
Kart hamili tarafından doğru şifre girilmesi durumunda isteği Sanal POS’a göndererek işleme devam etmeleri,
hatalı şifre girilmesi durumunda da işlemi kesmeleri istenmektedir. Özetle bir işlem başarılı url adresine
dönmüşse provizyon akışına alınmalı, başarısız url adresine dönmüşse işlem sonlandırılmalıdır.(Half Secure
işlem akışları için belirtilen durumlar hariç)
Doğru şifre girilmesi durumunda VISA, MASTERCARD ve TROY’dan alınan gerekli bilgiler, uygun şekilde
doldurularak Sanal POS’a uygulamasına işlemi 3-D Secure tamamlamak için gönderilmelidir. 3-D Secure
işlemlerde kullanılacak bu değerler daha sonra detaylandırılacaktır.
Sanal POS Uygulaması,
Alışveriş sitelerinde yapılan satış işlemlerinin Internet ortamı üzerinden Banka provizyonuna gönderilmesi
için hazırlanmıştır.
Alışveriş sitesi kullanıcılarının seçtikleri ürünlerin tutarı ile sitede girdikleri kredi kartı bilgilerinin, Sanal POS
uygulamasına gönderilmesiyle satış işlemi provizyonu başlatılır.
Sanal POS uygulaması da gerekli bilgileri hazırlayarak ilgili bankaya iletir ve girilen bilgilerin geçerliliğine göre
olumlu ya da olumsuz cevap döndürür. Tüm işlemler internet ortamında yapıldıklarından, dönen cevap yine
internet ortamından alışveriş sitesine iletilmektedir.
Gizli / Kişisel Veri
9
Alışveriş sitesinde geliştirme yapmaktan sorumlu olan üye iş yerlerinden aşağıdaki bilgileri Sanal POS
Uygulamasına göndermeleri beklenmektedir:
• Kullanıcıların alışverişlerinde aldıkları ürüne ait tutar bilgileri,
• Bankamız tarafında tanımlı olan üye işyeri kullanıcı adı ve şifre bilgileri
• Site kullanıcılarının girdikleri,
o Kredi kart numarası,
o Kartın son kullanma tarihi,
o Kartın arkasında bulunan 3 Haneli CVV2 değeri.
o Amex kartlar için kullanılan güvenlik kodu kartın ön yüzünde bulunan, kart numarasının
bitiminden sonra kartın sağına doğru yer alır.
Sanal POS uygulaması yukarıda belirtilen bilgileri kullanarak banka ile haberleşip, işlem sonucunu yine
belirlenmiş bir yapıda üye iş yerlerine dönmektedir.
Sanal POS uygulaması ile
• Bankamız kredi kartlarına taksitli satış işlemi yapılabilir,
• Yapılan satış işlemlerinin tamamı ya da bir kısmı iade edilebilir,
• Satış İşlemi iptal edilebilir,
• Bankamız kartlarına puan bilgisi sorgulanabilir ve puan harcaması yapılabilir,
• Üye işyerlerinin kendilerine tanımlanmış kampanyalar sorgulanabilir.
Kart sahipleri VISA ve MasterCard’ın sunduğu 3-D Secure programı ile Internet ortamında güvenli alışveriş
yapabilmeleri için tanımlayabilecekleri bir şifreyi de kullanabilirler.
Sanal POS uygulamamızda VISA, MasterCard, TROY ve Amex (American Express) ve CUP(China Union
Pay) logolu kredi ve banka kartları desteklenmektedir.
Gizli / Kişisel Veri
10
2. TANIMLAR
Tanım Açıklama
Üye İşyeri (ÜIY) Bankamızın güvenli SANAL POS MPI (3-D Secure) ve/veya SANAL POS alt
yapısını kullanarak kredi kartı ile tahsilat yapacak tüm kurum veya kuruluşlar.
MPI Merchant Plug-in. ÜİY’nin 3-D Secure bağlantısını sağlayan yazılım
bileşenidir.
DS
Directory Server. ÜİY Uygulama bileşenlerinden gelen tanımlama isteklerine
cevap verip, 3-D Secure programına dâhil olan kartlarla yapılan isteklerde,
kartı sağlayan kurumun ACS sunucusu adresini döndüren uygulamadır.
ACS
Access Control Server. Kart sağlayıcı kurumlar ya da operatörleri tarafından
işletilen, kart sahibi hesap ve erişim bilgilerinin tutulduğu sunucudur. Gerçek
zamanlı(online) kimlik doğrulama işlemi sırasında, ÜİY yazılım bileşeninden
gönderilen mesajla kart sahibini doğrular ve işlem sonucunu ÜİY yazılım
bileşenine gönderir.
ECI Electronic Commerce Indicator. İşlem için ACS’in ürettiği elektronik ticaret
belirteci.
CAVV Cardholder Authentication Verification Value. ACS tarafından üretilen 28 byte
büyüklüğünde kart sahibi doğrulama değeri
POX Request
Plain Old XML. Tüm kodlama dilleri ve Internet Protokolleri tarafından
desteklenen, hazırlanmış olan bir xml in, basit bir şekilde ilgili uygulamaya
post edilebildiği istek tipi
Mail Order Üye işyeri’nin Mail order yapması için özel olarak yetkilendirildiği, API veya
yönetim panelinden gönderilebilen CVV2 kontrolü yapılmayan işlem tipi.
Reversal Akıbeti bilinmeyen işlemler için HOST’a çıkılan teknik iptal mesajıdır.
TAVV
Visa Token Hizmeti, EMV Payment Token Spesifikasyonu üzerine
kurulmuştur. Visa Token Servisi aracılığıyla hem olası dolandırıcılık
teşebbüslerini önlemek, hem kart görseli gösterimi ile ödeme deneyimini
kolaylaştıracak, hem de ilave önlem almak adına tüm kanallarda (cihaza bağlı
ve cihaza bağlı olmayanlar dahil), mobil ve çevrimiçi ödemelerde tüm Visa
kartlarının yerini alabilen token kullanımına olanak sağlamaktadır. Visa Token
Service için gerekli olan TAVV parametre gönderimi yapmak isteyen Üye
İşyerlerimiz Visa Token Requestor olmak zorundadır. Konu ile ilgili Visa’nın
https://developer.visa.com/capabilities/vts adresinden faydalanılabilmekte ve
Visa ile doğrudan iletişime geçilebilmektedir. VakıfBank (Acquirer) olarak
sadece bu parametrenin ödeme anında gönderimine aracılık etme
sorumluluğumuz bulunmaktadır.
Gizli / Kişisel Veri
11
3. ERİŞİM ADRESLERİ
TEST ORTAMI URL ADRESLERİ PROD ORTAM URL ADRESLERİ PORT
3D Secure
Enrollment Adresi
(Kart kayıt işlemi)
https://3dsecuretest.vakifbank.com.tr/MPIAPI/M
PI_Enrollment.aspx
https://3dsecure.vakifbank.com.tr/MPIAPI/MPI
_Enrollment.aspx
443,4443
Sanal POS
ServisUrl
(POX Request)
https://onlineodemetest.vakifbank.com.tr:4443/V
posService/v3/Vposreq.aspx
https://onlineodeme.vakifbank.com.tr:4443/Vp
osService/v3/Vposreq.aspx
4443
Sanal POS
ServisUrl (Web
Service)
https://onlineodemetest.vakifbank.com.tr:4443/V
posService/TransactionServices.asmx
https://onlineodeme.vakifbank.com.tr:4443/Vp
osService/TransactionServices.asmx
4443
SorgulamaServisU
rl
(POX Request)
https://onlineodemetest.vakifbank.com.tr:4443/U
IService/
https://onlineodeme.vakifbank.com.tr:4443/UI
Service/
4443
SorgulamaServisU
rl
(Web Service)
https://onlineodemetest.vakifbank.com.tr:4443/U
IService/TransactionSearchOperations.asmx
https://onlineodeme.vakifbank.com.tr:4443/UI
Service/TransactionSearchOperations.asmx
4443
YardımcıServisUrl
(POX Request)
https://onlineodemetest.vakifbank.com.tr:4443/U
IService/
https://onlineodeme.vakifbank.com.tr:4443/UI
Service/
4443
YardımcıServisUrl
(Web Service)
https://onlineodemetest.vakifbank.com.tr:4443/U
IService/MerchantServices.asmx
https://onlineodeme.vakifbank.com.tr:4443/UI
Service/MerchantServices.asmx
444
Sanal POS Portal
Giriş Adresi
https://onlineodemetest.vakifbank.com.tr/Admin
UI
https://onlineodeme.vakifbank.com.tr/AdminUI 443,4443
Gizli / Kişisel Veri
12
4. 3D SECURE (MPI) VE SANAL POS İŞLEM AKIŞI
MPI (3-D Secure) Platformunda işlem akışı aşağıdaki adımlarla gerçekleştirilmektedir. Kart sahibi, Üye İşyeri
(ÜİY) Web Sitesinde satın alacağı ürünleri belirler ve işlemi sonlandırmak için ödeme sayfasına gelir. ÜİY
Web Sitesi, kart sahibinden ödeme bilgilerini alır.
1. ÜİY Web Sitesi, MPI’ a ödeme bilgilerini gönderir.
2. MPI Sunucusu ödeme bilgilerini, kartın markasına göre ilgili (VISA,MASTERCARD,TROY) Directory
Server(DS)’a gönderir.
3. DS, MPI’ın gönderdiği mesaja cevap olarak, kartın 3-D Secure programına dâhil olup olmadığını;
dâhilse kartı veren finansal kurumun ACS adresini ve ACS’e gönderilecek mesajı döndürür.
(Enrollment Kontrol Aşaması)
4. MPI, DS’dan aldığı bilgileri ÜİY’ne döner.
5. ÜİY, MPI’dan aldığı sonuca göre işlem akışına karar verir.
6. Kart 3-D Secure programına dâhil değilse işlem Sanal POS’a half secure bir işlem olarak iletilir.Ya
da işlem sonlandırılır. Kartın 3-D programına dahil olmadığı hatası dışındaki diğer tüm hatalar için
(VERes Status N Durumu dışındaki değerler) işlem sonlandırılmalıdır.
7. ÜİY, aldığı cevaptan kartın 3-D Secure programında yer aldığını belirlediğinde, MPI sunucusundan
aldığı mesajı, kart sahibinin tarayıcısını kullanarak ACS’e gönderir. (PARes Aşaması)
8. Kart sahibinin tarayıcısında ACS karşılama ekranı görüntülenir ve kart sahibinin şifresini girerek
işlemi onaylaması istenir.
9. Kart sahibi şifresini doğru şekilde girip işlemi onaylarsa, ACS doğrulama sonucunu MPI sunucusuna
kart sahibinin tarayıcısını kullanarak iletir.
10. MPI sunucusu ACS’den gelen kimlik doğrulama işlem sonucunu alıp yorumlayarak ÜİY’ye,
yine kart sahibinin tarayıcısını kullanarak iletir.
11. ÜİY, MPI sunucusundan gelen cevabı alarak, otorizasyon işlemine (Sanal POS Aşaması)
geçip geçmeyeceğine karar verir. (Provizyon Aşaması)
ÜİY Web Sitesinde kullanıcının kredi kart bilgilerinin alınmasının hemen sonrasında, yukarıda
numaralandırılan işlem adımları Şekil 5 1 Kimlik Doğrulama İşlem Akışındaki gibidir:
Gizli / Kişisel Veri
13
Kimlik Doğrulama İşlem Akışı
5. ÜİY UYGULAMASINDA YAPILACAK GELİŞTİRMELER
3-D Secure ve Sanal POS Entegrasyonu ile ÜİY Uygulamasında yapılması gerekli güncellemeler bu bölümde
anlatılmaktadır.
ÜİY Uygulamasında yapılacak en büyük değişiklik, ödeme akışının senkron yapıdan asenkron yapıya
geçirilmesidir. Asenkron yapı ifadesi kart sahibinin şifre ekranında 3-D Secure şifresi girişi için, ek bir
onaylamanın istenmesi nedeniyle, Sanal POS’a gönderilen işlemin bekleme durumunda kalması
yüzündendir. Kart sahibinin yaptığı onaylama ile işleme devam edilebilecektir.
3-D Secure olmayan akışta, kart sahibinden ödeme bilgileri alınıp, ardından otorizasyon mesajı Acquirer
Kuruma gönderilirken, yani işlem Sanal POS’a gönderilirken, 3-D Secure akışta, otorizasyon mesajı
öncesinde tamamlanması gereken “Kimlik Doğrulama” akışı yer almaktadır.
“Kimlik Doğrulama” akışının ilk adımı yine senkron olmakla birlikte, eğer ödemede kullanılan kart 3-D Secure
programına dahilse, kart sahibinin tarayıcısı kullanılarak, kartı sağlayan kurumun ACS sunucusuna
yönlendirilmektedir. ACS sunucusu ekranlarında da kart sahibi 3-D Secure şifresini girecektir. Bu adımda
ÜİY’ndeki akış, “İşlem Tamamlanmayı Bekliyor” statüsünde kalmaktadır. Herhangi bir nedenden (kart
sahibinin tarayıcısını, ACS sayfasındayken kapatması, ACS uygulamasındaki bir problem vb.) dolayı, ÜİY’ne
işlem sonucu iletilemezse, akış otorizasyon sürecine yani Sanal POS’a gönderim aşamasına
geçemeyecektir.
Entegrasyon için ÜİY Uygulamasında yapılacak değişiklikler;
• Müşteriden kredi kartı bilgilerini aldıktan sonra MPI’a kart “Kredi Kartı Kayıt Durumu”nun (Enrollment
Status) sorulması, yani kart 3-D Secure programına dâhil mi yoksa değil mi sorgusunun gönderilmesi
• Kredi Kartı Kayıt Durumu olumlu ise müşteriyi kredi kartını sağlayan kurumun ACS sunucusuna
yönlendirmesi
• MPI’dan gelen “Kimlik Doğrulama İşlem Sonucu” nu alacak, “Kimlik Doğrulama İşlem Sonuç URL’ini
geliştirme, yani ÜİY’nin, MPI’dan HTTPS POST metoduyla gönderilecek olan bilgileri alan bir sayfa
hazırlaması istenmektedir.
Gizli / Kişisel Veri
14
• Acquirer kuruma gönderilecek otorizasyon mesajlarına Electronic Commerce Indicator (ECI) ve
CardHolder Authentication Verification Value (CAVV) bilgilerini ekleme. Bu eklenen değerler Sanal
POS’a gönderilerek alış işlemi 3-D Secure olarak yapılabilecektir.
Sanal POS’ tan 3-D Secure veya Normal bir ödeme alınmasındaki akış, aşağıdaki adımların sırayla
gerçekleştirilmesiyle sağlanmaktadır.
DİKKAT! Ödemelerini 3D Secure olamadan(Non Secure) almak isteyen üye işyerlerimiz, doğrudan
Sanal POS akışına geçmelidirler. Non Secure işlemler 5.3.1.3. Normal İşlem - Non Secure alt
başlığında detaylandırılmıştır. Bu aşamayı yapabilmek için banka tarafında üye işyerinin Non Secure
ödeme alma yetkisini olması gerekmektedir.
Gizli / Kişisel Veri
15
5.1.KİMLİK DOĞRULAMA İŞLEM AKIŞI ( Enrollment Aşaması)
İşlem, ÜİY ekranından başlamakta ve yine ÜİY’nin dönüş değerlerini aldığı sonuç ekranında sonlanmaktadır.
Kullanıcının ACS karşılama ekranı olan 3-D Secure şifresi girişi aşağıdaki ekran görütüsündeki gibidir.
GO GUVENLI ÖDEME DOĞRULAMASI ACS EKRANI
MPI DOĞRULAMASI ACS EKRANI
Gizli / Kişisel Veri
16
5.1.1. Enrollment Kontrol İsteği (Kart, 3D Secure Programına dahil mi?)
Bu aşamada, ödemede kullanılan kredi kartının 3-D Secure programına dâhil olup olmadığının belirlenmesi
gerekmektedir. Bu amaçla, ÜİY Uygulaması, ödeme ve işlem bilgilerini MPI’a HTTPS POST yöntemi ile
gönderir.
Aşağıdaki tabloda yer alan Enrollment İstek Parametrelerinde “Zorunlu Alan” olarak işaretlenmiş tüm alanlar,
MPI Enrollment adresine HTTPS POST yöntemi ile gönderilmelidir.
Test Adresi Production Adresi
Enrollment
Adresi
https://3dsecuretest.vakifbank.com.tr:4443
/MPIAPI/MPI_Enrollment.aspx
https://3dsecure.vakifbank.com.tr:4443/M
PIAPI/MPI_Enrollment.aspx
Gizli / Kişisel Veri
17
XML alan adı Açıklama Alan biçimi ve
Uzunluğu
Alabileceği değer Zorunlu mu?
MerchantId Üye İşyeri Numarası 000000000001111 15 hanelidir Zorunlu
MerchantPassword ÜİY Şifresi Api Şifresi Api şifresi, değişken Zorunlu
VerifyEnrollmentRequestId ÜİY tarafından üretilen
işlem numarasıdır. Her
bir işlem için benzersiz
olmalıdır. ÜİY, işlemlerini
bu numara üzerinden
takip edebilir.
Zorunlu
Pan Kredi kartı numarası Zorunlu
ExpiryDate Kredi kartı son kullanma
tarihi
YYAA formatında 4 karakter
olarak gönderilmelidir.
Örneğin, son kullanım
tarihi 2025 yılı Mart ayı olan
bir kartla yapılan işlemde
bu alan, 2503 olmalıdır
Zorunlu
PurchaseAmount Satış tutarı Satış tutarı ile küsuratı nokta
işareti ile ayrılmalı, küsurat
kısmı 2 hane olmalıdır. Bu alan
en fazla 12 hane uzunluğunda
olabilir.
Tutar kısmı 3 haneyi aştığında
nokta işareti kullanılmamalıdır.
Örn: 5.00
 23.49
 124785.00
Zorunlu
Currency İşlemin yapıldığı sayısal
para birimi kodu
Sayısal – Tamsayı - 3 Hane. Bu
alan boş iken işlem
gönderildiğinde default olarak
949 CurrencyCode’a göre
işlem gerçekleştirilmektedir.
949:TRY
840:USD
978:EUR
826:GBP
Zorunlu
BrandName Kredi kartı Kart Kuruluşu
Bilgisi
Sayısal – Tamsayı – 3 Hane.
Kart logosuna uygun
gönderilmelidir.
100:VISA
200:MASTERCARD
300:TROY
Zorunlu
SessionInfo Oturum Bilgisi ÜİY tarafında gönderilmesi
Opsiyonel, sadece bilgi amaçlı
tutulan bir alandır.
Max 500 karakter
gönderilmelidir.
İsteğe bağlı
SuccessUrl ÜİY’nin işlem sonucun
başarılı olması
durumunda, dönüş
yapılmasını istediği
sayfa URL i.
Eğer bu alan gönderilmediyse
GET 7/24 MPI, ÜİY için tanımlı
SuccessUrl e dönüş
yapacaktır.
Maksimum 255 karakter
olmalıdır. Gönderilen değer bir
url olmalıdır.
Gönderilen değer Regex
paternine uymalıdır:
http[s]?://(([^/:\.[:space:]]+(\
.[^/:\.[:space:]]+)*)|([0-
9](\.[0-9]{3})))(:[0-
9]+)?((/[^?#[:space:]]+)(\?[
^#[:space:]]+)?(\#.+)?)?
Zorunlu
FailureUrl ÜİY’nin işlem sonucunun
başarısız olması
durumunda, dönüş
yapılmasını istediği
sayfa URL i.
Eğer bu alan gönderilmediyse
GET 7/24 MPI, ÜİY için tanımlı
FailureUrl e dönüş yapacaktır.
Maksimum 255 karakter
olmalıdır. Gönderilen değer bir
url olmalıdır.
Gönderilen değer Regex
paternine uymalıdır:
http[s]?://(([^/:\.[:space:]]+(\
.[^/:\.[:space:]]+)*)|([0-
9](\.[0-9]{3})))(:[0-
9]+)?((/[^?#[:space:]]+)(\?[
^#[:space:]]+)?(\#.+)?)?
Zorunlu
InstallmentCount İşlem taksit sayısı Eğer ÜİY tarafından
gönderilirse, 1'den büyük bir
değer olmalıdır. 0 ya da 1
gönderildiğinde MPI işlemi
reddeder. Bir İşlemin taksitli
olabilmesi için MPI tarafında
gönderilen taksit sayısının
provizyon aşamasında da
mutlaka gönderilmesi
gerekmektedir.
Ödeme taksitli olacaksa
taksit değerinin Sanal POS
provizyon aşamasında da
belirtilmesi gerekmektedir.
Provizyon aşamasında
NumberOfInstallments
parametresinde de taksit
sayısı gönderilmelidir.
İsteğe bağlı
IsRecurring Periyodik İşlem Flag'i ÜİY, periyodik olarak yinelenen
bir işlem yapıyorsa bu alanı
"true" değeriyle göndererek
MPI'a işlemin periyodik olarak
yinelenen bir işlem olduğunu
bildirebilir. "true" gönderilmesi
durumunda
"RecurringEndDate",
"RecurringFrequency"
alanlarının gönderilmesi
gereklidir.
True: Periyodik İşlem
False: Periyodik İşlem
Değil
İsteğe bağlı
Gizli / Kişisel Veri
18
XML alan adı Açıklama Alan biçimi ve
Uzunluğu
Alabileceği değer Zorunlu mu?
RecurringFrequency Periyodik İşlem Frekansı Sayısal – Tam Sayı Eğer işlem,
periyodik olarak yinelenen bir
satış ise, iki periyod arasındaki
minimum gün sayısı, tamsayı
olarak bu alanda
gönderilmelidir.
Ör: 25 (günlük 1-30)
Aylık(1-12)
Koşullu
(IsRecurring="true
" ise zorunlu)
RecurringEndDate Periyodik İşlem Bitiş
Zamanı
Sayısal – Tam Sayı – 8 Hane.
Periyodik olarak yinelenen
işlemin sonlanma tarihidir.
YYYYAAGG formatında
gönderilmelidir. Bu alandaki
tarih, kartın son kullanma
tarihinden büyükse ACS
sunucusu işlemi reddeder
Ör: 20251023 Koşullu
(IsRecurring="true
" ise zorunlu)
MerchantType Üye İşyeri Tipi Üye İşyeri tipi. Banka
tarafından Üye işyerine
iletilmektedir. Üye işyeri için
sabit bir değerdir. Tüm
isteklerde, bu değer
kullanılmalıdır.. Ana bayi ve alt
bayiler için gönderimi
zorunludur.
Ana Bayi: 1
Alt Bayi:2
Koşullu:
(Sadece Bayi
kapsamındaki
işyerleri için
zorunludur.)
SubMerchantId Alt Bayi İşyeri Numarası Alfanumeric. Banka tarafından
AltBayiler için üye işyerine
iletilecektir. İşlem anında
banka tarafından işyeriyle
paylaşılan işyeri numarası
gönderilmelidir.
Alt bayi adına işlem geçecekse
gönderimi zorunludur.
Ör:00000000001111 Koşullu:
MerchantType:2
ise zorunlu,Alt
bayi işyeri
numarası
gönderilmelidir.
MerchantType:1
ise, Ana bayi
kendi adına işlem
geçiyor ise
gönderilmemeli,
Altbayisi adına
işlem geçiyor ise
zorunludur.
Identity Alt Bayi İşyerine ait VKN
veya TCKN bilgisi
Alfanumeric . Tckn için 11
haneli Vkn için 10 haneli
gönderilmelidir.Ana bayi alt
bayisi adına işlem geçmek
istiyorsa alt bayi vkn/tckn
bilgisini bu alanda
göndermelidir.Başarılı
doğrulama için İlgili ana bayinin
Identity gönderme yetkisinin
banka tarafında akitf olması
gerekmektedir.
Örnek:
Vkn:1234567890
Tckn:11234567890
Koşullu:
Alt bayi adına
işlem geçecekse
zorunludur.(
MerchantType 2
ise zorunlu)
Enrollment İstek Parametreleri Tablosu
Gizli / Kişisel Veri
19
5.1.2. Enrollment (Kart Kayıt) Kontrol Cevabı
GET 7/24 MPI, Enrollment (Kredi Kartı Kayıt) Kontrol İsteğinde gönderilen HTTPS POST mesajına cevap
olarak XML formatında cevap döner. ÜİY Uygulaması aldığı XML mesajını yorumlayarak 3-D Secure akışına
devam eder ya da 3-D Secure akışını sonlandırır.
Alınan işlem sonucunun yorumlanmasında kullanılacak bilgi, Status alanında yer almaktadır. ÜİY Uygulaması
3-D Secure akışa devam edip etmeyeceğine Status alanındaki değere göre karar verir.
Enrollment Kontrol mesajına dönen XML mesaj alanları ve mesajdaki alan açıklamaları aşağıdaki tablolarda
yer almaktadır.
<?xml version="1.0" encoding="utf-8" ?>
<IPaySecure>
<Message ID="umh7y4i3602e3e80a9424b1da279624537aa4a4e">
<VERes>
<Version>1.0.2</Version>
<Status>Y</Status>
<PaReq>eJxVUttuwjAM/ZWq72vSNFCKTBAMtKFtDAGaxGNoPahEUwgpl339kgKDRXnwObZjHzvQPRUb74B
6n5eq44cB9T1UaZnlatXxK/P91PK7AuZrjTiYYVppFPCB+71coZdnNqRYx2eeR03KMMIWlQlnfBlmks
VJk/FGFEvJJUdfwKQ3xZ2AazFhawUMyA3aV3W6lsoIkOmuPxoLnkQtHgK5QihQjwaC3k+cNBpALjQoW
aD4mnzOvNH723DqzYezuTfvjUdAahekZaWMPos4sVVvACq9EWtjtm1CjsdjkCtVHmSQlkVgNBDnBXLv
bFI5a29fO+WZQLUx6c80XL6cqoUq+aLYGhn1G9lg1QHiIiCTBgWjYUJjyj3K21HLXiA1D7JwbYjQarE
yLwC2rkbv0fPIgF2Bths6i4QnVscNAZ62pUIbYdX92UDuHT+/usmmxg6L0WaTc1bPtiZcdm7HwSLK63
QHgLgUcl0buW7dWv9+wy+80btF</PaReq>
<ACSUrl>https://testacs.bkm.com.tr/mdpayacs/pareq</ACSUrl>
<TermUrl>https://3dsecuretest.vakifbank.com.tr/MPIAPI/MPI_PARes.aspx</TermUrl>
<MD>umh7y4i3602e3e80a9424b1da279624537aa4a4e</MD>
<ACTUALBRAND>100</ACTUALBRAND>
</VERes>
</Message>
<VerifyEnrollmentRequestId>enrollmenkontroltest</VerifyEnrollmentRequestId>
<MessageErrorCode>200</MessageErrorCode>
</IPaySecure>
Gizli / Kişisel Veri
20
XML alan adı Açıklama Alan biçimi ve Uzunluğu Kullanım
Message ID GET 7/24 MPI tarafından
üretilen işlem numarası
40 byte uzunluğunda Status alanı “Y” ya da “N” ise
zorunlu
Version iPaySecure mesaj sürüm
numarası
Zorunlu
Status Kayıt kontrol sonucu 1 byte uzunluğundaki işlem sonucuna göre ÜİY
Uygulaması akışa nasıl devam edeceğini belirler. Bu
alanda yer alabilecek sonuç değerleri Y, N ve E
şeklindedir.
Y:Kart 3-D Secure programına dâhil
N:Kart 3-D Secure programına dâhil değil
E:Hata durumu
Status alanı Y olduğu durumda ÜİY Uygulaması 3-D
Secure akışına devam edilir.
N, U ya da E sonucu alındığında 3-D Secure akışı
sonlanır, ardından alış işlemi Sanal POS’a 3-D
Secure olmadan göndermek ÜİY nin inisiyatifindedir.
Zorunlu
PAReq GET 7/24 MPI tarafından
oluşturulup, ACS’e iletilmek
üzere ÜİY Uygulamasına
iletilen özel bilgi alanı
Status alanında gelen değer “Y” ise bu alanda bilgi
yer almaktadır. Status “N”, “U” ya da “E” ise cevap
mesajında bu alan boştur.
Status alanı “Y” ise zorunlu
ACSUrl Ödemede kullanılan kredi
kartını veren finansal
kuruluşun ACS adresi
Status alanında gelen değer “Y” ise bu alan cevap
mesajında yer almaktadır. Status “N”, “U” ya da “E”
ise bu alan cevap mesajında yer almaz.
Status alanı “Y” ise zorunlu
TermURL ACS’in, kart sahibi kimlik
doğrulama sonucunu ileteceği
MPI adresi
Bu adres, GET 7/24 MPI’ın üzerinde yer alan bir
URL’dir. Status alanında gelen değer “Y” ise bu alan
cevap mesajında yer almaktadır. Status “N”, “U” ya
da “E” ise bu alan cevap mesajında yer almaz.
Status alanı “Y” ise zorunlu
MD Enrollment Kontrol İstek
mesajından sonra GET 7/24
MPI’ın oluşturduğu alan
GET 7/24 MPI, (ÜİY tarafından gönderildiyse)
SucessUrl ve FailureUrl alanlarını, bu alanın
içerisinde koyar. Enrollment işleminin Status’ü “N”,
“U” ya da “E” ise bu alan cevap mesajında yer almaz.
Status alanı “Y” ise zorunlu
ActualBrand GET 7/24 MPI tarafından
oluşturulup, 3-D Secure
sorgulamasına gönderilen
kart için kartın hangi kuruluşa
ait olduğunu döner
Aşağıdaki değerlerden birini alabilir:
VISA
MASTERCARD
TROY
Zorunlu
MessageErrorCode İşlem sonuç kodu Başarılı işlemlerde satatus değeri “Y” ise 200 değeri
dönülür. Başarısız işlemlerde, hata kodu dönülür.
Enrollment Cevap XML’i
NOT: Eğer, bir ÜİY, sadece 3-D Secure Onaylı Satış Yapmak (kredi kart şifresi girilmiş ve doğrulama işlemi yapılmış
olarak) gerçekleştirmek istiyorsa, bu durumda Status alanında sadece Y kodu geldiğinde kabul etmelidir. Diğer
durumlarda işleme izin vermemelidir.
5.1.2.1. Enrollment Kontrol Cevabı (Başarılı)
Kart 3D programına dahil ise aşağıdaki gibi yanıt dönecektir. Enrollment Kontrol cevabından alınan bilgiler hiç
değiştirilmeden 3D Secure Şifre Doğrulamaya yani 5.2. ACS – 3D Secure Şifre Doğrulama (PARes) aşamasına
geçilmelidir.
<?xml version="1.0" encoding="utf-8" ?>
<IPaySecure>
<Message ID="umh7y4i3602e3e80a9424b1da279624537aa4a4e">
<VERes>
<Version>1.0.2</Version>
<Status>Y</Status>
<PaReq>eJxVUttuwjAM/ZWq72vSNFCKTBAMtKFtDAGaxGNoPahEUwgpl339kgKDRXnwObZjHzvQPRUb74B
6n5eq44cB9T1UaZnlatXxK/P91PK7AuZrjTiYYVppFPCB+71coZdnNqRYx2eeR03KMMIWlQlnfBlmks
VJk/FGFEvJJUdfwKQ3xZ2AazFhawUMyA3aV3W6lsoIkOmuPxoLnkQtHgK5QihQjwaC3k+cNBpALjQoW
aD4mnzOvNH723DqzYezuTfvjUdAahekZaWMPos4sVVvACq9EWtjtm1CjsdjkCtVHmSQlkVgNBDnBXLv
bFI5a29fO+WZQLUx6c80XL6cqoUq+aLYGhn1G9lg1QHiIiCTBgWjYUJjyj3K21HLXiA1D7JwbYjQarE
yLwC2rkbv0fPIgF2Bths6i4QnVscNAZ62pUIbYdX92UDuHT+/usmmxg6L0WaTc1bPtiZcdm7HwSLK63
QHgLgUcl0buW7dWv9+wy+80btF</PaReq>
Gizli / Kişisel Veri
21
<ACSUrl>https://testacs.bkm.com.tr/mdpayacs/pareq</ACSUrl>
<TermUrl>https://3dsecuretest.vakifbank.com.tr/MPIAPI/MPI_PARes.aspx</TermUrl>
<MD>umh7y4i3602e3e80a9424b1da279624537aa4a4e</MD>
<ACTUALBRAND>100</ACTUALBRAND>
</VERes>
</Message>
<VerifyEnrollmentRequestId>enrollmenkontroltest</VerifyEnrollmentRequestId>
<MessageErrorCode>200</MessageErrorCode>
</IPaySecure>
Dikkat: Pop-up pencere kullanılarak yönlendirme yapılmamalıdır. Pop-up pencere engelleyici araçların,
kullanıcılar tarafından sıkça tercih edilmesi nedeniyle, 3-D Secure akışında pop-up pencere kullanımı
kesinlikle önerilmemektedir.
5.1.2.2. Enrollment Kontrol Cevabı: “N”(Kart Kayıtlı Değil)
3-D Secure programına dâhil olmayan bir kart için MPI uygulamasından ÜİY’nin alacağı cevap örneği
aşağıdaki gibidir.
<?xml version="1.0" encoding="UTF-8"?>
<IPaySecure>
 <Message ID="913ba68c1fef4c96bcc551dc99197e1b6d7fb9d5"/>
 <VERes>
 <Version>1.0.2</Version>
 <Status>N</Status>
 <ACTUALBRAND>100</ACTUALBRAND>
 </VERes>
</IPaySecure>
Dikkat: Enrollment Kontrol Cevabında dönen VERes Status değerinin N olarak alınması durumunda üye
işyeri uygulaması işleme devam etmek istiyorsa kart şemasına göre farklı kurallar çalıştırabilir. Genel olarak:
• İsterse, işlemin MPI Süreci başarılı olarak tamamlanmadığı için, satışı gerçekleştirmez, son
kullanıcıya olumsuz cevap verir, ya da kullanıcıya 3D Secure sürecine dahil bir kart ile ödeme
yapmaya yönlendirir.
• İsterse, Visa ve Mastercard olma durumuna göre farklı akışlarda tahsilata devam eder.
Visa Kart İşlemleri için;
Enrollment kontrol cevabında VERes Status değeri N olarak dönmüşse ve işyeri işleme Non
Secure devam etmek istiyorsa ECI’yi 07 olarak provizyon mesajında ECI alanına yerleştirerek
işleme Non Secure devam eder. (Bu durumda, kart 3D Secure programına dahil olmadığı
için, ödemeye onay verip vermemek kart bankasının inisiyatifinde olacaktır.Üye işyerimizin
işlemi sonlandırmasını tavsiye ederiz.) 3-D Secure entegrasyonunu gerçekleştiren ÜİY,
Acquirer kuruma gönderecekleri otorizasyon mesajına, ECI (Electronic Commerce Indicator)
alanını eklemek zorundadırlar.
ECI: Half Secure olarak, Sanal POS sistemine iletilecek satış isteklerinde, ECI değeri ; 07
olarak iletilmelidir.
CAVV: CAVV değeri oluşmayacağı için gönderilmemelidir.
Gizli / Kişisel Veri
22
MpiTransactionId: Enrollment (VEReq) isteği sırasında iletilen tekil
VerifyEnrollmentRequestId değeri, sanal pos a istek iletilirken, MpiTransactionId alanına
setlenmelidir.
Mastercard ve Troy Kart İşlemleri için;
Mastercard ile yapılan işlemlerde VERes Status değerinin N olarak alınması durumunda
işlemler kesinlikle half secure olarak iletilmemelidir. İşleme ancak non secure olarak devam
edilebilir. Pares aşamasında Status değeri A alındığı durumlarda işleme sitenirse half Secure
devam edilebilir. Burada ECI değeri 01 gönderilmelidir.
CAVV: CAVV değeri oluşmayacağı için gönderilmemelidir.
MpiTransactionId: Enrollment (VEReq) isteği sırasında iletilen tekil
VerifyEnrollmentRequestId değeri, sanal pos a istek iletilirken, MpiTransactionId alanına
setlenmelidir.
5.1.2.3. Enrollment Kontrol Cevabı (Hata Durumu)
İşlem Sonlandırılmalıdır. Dönen ErrorCode ve ErrorMessage açıklamasına göre kart hamilini uygun bir hata
açıklamanızla bilgilendirebilirsiniz. Örnek bir Enrollment Kontrol Cevabı aşağıdaki gibidir.
<?xml version="1.0" encoding="UTF-8"?>
<IPaySecure>
 <Message>
 <VERes>
 <Status>E</Status>
 </VERes>
 </Message>
 <ResultDetail>
 <ErrorCode>2023</ErrorCode>
 <ErrorMessage>Verify Enrollment Request Id Already exist for this
merchant</ErrorMessage>
 </ResultDetail>
</IPaySecure>
3D Secure akışını kesecek bir cevap (Status U ya da E) alındığında ÜİY uygulaması 3D Secure akışını
kesmelidir.
Gizli / Kişisel Veri
23
5.2. PARes Aşaması (Kimlik Doğrulama Aşaması)
ÜİY Uygulamasının GET 7/24 MPI’dan aldığı Enrollment Kontrol cevabının “Status” alanındaki değer “Y” ise
ÜİY, kart sahibini, kartı sağlayan kurumun ACS Sunucusuna yönlendirmelidir.
5.2.1. PAReq Mesajının ACS’ye Gönderilmesi
Yönlendirme, kart sahibinin tarayıcısı kullanılarak yapılır.
ÜİY Uygulaması, Enrollment Kontrol cevabında aldığı bilgileri hiç değiştirmeden ACS’e göndermelidir. Bu
bilgilerde değişiklik yapılması durumunda 3-D Secure akışı, ilgili ACS Uygulaması ya da GET 7/24 MPI
tarafından hatalı olarak değerlendirilecek ve işlem başarısız olarak sonlanacaktır.
ÜİY’nin Enrollment Kontrol cevabında aldığı bilgilerin, kart sahibinin tarayıcısı kullanılarak, javascript ile
ACS’e gönderimi, aşağıdaki tablodaki örnekte gösterildiği gibi yapılabilir.
Kullanıcının tarayıcısının javascript’i desteklememesi olasılığına karşı, sayfaya yerleştirilecek bir “Submit”
butonu ile kullanıcının 3-D Secure akışına devam etmesi sağlanmalıdır.
<html>
<head>
<title>GET724 MPI 3D-Secure Processing Page</title>
</head>
<body >
<form name="downloadForm" action="<%=ACSUrl%>" method="POST">
<noscript>
<br>
<br>
<center>
<h1>Processing your 3-D Secure Transaction</h1>
<h2>
JavaScript is currently disabled or is not supported
by your browser.<br></h2>
<h3>Please click Submit to continue
the processing of your 3-D Secure
transaction. Enrolled Returns true
</h3>
<input type="submit" value="Submit">
</center>
</noscript>
<input type="hidden" name="PaReq" value="<%=PAReq%>">
<input type="hidden" name="TermUrl" value="<%=TermUrl%>">
<input type="hidden" name="MD" value="<%=MD%> ">
</form>
<SCRIPT LANGUAGE="Javascript" >
document.downloadForm.submit();
</SCRIPT>
Gizli / Kişisel Veri
24
</body>
</html>
Dikkat: Örnekte kullanılan değişkenler yerine, Enrollment Kontrol cevabından alınan alanlar yerleştirilir.
Hangi değişken yerine hangi alanın kullanılacağı aşağıdaki tabloda yer almaktadır.
5.2.2. Kimlik Doğrulama İşlem Sonucunun Alınması
ÜİY Uygulaması, kart sahibini tarayıcısını kullanarak ACS’e yönlendirdikten sonra uygulama sonlanır ve GET
7/24 MPI’dan işlem sonucunun gelmesinin ardından otorizasyon sürecine başlayabilir, yani işlem Sanal
POS’a gönderilebilir veya işlemi sonlandırabilir.
Kart sahibi ACS’e yönlendirildikten sonra, ÜİY’nin işlemi göndermiş olduğu uygulama sonlanır ve GET 7/24
MPI’dan gelecek olan işlem sonucunu beklemeye başlar. ÜİY, GET 7/24 MPI’dan gelen sonucu,
hazırlayacağı bir uygulama ile karşılayacaktır.
• Kart sahibi kredi kartını kullandığı finansal kurumun ACS Sunucusuna yönlendirildikten sonra ACS
Sunucusunda, karşılama mesajını, ödeme yapmak istediği ÜİY’nin adını ve ödeme tutarını görür ve
daha önce ilgili ACS için belirlediği şifresini girer. Eğer şifresini belirlememiş ise ACS üzerinde
Activation On The Fly (AOF-İşlem sırasında aktivasyon) başlatılır ve kart sahibi şifresini belirleyip,
işleme devam eder. AOF tamamen ACS uygulamasında gerçekleşen bir süreçtir. Üye işyeri ve GET
7/24 MPI, bu süreçte bir fonksiyon üstlenmezler.
• Kart sahibi ACS şifresini doğru olarak girdiğinde, ACS uygulaması, kart sahibini GET 724 MPI’a, yine
kart sahibinin tarayıcısını kullanarak yönlendirir. Yönlendirme ile birlikte işlem sonucu da GET 724
MPI’a iletilir. GET 724 MPI, ACS’den gelen işlem cevabını aldıktan sonra doğruluğunu kontrol eder
ve sonucu Üye İşyeri Uygulamasına yine kart sahibinin tarayıcısı ile iletir.
• Bu akışta, ACS’in şifre giriş sayfasından yönlendirilen kart sahibi, GET 7/24 MPI üzerinde bir sayfa
görmez. GET 7/24 MPI’a yönlendirme, ilgili işlem sonuç bilgisinin iletilmesi amacıyla yapılır. Kart
sahibinin göreceği sayfa, ÜİY’nin hazırlayacağı “ÜİY İşlem Sonuç URL’i olacaktır. Bu sonuç
URL’sindeki uygulama ile GET 724 MPI’dan HTTPS POST ile iletilen bilgiler alınacaktır.
Değişken Enrollment Kontrol Cevap Alanı
%=ACSUrl% ACSUrl
%=PAReq% PAReq
%=TermUrl% TermUrl
%=MD% MD
Gizli / Kişisel Veri
25
5.2.2.1. ÜİY İşlem Sonuç URL’i
• GET 7/24 MPI entegrasyonu gerçekleştiren her ÜİY, GET 7/24 MPI’ın işlem sonucunu bildirirken
kullanacağı bir URL belirlemek zorundadır. İşlem sonucu, ÜİY’ne, GET 7/24 MPI uygulaması
tarafından, kart sahibinin tarayıcısı kullanılarak HTTPS POST yöntemiyle iletilir.
• ÜİY Uygulaması, “İşlem Sonuç URL’ine POST edilen bilgileri yorumlayarak öncelikle mesajın hangi
işlem için gönderildiğini belirler. Bu amaçla “VerifyEnrollmentRequestId” kullanılmalıdır.
• ÜİY, işlemi tanımlamasına yarayacak bilgileri “SessionInfo” alanında GET 7/24 MPI’a gönderebilir.
Bu alandaki bilgiler, GET 7/24 MPI ve ACS Sunucuları tarafından hiç değiştirilmeden, ÜİY
Uygulamasına geri döndürülür.
• Bu adımdan sonra ÜİY Uygulaması, işlem sonucuna göre ya otorizasyon sürecine geçer ya da akışı
keserek, kart sahibinin başka bir kart ile işlemi sürdürmesini bekler.
• ÜİY Uygulaması “İşlem sonuç URL’ine gönderilen alanlar ve açıklamaları aşağıdaki tabloda yer
almaktadır.
• Aşağıdaki tabloda turkuaz renkle işaretlenen parametreler 3D Secure işlemlerde provizyon
aşamasında XML mesajına mutlaka eklenmelidir.
Alan Açıklama Kullanım
MerchantId Üye İşyeri Numarası Zorunlu
VerifyEnrollmentRequestId ÜİY’nin işlemi, gönderdiği Enrollment işlemiyle eşleştirilebilmesi için
kullanılır. Provizyon aşamasında MpiTransactionId alanına set edilmeli.
3DS için gönderimi zorunludur.
Zorunlu
ExpiryDate Kredi kartı son kullanma tarihi. YYAA formatında 4 hane Zorunlu
PurchAmount Enrollment aşamasında gönderilen satış tutarı. Son 2 hane kuruşlu kısmı
ifade eder.
Zorunlu
PurchCurrency İşlemin yapıldığı 3 haneli sayısal para birimi kodu. Örneğin TL için 949,
USD için 840…
Zorunlu
Xid MPI tarafından üretilen 20 byte değerindeki alan. İşlem Sanal POS a
gönderilirken Sanal POS tarafından istenmesi durumunda gönderilebilir.
Zorunlu
SessionInfo ÜİY tarafından üretilip, GET 724 MPI’a gönderilen en fazla 1024byte
uzunluğunda işlem ile ilgili bilgi alanı
Zorunlu
Status ACS tarafından oluşturulan kart sahibi kimlik doğrulama sonucu.
Alabileceği değerler,
Y:Doğrulama başarılı
A:Doğrulama tamamlanamadı ancak doğrulama denemesini
kanıtlayan CAVV üretildi
U:Doğrulama tamamlanamadı
E:Doğrulama başarısız.
N:Doğrulama başarısız, işlem reddedildi
Zorunlu
CAVV ACS tarafından üretilen 28 byte büyüklüğünde kart sahibi doğrulama
değeri.3DS için gönderimi isteğe bağlıdır.
Status alanı değeri “Y” ya da “A” ise
içeriği doludur
ECI İşlem için ACS’in ürettiği elektronik ticaret belirteci.
Status alanındaki değer Y ise 05, A ise 06 değerlerini alır. Mastercard ve
Troy için Status Y ise 02, A ise 02 değerini alır.
3DS için gönderimi isteğe bağlıdır.
Status alanı değeri “Y” ya da “A” ise
içeriği doludur
InstallmentCount Taksit sayısı.Provizyon aşamsında NumberOfInstallments alanına set
edilmelidir.
İsteğe bağlı, işlem taksitli olacaksa
zorunludur.
Gizli / Kişisel Veri
26
5.2.2.2. Kimlik Doğrulama İşlem Sonuçlarının Yorumlanması
Kimlik doğrulama işlem sonucu ÜİY Uygulamasının ÜİY İşlem Sonuç URL’ine HTTPS POST yöntemiyle
iletilir.
Alınan işlem sonucunun yorumlanmasında kullanılacak bilgi Status alanında yer almaktadır.
Dikkat! PARes cevabında dönen Status değerinin “Y” ve “A” dışında bir değer olması durumunda,
işlem 3D Secure sürecini tam olarak başarılı tamamlamamış olacağından, bu işlemlerin otorizasyona
gönderilmesi tavsiye edilmemektedir. Böyle bir durumda, son kullanıcı tarafından gerçekleştirilecek olası
itirazlarda sorumluluk, Üye İşyerinde olacaktır.
ÜİY Uygulamasının otorizasyon akışını Status alanın içerdiği değere göre düzenlemesi beklenmektedir. Bu
akışlar VISA ve MASTERCARD için farklı olabilmektedir.
3-D Secure entegrasyonunu gerçekleştiren ÜİY, Acquirer kuruma gönderecekleri otorizasyon mesajına ECI
ve CAVV (eğer GET 7/24 MPI tarafından iletilmişse) bilgilerini yerleştirmek zorundadırlar. CAVV değeri işlem
sonucu “Y” ya da “A” ise üretilmektedir.
3D Secure şifre doğrulama aşaması yani ACS tarafından oluşturulan kart sahibi kimlik doğrulama sonucu
işlemi başarılı (PARes cevabı Status değeri “Y”) ise işleme devam edilmelidir. Sanal POS’ a satış
isteklerinin gönderilmesi için bkz. Sanal POS [5.3.1. 3D Secure (Full Secure)]
Diğer durumlar için (PARes cevabı Status değeri E, N ve U) işlem sonlandırılmalıdır. GET 7/24 hata
koduna göre kullanıcı uygun bir mesajla bilgilendirilmelidir.
Pares sonucunda MdStatus değerleri de dönülmektedir. İlave kontrol için aşağıdaki statu rakamları için
kontrol konulabilmektedir.
MdStatus : 0 -> 3D Secure kod geçersiz veya girilmedir.
MdStatus : 1 -> Başarılı işlem.
MdStatus : 7 -> Hatalı işlem.
Gizli / Kişisel Veri
27
VISA, MASTERCARD ve TROY için otorizasyon mesajında ECI’nin belirlenmesi ve CAVV gönderim koşulları
sırasıyla, aşağıdaki tablolarda belirtilmiştir.
ECI ve CAVV Değerlerinin Belirlenmesi (VISA)
Status Değeri Otorizasyonda Kullanılacak
ECI
Üye İşyeri Aksiyonu
Y 05 Otorizasyon mesajına ECI ve CAVV bilgilerini yerleştirerek işleme Full Secure
olarak devam et
A 06 Otorizasyon akışını durdur veya Half Secure Ödeme almak için Otorizasyon
mesajına ECI ve CAVV bilgilerini yerleştirerek işleme devam et
U 07 Otorizasyon akışını durdur veya İşleme Non Secure olarak devam et. İşlemi
sonlandırmanız tavsiye edilir.
E - Otorizasyon akışını durdur!
N - Otorizasyon akışını durdur!
ECI ve CAVV Değerlerinin Belirlenmesi (MASTERCARD)
Status Değeri Otorizasyonda Kullanılacak
Eci
Üye İşyeri Aksiyonu
Y 02 Otorizasyon mesajına ECI ve CAVV bilgilerini yerleştirerek işleme İşleme Full
Secure olarak devam et
A 01 Otorizasyon akışını durdur veya Half Secure Ödeme almak için Otorizasyon
mesajına ECI ve CAVV bilgilerini yerleştirerek işleme devam et
U 00 Otorizasyon akışını durdur veya İşleme Non Secure olarak devam et.
İşlemi sonlandırmanız tavsiye edilir.
E - Otorizasyon akışını durdur!
N - Otorizasyon akışını durdur!
ECI ve CAVV Değerlerinin Belirlenmesi (TROY)
Status Değeri Otorizasyonda Kullanılacak
Eci
Üye İşyeri Aksiyonu
Y 02 Otorizasyon mesajına ECI ve CAVV bilgilerini yerleştirerek işleme devam et
A 01 Otorizasyon akışını durdur veya Half Secure Ödeme almak için Otorizasyon
mesajına ECI ve CAVV bilgilerini yerleştirerek işleme devam et
U 00 Otorizasyon akışını durdur veya İşleme Non Secure olarak devam et.
İşlemi sonlandırmanız tavsiye edilir.
E - Otorizasyon akışını durdur!
N - Otorizasyon akışını durdur!
Gizli / Kişisel Veri
28
5.3 HASH HESAPLAMA
Üye işyerlerimiz tarafından daha güvenli bir işleme olanak sağlanması adına; doğrulama aşaması bitiminde işlem
kontrolü için aşağıdaki parametreler sıralı olacak şekilde hash hesaplanabilirmaktadır. Bankamız sistemi tarafından
iletilen response’ta hash değeri ile karşılaştırma yapılarak cevabın Bankamızdan geldiği doğrulanabilecektir.
Hash Hesaplama Parametreleri :
VerifyEnrollmentRequestId
MerchantId
Currency
Amount (“.” kullanılmadan küsurat dahil; örneğin 1.09 için 109 iletilmelidir)
Hashkey*
*1q2w3eASD
Yukarıdaki parametrelerin birleştirilerek oluşturulmasından sonra önce ISO-8859-9 karakter setine göre byte dizisine
çevrilmelidir.
Sonrasında sha256 dizine çevrilmelidir. Ardından bu sha256 dizisi de base64 ile stringe çevrilmelidir.
vereq+üyeno+currencycode+amount+pareshaskey
Kod örnekleri :
C# :
private string Hash(string value)
{
 System.Security.Cryptography.SHA256 sha = new
System.Security.Cryptography.SHA256CryptoServiceProvider();
 byte[] hashbytes = System.Text.Encoding.GetEncoding("ISO-8859-9").GetBytes(value);
 byte[] inputbytes = sha.ComputeHash(hashbytes);
 string hashedString = Convert.ToBase64String(inputbytes);
 return hashedString;
}
Php :
function hashValue($value) {
 $hashBytes = mb_convert_encoding($value, "ISO-8859-9", "UTF-8");
 $hashed = hash("sha256", $hashBytes, true);
 $base64String = base64_encode($hashed);
 return $base64String;
}
Python :
def hash_value(value):
 hash_bytes = value.encode('ISO-8859-9') # Encode the string in ISO-8859-9
 sha = hashlib.sha256()
 sha.update(hash_bytes)
 hashed_bytes = sha.digest()
 base64_string = base64.b64encode(hashed_bytes).decode('utf-8')
 return base64_string
Java:
import java.nio.charset.StandardCharsets;
import java.security.MessageDigest;
import java.util.Base64;
public class HashUtil {
 public static String hashValue(String value) throws Exception {
 byte[] hashBytes = value.getBytes("ISO-8859-9");
 MessageDigest sha = MessageDigest.getInstance("SHA-256");
 byte[] hashedBytes = sha.digest(hashBytes);
 String base64String = Base64.getEncoder().encodeToString(hashedBytes);
 return base64String;
 }
}
Gizli / Kişisel Veri
29
5.4 SANAL POS PROVİZYON AŞAMASI
İşlemin finansallaştırıldığı aşamadır. Alışveriş sitesi kullanıcılarının seçtikleri ürünlerin tutarı ile sitede
girdikleri kart bilgilerinin, Sanal POS uygulamasına gönderilmesiyle satış işlemi provizyonu başlatılır. Sanal
POS da gerekli bilgileri hazırlayarak ilgili bankaya iletir ve girilen bilgilerin geçerliliğine göre olumlu ya da
olumsuz cevap döndürür.
Sanal POS istekleri 2 şekilde yapılabilmektedir:
• POX Request Yöntemi ile: bu yöntemde gönderilmek istenen işlem için xml formatında mesaj
oluşturulur ve ilgili adrese prmtstr parametresine oluşturulan bu xml set edilerek, HTTP POST isteği
gönderilir.
• Web Servis Çağrısı ile: bu yöntemde ilgili servis adres wsdl ı projeye eklenir ve bu servisin
ExecuteVposRequest Web Metoduna ihtiyaç duyulan parametreler set edilerek, standart Web servis
çağrısı yapılır.
Sanal POS servis URL bilgisi aşağıdaki tabloda yer almaktadır.
Test Adresi Production Adresi
ServisUrl
(POX Request)
https://onlineodemetest.vakifbank.com.tr:44
43/VposService/v3/Vposreq.aspx
https://onlineodeme.vakifbank.com.tr:4443/Vp
osService/v3/Vposreq.aspx
ServisUrl
(Web Service)
https://onlineodemetest.vakifbank.com.tr:44
43/VposService/TransactionServices.asmx
https://onlineodeme.vakifbank.com.tr:4443/Vp
osService/TransactionServices.asmx
Sanal POS uygulamasında yapılan işlemlere dair genel kurallar aşağıdaki gibidir:
• Internet ortamında gönderilen işlemler, HTTPS (128 bit SSL) bağlantı üzerinden iletilmek zorundadır.
• Sanal POS sistemine gönderilen her işlem farklı bir işlem numarası (TransactionId) içermelidir. Bu
işlem numarası ile ilgili işleminin sonucu sorgulanmakta ve bu numara, referanslı işlemlerde (iptal,
iade ve ön provizyon kapama) işlemlerinde referans olarak kullanılmaktadır. UIY tarafından, işlem
numarası gönderilmediği takdirde sistem tarafından otomatik olarak bir işlem numarası atanmakta ve
UIY’ne cevap olarak dönülmektedir.
• Üye işyeri XML mesajında gönderilmesi gereken işlem alanlarının tutarlı olması ve XML formatına
uygun gönderilmesi zorunludur.
• Sanal POS üzerinde işlemler online olarak gerçekleştirilir ve cevabı anında üye işyerine iletilir. Internet
hatlarındaki kopukluklar ve benzer aksaklıklar yüzünden cevabı alınamayan işlemler, üye işyeri
tarafından sorgulanmalı ve gerekli iptal işlemleri yapılmalıdır.
• Sanal POS sistemi tarafından döndürülen cevaplar da XML formatında olacaktır.
• Sanal POS sisteminde gün sonu işlemleri otomatik yapılır. ÜİY’nin günü kapatmak ya da başlatmak
için herhangi bir işlem yapmasına gerek yoktur. İstenirse, manuel gün sonu kapatma gerçekleştirebilir.
• Sanal POS sisteminden işlem cevabı olarak dönülen işlem numarası (TransactionId), ÜİY tarafından
mutlaka saklanmalıdır. Bu numara, ilgili işlemin iptali ve sorgulanması sırasında kullanılmaktadır.
• ÜİY, Sanal POS sistemine, herhangi bir işlemde işleme dair bir sipariş numarası göndermek istiyor
ise bu bilgileri “OrderId” altında gönderebilir. Aynı OrderId bilgisine sahip sadece ve sadece 1 adet
başarılı işlem bulunabilir. Belli bir sipariş numarası ile 1 adet başarılı işlem geçilmiş ise, mükerrerliği
önlemek adına, aynı işlem numarası ile ikinci bir satış geldiği takdirde bu işlem, başarısız olarak
cevaplanmaktadır. Öte yandan, belli bir sipariş numarası ile geçilen işlemler başarısız cevap almış
ise, aynı sipariş numarası ile yeni işlemler gönderilebilmektedir.
Gizli / Kişisel Veri
30
• ÜİY, Sanal POS sisteminde yetkisi daihilinde aşağıdaki işlem tiplerini gerçekleştirebilir.
➢ Sale: Kartlardan peşin ve taksitli satış işleminde kullanılır. İptal (Cancel) veya İade/Kısmi
İade(Refund) edilebilir.
➢ Auth: Kart üzerinde belirtilen tutarın bloke edilmesini sağlayan işlem tipidir. İptal (Cancel) veya
Kapama (Capture) gerçekleştirilebilir.
➢ CardTest: Kredi kartının geçerliliğinin kontrolü için gerçekleştirilen işlem tipidir. Karttan 1.01
TL’lik bir provizyon alınır ve otomatik iptali sağlanır.
➢ CampaignSearch: Üye işyerinde tanımlı kampanya bilgilerini sorgulamak için
kullanılmaktadır. Örneğin, + taksit kampanya tanımı veya taksit öteleme gibi üye işyeri
üzerinde tnaımlı kampanyalar sorgulanabilir.
➢ VFTSearch: Müşteri kartından vade farklı taksitli işlem sorgulamak için kullanılmaktadır.
➢ VFTSale: Müşteri kredi kartından vade farklı taksitli tahsilat yapmak için kullanılmaktadır. İptal
(Cancel) veya İade (Refund) edilebilir.
➢ TKSale: Tarım kart ile eşit taksitli (kampanyalı) işlem yapılmasını sağlayan işlem tipidir.
➢ TKFlexSale: Tarım kart ile esnek taksitli işlem yapılmasını sağlayan işlem tipidir.
➢ TKLimitSearch: Tarım Kartın hangi ana bayiler için ne kadar limiti olduğunu sorgulayan işlem
tipidir.
➢ TKPlanSearch: Tarım Kart üye işyerinin sahip olduğu eşit taksitli çalışma şablonunu sorgular.
➢ PointSearch: Müşteri kredi kartındaki puan bilgilerini sorgulamak için kullanılmaktadır.
➢ PointSale: Müşterinin kartında bulunan puan ile ödme yapması sağlanır. İptal (Cancel) veya
İade (Refund) edilebilir.
➢ Cancel: Gün sonu gerçekleşmemiş finansal işlemlerin iptali için kullanılmaktadır.
➢ Refund: Gün sonu gerçekleşmiş finansal işlemlerin iadesi için kullanılmaktadır. İptal (Cancel)
edilebilir.
➢ Capture: Karta ön provizyonda koyulan blokajın finansallaştırılması sağlanır.İade (Refund)
edilebilir.
➢ Reversal: VPOS 7/24 ten herhangibir cevap alınamaması durumunda gönderilen işlemin geri
alınması amacıyla teknik iptal mesajı gönderilir. Sadece finansal işlemlerin teknik iptali olabilir.
Gizli / Kişisel Veri
31
VPOS 7/24 e iletilecek Xml Şeması
XML alan adı Açıklama Alan biçimi
ve Uzunluğu
Alabileceği değer
VposRequest İşlem bilgileri bölümü - -
TransactionType İşlem adı bilgisi Boşluk içermemelidir. - Sale -> Satış/Taksitli Satış
Cancel -> İptal
Refund -> İade
Auth -> Ön Prov.
Capture -> Ön Prov. Kapama
Reversal -> Teknik İptal
CampaignSearch
BatchClosedSuccessSearch
SurchargeSearch
VFTSale -> Vade Farklı Satış
VFTSearch -> Vade Farklı Sorgu
TKSale -> Tarım Kart Eşit Taksitli
Satış
TKFlexSale -> Tarım Kart Esnek
Taksitli Satış
PointSale -> Puan harcama
PointSearch -> Puan Sorgu
CardTest -> Kart Kontrol
MerchantId Üye işyeri numarası Alfanumerik-15 -
Password Üye işyeri Api şifresi Alfanumerik +
Sembol
TransactionId Benzesiz (Unique) İşlem numara bilgisi Alfanumerik-40
TerminalNo İşlemin hangi terminal üzerinden gönderileceği bilgisi Alfanumerik-8 ÜİY için tanımlanmış mevcut
terminallerden herhangi birinin
terminal numarası iletilmelidir. Ör:
VB007000,…
CurrencyAmount İşlem tutar bilgisi Sayısal(kuruş
hariç maks 10
basamaklı
olabilir.)
Örnek: 55.00 ya da 145.34
SurchargeAmount Surchargelı işlem tutar bilgisidir. Surcharge
uygulanmayacak işlemler için istek mesajında yer
almamalıdır.
Sayısal (son iki
hane kuruş
olacak şekilde
“.” sız.)
Örnek: 500 ya da 14534
CurrencyCode İşlem kur bilgisi (TL = 949) Sayısal –
Tamsayı - 3
TL=949
USD=840
EUR=978
JPY=392
GBP=826
PointAmount Puan tutarı Sayısal Örnek: 55.00 ya da 145.34
PointCode Puan birimi Sayısal TL = 949
NumberOfInstallments İşlem taksit sayısı
Boş veya 0 gönderilmemelidir. Aksi takdirde hatalı
taksit sayısı hatası alınacaktır. Taksitli ödemelerde en
az 2 ile başlamalıdır.
Sayısal – Tam
sayı – 2
Örnek: 1, 2, 12, vb...
BrandName Kredi kartı kart kuruluşu bilgisi Sayısal 100: Visa
200: MasterCard
300: Troy
400: Amex
Pan Kredi kart numarası bilgisi Sayısal–15-22 Örnek: 45436001****0712
Expiry Kredi kartı son kullanma tarihi bilgisi Sayısal–6 YYYYMM
Cvv Kredi kartı güvenlik kodu bilgisi Sayısal–3 Örnek: 544
SecurityCode AMEX kartların ön yüzünde bulunan güvenlik
numarasıdır
Sayısal-4 Örnek:9456
ReferenceTransactionId Orjinal işlem üye işyeri işlem numarası bilgisi Alfanumerik–40
CardHoldersName Kart sahibinin adı Alfanumerik–
100
ClientIp İşlemi yapan son kullanıcının IP si Üye iş yeri
tarafından alınıp sanal posa gönderilecektir
Alfanumerik–15 Örnek: 78.155.195.43
OrderId Sipariş numarası işlem başarılı olana kadar aynı
sipariş numarası sisteme gönderilebilir(UyeRefNo)
Alfanumerik–40
+ Sembol
Gizli / Kişisel Veri
32
XML alan adı Açıklama Alan biçimi
ve Uzunluğu
Alabileceği değer
OrderDescription Sipariş ile ilgili varsa detaylı açıklama Alfanumerik2000 + Sembol
RecurringFrequencyType İşlemin hangi periyod tipinde tekrarlanacağı bilgisini
içerir
AlfanumerikSabit
Day, (Günlük tekrarlama)
Month, (Aylık tekrarlama)
Year (Yıllık tekrarlama)
RecurringFrequency İşlemin ne kadar sürede bir tekrarlanacağı bu alanda
belirtilir. RecurringFrequencyType ile birlikte bir anlam
ifade eder
Sayısal
RecurringInstallmentCount Recurring işlemin toplamda kaç kere tekrar edeceği
bilgisini içerir
Sayısal
CAVV MPI tarafından 3D Secure işlemin sonucunda
gönderilen alan
Alfanumerik- 28
+ Sembol
TAVV Visa Token Requestor işyerleri tarafından
gönderilebilen token.
Alfanumerik- 28
+ Sembol
ECI 3D secure işlemin sonucu Sayısal Visa:05,06,07
MasterCard:01,02,03
Troy:01,02,03
CustomItems Üye işyeri tarafından işleme ait ek bilgiler varsa
CustomItems alanında gönderilir. İçeriğinde “Item”
listesi vardır
Complex {,} ve : karakterlerinin VPOS
tarafında özel anlamı olduğundan
bu karakterlerin kullanılmaması
gerekiyor.
Item İşleme ait özel bilgiler içerir. İçeriğinde “name” ve
“value” attirbutelarını barındırır
Complex-500
DeviceType Raporlama amacıyla işlemin hangi kaynaktan
gönderildiği bilgisi
Sayısal 1: Android
2: IOS
3: Windows
Extract Bu alanda gönderilecek değer kart hamili ektresinde
işlem açıklamasında çıkacaktır. (Abone no vb. bilgiler
gönderilebilir)
Alfanumerik-40
ExpSign BKM Express İşlem Numarası Alfanumerik-40
MpiTransactionId İşlemin Mpi tarafındaki TransactionId numarası. Bu
değer VPOS tarafından işlemin 3d bilgilerini kontrol
etmek için kullanılır.
Enrollment (VEReq) isteği sırasında iletilen tekil
VerifyEnrollmentRequestId değeri, sanal POS a
istek iletilirken, MpiTransactionId alanına
setlenmelidir.
Alfanumerik-40 3D Secure aşamasında gönderilen
VerifyEnrollmentRequest değeri
bu alana setlenmelidir.
Location Raporlama amacıyla, işlemin gönderildiği yer bilgisi Sayısal 1:internet
2:Telefon
3:Mobile
4:Kurum muhasebe/erp sistemi
6:Kiosk
7:Diğer
TransactionDeviceSource İşlemin MailOrder ya da ECommerce olduğu belirtilir.
Tüm provizyon isteklerinde gönderilmesi zorunludur.
MailOrder işlem yetkiye bağlıdır ve işlem yetkisi
yoksa sanalpos tarafından işlem reddeilecektir.
MailOrder isteklerde ECI ve CAVV değerleri
gönderilmemelidir. ECI ve CAVV değeri sadece 3D
ECommerce işlemlerde gönderilmelidir.
Sayısal 0:ECommerce
1:MailOrder
MerchantType Üye İşyeri tipi. Banka tarafından Üye işyerine
iletilmektedir. Üye işyeri için sabit bir değerdir. Tüm
isteklerde, bu değer kullanılmalıdır. Kullanılmaması
durumunda 0-Standart işyeri değeri olarak işleme
alınır. Ana bayi ve alt bayiler için gönderimi
zorunludur.
Sayısal 0: Standart İşyeri
1: Ana Bayi
2: Alt Bayi
HostSubMerchantId Alt bayi numarası. Banka tarafından üye işyerine
iletilmektedir. tüm isteklerde, üye işyeri kendisine
iletilen bu değeri kullanmalıdır
Alfanumerik-15 Örnek: 00000000000471
Identity PF ve bayi yapısıyla çalışan VKN/TCKN ile ödeme
almak isteyen üye işyerlerinin provizyon aşamasında
göndermeleri gereken parametredir. VKN İÇİN 10
haneli, TCKN için 11 hanelidir.
Alfanumeric
VKN:10 haneli
TCKN:11 haneli
Örnek:
VKN:1234567890
TCKN:1123456789
Gizli / Kişisel Veri
33
XML alan adı Açıklama Alan biçimi
ve Uzunluğu
Alabileceği değer
CustomInstallments Tarım Kart işlemlerde taksit bilgilerini göndermek için
kullanılır. Eşit taksitli işlemde “MaturityPeriod” ve
“Frequency” alt parametrelerini içerirken, Esnek
taksitli İşlemde “Item” listesini içinde barındırmalıdır.
MaturityPeriod Tarım Kart Eşit Taksitli işlem için ödemenin
yapılacağı vadeyi ifade eder.
Sayısal Örnek: 8
Frequency Tarım Kart Eşit Taksitli işlemlerde ödeme sıklığını
ifade eder.
Sayısal Örnek: 4
Item Tarım Kart Esnek Taksitli işlemlere özel bilgiler içerir.
İçeriğinde “date” ve “amount” attirbutelarını barındırır.
“date” attirbuteunun formatı YYYYAAGG
“amount” attirbuteunun formatı tutar tipindedir.
Complex Örnek:
<CustomInstallment
date="20200201"
amount="90.00"/>
Gizli / Kişisel Veri
34
VPOS 7/24 tarafından cevap olarak gönderilen XML Şeması
XML alan adı Açıklama Alan biçimi ve
Uzunluğu
Alabileceği değer
VposResponse İşlem bilgileri bölümü - -
TransactionType Requestte gönderilen
TransactionType geri
gönderilecektir.
- Sale -> Satış/Taksitli Satış
Cancel -> İptal
Refund -> İade
Auth -> Ön Prov.
Capture -> Ön Prov. Kapama
Reversal -> Teknik İptal
CampaignSearch
BatchClosedSuccessSearch
VFTSale -> Vade Farklı Satış
VFTSearch -> Vade Farklı Sorgu
TKSale -> Tarım Kart Eşit Taksitli Satış
TKFlexSale -> Tarım Kart Esnek Taksitli
Satış
PointSale -> Puan harcama
PointSearch -> Puan Sorgu
CardTest -> Kart Kontrol
MerchantId Requestte gönderilen MerchantId
geri gönderilecektir.
Alfanumerik-15 -
TransactionId Requestte gönderilen
TransactionId gönderilmediyse
Sanal Pos tarafından oluşturulan
TransactionId geri gönderilecektir.
Alfanumerik-40
ReferenceTransactionId Requestte gönderilen
ReferenceTransactionId geri
gönderilecektir.
Alfanumerik–40 Request işlemi sonucunda dönen Id
değeri
ResultCode İşlemin sonucu Alfanumerik-4 Başarılı :0000, Başarısız :1105 v.b.
ResultDetail İşlemin sonucuna ilgili varsa detaylı
bilgi
Alfanumerik- 100
AuthCode Banka tarafından işlemin
cevabında dönülen kod
Alfanumerik-50
HostDate İşlemin banka tarafında gördüğü
tarih ve saat bilgisini içerir
Alfanumerik-14 yyyymmddhhmmss
(20220427134503)
formatında olacaktır
Rrn İşlemin bank tarafındaki referans
numarası
Alfanumerik-12
CustomItems Sanal pos tarafından işleme ait ek
bilgiler varsa CustomItems
alanında gönderilir. İçeriğinde
“Items” listesi vardır
Complex
Item İşleme ait özel bilgiler içerir.
İçeriğinde “name” ve “value”
attirbutelarını barındırır
Complex
Name İşleme ait özel bilginin adı Alfanumerik CustomMessage
MaxiPoint
MilPoint
TotalMaxiPoint
TotalMilPoint
InstallmentTransactionAmount
DiscountedAmount
Value İşleme ait özel bilginin değerini
içerir
Alfanumerikdegişken
NumberOfInstallments İşlemin taksit sayısı Sayısal – tam Sayı - 2 02,04,07,12 v.b.
CurrencyAmount İşlem Tutarı Sayısal 12.23
TLAmoıunt İşlemin TL Tutarı. Yabancı para
birimi ile yapılan tahsilatların,
geçerli kura göre, hesaplanan TL
Tutar karşılığıdır.
Sayısal 12.23
VftAmount Vade Farklı Tutar Sayısal
SurchargeAmount Surcharge tutarı Sayısal
CurrencyCode Param birimi Sayısal – 3 TL:949 v.b.
Gizli / Kişisel Veri
35
XML alan adı Açıklama Alan biçimi ve
Uzunluğu
Alabileceği değer
InstallmentTable İşlem sonucunda bir taksit
hesaplaması yapılırsa taksit
tablosu bu alanda geri
dönülecektir “InstallmentItem“
listesi barındırır
Complex
InstallmentItem Taksit tablosuna ait bilgileri içerir.
İçeriğinde “Date”, “Amount”
attribute larını barındırır
Complex
Date Taksite ait tarih bilgisini içerir Alfanumerik-8 yyyymmdd
IsSurcharge İletilen işlem, Surcharge
operasyonuna uğrayıp uğramadığı
bilgisi
Sayısal 1: Surcharge’lı İşlem ise,
ThreeDSecureType 3D Secure işlem tipi Sayısal NonSecure = 1,
 Secure = 2,
 HalfSecure = 3
CampaignTable Kampanya bilgisi Alfa numerik
GainedPoint İşlem sonucunda kazanılan puan
bilgisi
Sayısal
TotalPoint İşlem sonucunda kalan puan
bilgisi
Sayısal
Gizli / Kişisel Veri
36
İŞLEM İSTEK MESAJ PARAMETRELERİ ZORUNLULUK TABLOSU
XML ALAN ADI
VPOS Request
Sale (Normal işl)
Sale (3d Secure)
Auth
Capture
PointSale
VFTSale
CardTest
TKSale
TKFlexSale
VFTSearch
PointSearch
CampaignSearch
TKLimitSearch
TKPlanSearch
Refund
Cancel
Reversal
TrancactionType Z Z Z Z Z Z Z Z Z Z Z Z Z Z Z Z Z
MerchantId Z Z Z Z Z Z Z Z Z Z Z Z Z Z Z Z Z
TerminalNo Z Z Z O Z Z Z Z Z Z Z Z Z Z O O Z
Pasword Z Z Z Z Z Z Z Z Z Z Z Z Z Z Z Z Z
TransactionID O O O O O O O O O O O O O O O O O
Pan Z Z Z X Z Z Z Z Z Z Z X Z Z X X X
Expiry Z Z Z X Z Z Z Z Z Z Z X Z Z X X X
CVV / SecurityCode O O O X O O O O O O O X O O X X X
CurrencyAmount Z Z Z Z X Z X Z Z Z X X X X Z X X
CurrencyCode Z Z Z X X Z X Z Z Z X X X X X X X
NumberOfInstallments O O O X X Z X X Z O X X X X X X X
InstallmentCount O O O X X Z X X Z O X X X X X X X
BrandName O O O X O O O O O O O X O O X X X
ECI X Z O X O O O O O X X X X X X X X
CAVV X Z O X O O O O O X X X X X X X X
TAVV O O O X O O O X X X X X X X X X X
MpiTransactionId X Z O X O O O O O X X X X X X X X
PointAmount X X X X Z X X X X X X X X X O X X
PointCode X X X X Z X X X X X X X X X O X X
OrderId O O O O O O O O O O O X O O O O X
ReferenceTranscationId X X X Z X X X X X X X X X X Z Z Z
ExpSign O O O X O O O O O X X X X X O X X
Extract O O O X O O O O O X X X X X O X X
CardHoldersName O O O X O O O O O X X X X X O O X
OrderDescription O O O X O O O O O X X X X X O O O
CustomItems O O O X O O O O O X X X X X O O O
ClientIp Z Z Z Z Z Z Z Z Z Z Z X Z Z Z Z Z
DeviceType O O O X O O O O O O O X O O O O X
Location O O O X O O O O O O O X O O O O X
TransactionDeviceSource Z Z Z X Z Z Z Z Z X X X Z Z X X X
MaturityPeriod X X X X X X X Z X X X X X X X X X
Frequency X X X X X X X Z X X X X X X X X X
CustomInstallment O O X X X X X X Z X X X X X X X X
Identity O O X X X X X X X X X X X X O O X
Dikkat! Tabloda yer alan kısaltmaların anlamı aşağıdaki gibidir.
Z: Zorunlu
O: Opsiyonel
K: Koşullu
X: Mesajda olmamalı
Gizli / Kişisel Veri
37
5.4.1 Peşin / Taksitli Satış İşlemi (Sale)
5.4.1.1 3D Secure (Full Secure) İşlem
• TransactionType değeri, Peşin ve Taksitli Satış işlemleri için “Sale” olarak gönderilmelidir.
• Her başarılı satış işleminde farklı bir TransactionId kullanılmalıdır.
• ECI: İşlem için ACS’in ürettiği elektronik ticaret belirteci provizyon mesajına eklenmelidir. ACS
tarafından oluşturulan kart sahibi kimlik doğrulama “Status” sonucu: Y ise Visa için 05, MasterCard
ve Troy için 02 değerlerini alır.
• CAVV: ACS tarafından üretilen 28 byte büyüklüğünde kart sahibi doğrulama değeri provizyon
mesajına yazılmalıdır.
• MpiTransactionId: Enrollment (VEReq) isteği sırasında iletilen tekil VerifyEnrollmentRequestId
değeri, sanal POS a istek iletilirken, MpiTransactionId alanına mutlaka setlenmelidir.
• İşlem taksitli olacaksa provizyon istek mesajında “NumberOfInstallments” parametresi ve değeri yer
almalıdır.
• “TransactionDeviceSource” değeri 3D Secure bir işlemde “0” olmalıdır.
5.4.1.1.1 3D Secure Provizyon İsteği
<?xml version="1.0" encoding="utf-8"?>
<VposRequest>
<MerchantId>***************</MerchantId>
<Password>********</Password>
<TerminalNo>********</TerminalNo>
 <Pan> 4289450189088488</Pan>
 <Expiry>202304</Expiry>
 <CurrencyAmount>10.00</CurrencyAmount>
 <CurrencyCode>949</CurrencyCode>
<TransactionType>Sale</TransactionType> → Finansal işlem için gönderilecek işlem
tipleri Sale: Satış, Auth: Ön Provizyon, PointSale:Puan Harcama, VFTSale: Vade Farklı
Taksitli Satış
<TransactionId> b2d71cc5-d242-4b01-8479-d56eb8f74d7c</TransactionId>→opsiyonel
 <NumberOfInstallments>5</NumberOfInstallments>→ Opsiyonel. Boş, 0 ve 1
gönderilmemelidir. 02 ve üstü değer gönderilmelidir.
<CardHoldersName>İlyas KOVALAR</CardHoldersName> →opsiyonel
<Cvv>454</Cvv>
<ECI>05</ECI>işlem 3Dveya Half Secure ise zorunludur. TransactionDeviceSource 1 ise
mesajda olmamalıdır)
<CAVV> AAABCYaRIwAAAVQ1gpEjAAAAAAA=</CAVV>(işlem 3D ise zorunludur.
TransactionDeviceSource 1 ise mesajda olmamalıdır)
<MpiTransactionId>5d6b951b06fa043379458dc835b71d0c8</MpiTransactionId>
TransactionDeviceSource 0 ve işlem 3D ise zorunludur. TransactionDeviceSource 1 ise
mesajda olmamalıdır)
<OrderId>sanalpostest_27042022</OrderId>→opsiyonel
<OrderDescription>Bu bir bilet satışı işlemidir</OrderDescription> →opsiyonel
<ClientIp>190.20.13.12</ClientIp>
 <CustomItems> →opsiyonel
 <Item name="İsim" value="İLYAS" />
 <Item name="Soyisim" value="KOVALAR" />
 <Item name="Açıklama" value="EĞİTİM ÜCRETİ" />
</CustomItems>
<TransactionDeviceSource>0</TransactionDeviceSource>→ECommerce
<DeviceType>3</DeviceType> →opsiyonel
<Location>1</Location> →opsiyonel
</VposRequest>
*Opsiyonel olarak belirtilmeyen tüm alanların gönderilmesi zorunludur.
Gizli / Kişisel Veri
38
5.4.1.1.2 3D Secure Provizyon Cevabı
<?xml version="1.0" encoding="utf-8"?>
<VposResponse>
<MerchantId>***************</MerchantId>
<TransactionType>Sale</TransactionType>
<TransactionId>b2d71cc5-d242-4b01-8479-d56eb8f74d7c</TransactionId>
<OrderId>z2d71cc5-d242-4b01-8479-d56eb8f74d7c</OrderId>
<ResultCode>0000</ResultCode>
<ResultDetail>İŞLEM BAŞARILI</ResultDetail>
<AuthCode>11234</AuthCode>
<HostDate>175017</HostDate>
<Rrn>201101240006</Rrn>
<CurrencyAmount>10.50</CurrencyAmount>
<CurrencyCode>949</CurrencyCode>
<ThreeDSecureType>2</ThreeDSecureType>
<GainedPoint>0</GainedPoint>
<TotalPoint>100</TotalPoint>
<BatchNo>86</BatchNo>
 <TLAmount>10.50</TLAmount>
</VposResponse>
Sonuç mesajında dönen ResultCode ve ResultDetail alanlarına göre yorumlama yapılmalıdır.
5.4.1.2 Yarım 3D Secure (Half Secure) İşlem
PARes Kart Doğrulama Cevabı “A” olması durumunda bu akışa geçilmelidir.
• ECI: Half Secure olarak, Sanal POS sistemine iletilecek satış isteklerinde, ECI değeri ; VISA markalı
bir kart ise 06; MASTERCARD markalı bir kart ise 01 olarak gönderilmelidir.
• CAVV: Status alan içeriği “A” ise, CAVV bilgisi otorizasyon mesajına yerleştirilmelidir.
• MpiTransactionId: Enrollment (VEReq) isteği sırasında iletilen tekil VerifyEnrollmentRequestId
değeri, sanal POS a istek iletilirken, MpiTransactionId alanına setlenmelidir.
• Kart ve tutar bilgilerinin (Pan, Expiry, CurrencyAmount, CurrencyCode) provizyon mesajında yeniden
yer almasına gerek yoktur.
5.4.1.2.1 Half Secure İşlem Örnek XML Provizyon İstek Mesajı
<?xml version="1.0" encoding="utf-8"?>
<VposRequest>
<MerchantId>******</MerchantId>
<Password>******</Password>
<TerminalNo>******</TerminalNo>
<TransactionType>Sale</TransactionType>
<TransactionId> b2d71cc5-d242-4b01-8479-d56eb8f74d7c</TransactionId>
<Cvv>***</Cvv>
<ECI>**</ECI>
<CAVV></CAVV> → Status alan içeriği “A” ise, CAVV bilgisi otorizasyon mesajına
yerleştirilmelidir.
<MpiTransactionId>5d6b951b06fa043379458dc835b71d0c8</MpiTransactionId>
<OrderId>z2d71cc5-d242-4b01-8479-d56eb8f74d7c</OrderId> → opsiyonel
<ClientIp>190.20.13.12</ClientIp>
 <CustomItems> →opsiyonel
 <Item name="İsim" value="İLYAS" />
 <Item name="Soyisim" value="KOVALAR" />
 <Item name="Açıklama" value="EĞİTİM ÜCRETİ" />
</CustomItems>
<TransactionDeviceSource>0</TransactionDeviceSource> → ECommerce
</VposRequest>
Gizli / Kişisel Veri
39
5.4.1.2.2 Half Secure İşlem Örnek XML Provizyon Cevap Mesajı
<?xml version="1.0" encoding="utf-8"?>
<VposResponse>
<MerchantId>******</MerchantId>
<TransactionType>Sale</TransactionType>
<TransactionId>b2d71cc5-d242-4b01-8479-d56eb8f74d7c</TransactionId>
<OrderId>z2d71cc5-d242-4b01-8479-d56eb8f74d7c</OrderId>
<ResultCode>0000</ResultCode>
<ResultDetail>İŞLEM BAŞARILI</ResultDetail>
<AuthCode>11234</AuthCode>
<HostDate>175017</HostDate>
<Rrn>201101240006</Rrn>
<CurrencyAmount>10.50</CurrencyAmount>
<CurrencyCode>949</CurrencyCode>
<ThreeDSecureType>3</ThreeDSecureType>
<GainedPoint>0</GainedPoint>
<TotalPoint>100</TotalPoint>
<BatchNo>86</BatchNo>
 <TLAmount>10.50</TLAmount>
</VposResponse>
5.4.1.3 Normal İşlem - Non Secure Örnek XML Provizyon İstek Mesajı
• İşlem 3D Secure olmayacaksa işlem doğrudan bu aşamadan başlamalıdır. Normal İşlem (Non
Secure) olacak işlemin istek mesajında ECI, CAVV ve MpiTransactionId yer almamalıdır.
• TransactionType değeri, Satış ve Taksitli Satış işlemleri için “Sale” olarak gönderilmelidir.
• İşlem taksitli olacaksa provizyon istek mesajında “NumberOfInstallments” parametresi ve değeri yer
almalıdır. Üye işyeri çalışma şartlarına göre Taksit sayısı 2 ve üstü bir değer gönderilmelidir.
• “TransactionDeviceSource” değeri,
o E-Ticaret işlemleri için “0”,
o Mail Order işlem için “1”
olarak gönderilmelidir.
5.4.1.3.1 Normal İşlem (Non Secure) Örnek XML Provizyon İstek Mesajı
<?xml version="1.0" encoding="utf-8"?>
<VposRequest>
<MerchantId>***************</MerchantId>
<Password>********</Password>
<TerminalNo>********</TerminalNo>
<TransactionType>Sale</TransactionType>
<TransactionId>VPOSTEST_27042022</TransactionId>
<CurrencyAmount>12.23</CurrencyAmount>
<CurrencyCode>949</CurrencyCode>
<Pan>41197901****4284</Pan>
<Cvv>***</Cvv>
<Expiry>******</Expiry>
<ClientIp>1.1.1.1</ClientIp>
<TransactionDeviceSource>0</TransactionDeviceSource>
<CustomItems>
<Item name="İsim" value="İLYAS" />
<Item name="Soyisim" value="KOVALAR" />
<Item name="Açıklama" value="EĞİTİM ÜCRETİ" />
</CustomItems>
</VposRequest>
Gizli / Kişisel Veri
40
5.4.1.3.2 Normal İşlem (Non Secure) Örnek XML Provizyon Cevap Mesajı
<?xml version="1.0" encoding="utf-8"?>
<VposResponse>
 <MerchantId>***************</MerchantId>
 <TransactionType>Sale</TransactionType>
 <TransactionId>VPOS_27042022</TransactionId>
 <ResultCode>0000</ResultCode>
 <ResultDetail>İŞLEM BAŞARILI</ResultDetail>
 <CustomItems>
 <Item name="İsim" value="İLYAS" customType="Text" />
 <Item name="Soyisim" value="KOVALAR" customType="Text" />
 <Item name="Açıklama" value="EĞİTİM ÜCRETİ" customType="Text" />
 </CustomItems>
 <InstallmentTable />
 <CampaignResult />
 <AuthCode>963994</AuthCode>
 <HostDate>20220427141224</HostDate>
 <Rrn>211714859000</Rrn>
 <TerminalNo>VP000265</TerminalNo>
 <TotalPoint>59146.81</TotalPoint>
 <CurrencyAmount>12.23</CurrencyAmount>
 <CurrencyCode>949</CurrencyCode>
 <ThreeDSecureType>1</ThreeDSecureType>
 <TransactionDeviceSource>0</TransactionDeviceSource>
 <BatchNo>187</BatchNo>
 <TLAmount>12.23</TLAmount>
</VposResponse>
5.4.2 Vade Farklı Taksitli Satış İşlemi
• Ödemeler 3D Secure olacaksa istek mesajına 3D den alınan ECI, CAVV ve MpiTransactionId
değerleri mutlaka yer almalıdır. Non Secure ödemelerde bu parametreler gönderilmemektedir.
• TransactionType değeri, “VFTSale” olarak gönderilmelidir.
• Provizyon istek mesajında “NumberOfInstallments” parametresi ve değeri yer almalıdır.
• “TransactionDeviceSource” değeri,
o E-Ticaret işlemleri için “0”,
o Mail Order işlem için “1”
olarak gönderilmelidir.
5.4.2.1 VFT Satış Örnek XML İstek Mesajı
<?xml version="1.0" encoding="utf-8"?>
<VposRequest>
 <MerchantId>***************</MerchantId>
 <Password>********</Password>
 <TerminalNo>********</TerminalNo>
 <TransactionType>VFTSale</TransactionType>
 <TransactionId>20170110s_025</TransactionId>
 <CurrencyAmount>10.10</CurrencyAmount>
 <CurrencyCode>949</CurrencyCode>
 <NumberOfInstallments>02</NumberOfInstallments>
 <Pan>4289450189088488</Pan>
 <Expiry>202109</Expiry>
<Cvv>***</Cvv>
 <ClientIp>190.20.13.12</ClientIp>
<TransactionDeviceSource>0</TransactionDeviceSource>
</VposRequest>
Gizli / Kişisel Veri
41
5.4.2.2 VFT Satış Örnek XML Cevap Mesajı
<?xml version="1.0" encoding="utf-8" ?>
<VposResponse>
 <MerchantId>***************</MerchantId>
 <TransactionType>VFTSale</TransactionType>
 <TransactionId>20170110s_025</TransactionId>
 <ResultCode>0000</ResultCode>
 <ResultDetail>İŞLEM BAŞARILI</ResultDetail>
 <InstallmentTable />
 <AuthCode>350638</AuthCode>
 <HostDate>20170111140101</HostDate>
 <Rrn>000075498036</Rrn>
 <TerminalNo>******</TerminalNo>
 <GainedPoint>0.10</GainedPoint>
 <TotalPoint>4.72</TotalPoint>
 <CurrencyAmount>10.10</CurrencyAmount>
 <CurrencyCode>949</CurrencyCode>
 <VftAmount>10.37</VftAmount>
 <NumberOfInstallments>02</NumberOfInstallments>
 <ThreeDSecureType>1</ThreeDSecureType>
 <TransactionDeviceSource>0</TransactionDeviceSource>
 <BatchNo>28</BatchNo>
 <TLAmount>10.37</TLAmount>
</VposResponse>
5.4.3 Puan Harcama İşlemi
• Ödemeler 3D Secure olacaksa istek mesajına 3D den alınan ECI, CAVV ve MpiTransactionId
değerleri mutlaka yer almalıdır. Non Secure ödemelerde bu parametreler gönderilmemektedir.
• TransactionType değeri, “PointSale” olarak gönderilmelidir. Para Kodu “PointCode” alanında
gönderilmektedir.
• “TransactionDeviceSource” değeri,
o E-Ticaret işlemleri için “0”,
o Mail Order işlem için “1”
olarak gönderilmelidir.
5.4.3.1 Puan Harcama Örnek XML İstek Mesajı
<?xml version="1.0" encoding="utf-8"?>
<VposRequest>
 <MerchantId>***************</MerchantId>
 <Password>********</Password>
 <TerminalNo>********</TerminalNo>
 <TransactionType>PointSale</TransactionType>
 <TransactionId>vpos_08072019</TransactionId>
 <PointAmount>10.07</PointAmount>
 <PointCode>949</PointCode>
 <Pan>4289450189088488</Pan>
 <Expiry>202304</Expiry>
<Cvv>060</Cvv>
 <ClientIp>190.20.13.12</ClientIp>
 <TransactionDeviceSource>0</TransactionDeviceSource>
</VposRequest>
Gizli / Kişisel Veri
42
5.4.3.2 Puan Harcama Örnek XML Cevap Mesajı
<?xml version="1.0" encoding="utf-8" ?>
<VposResponse>
 <MerchantId>***************</MerchantId>
 <TransactionType>PointSale</TransactionType>
 <TransactionId> vpos_08072019</TransactionId>
 <ResultCode>0000</ResultCode>
 <ResultDetail>İŞLEM BAŞARILI</ResultDetail>
 <InstallmentTable />
 <AuthCode>470321</AuthCode>
 <HostDate>20161025142711</HostDate>
 <Rrn>000075474186</Rrn>
 <TerminalNo>********</TerminalNo>
 <PointAmount>10.07</PointAmount>
 <TotalPoint>44.06</TotalPoint>
 <ThreeDSecureType>1</ThreeDSecureType>
 <TransactionDeviceSource>0</TransactionDeviceSource>
 <BatchNo>20</BatchNo>
 </VposResponse>
5.4.4 Ön Provizyon İşlemi
• Ödemeler 3D Secure olacaksa istek mesajına 3D den alınan ECI, CAVV ve MpiTransactionId
değerleri mutlaka yer almalıdır. Non Secure ödemelerde bu parametreler gönderilmemektedir.
• TransactionType değeri, “Auth” olarak gönderilmelidir. Ön provizyona alınan bir işlem İptal(cancel)
edilebilir ya da Capture ( ön provizyon kapama) edilebilir.
• “TransactionDeviceSource” değeri,
o E-Ticaret işlemleri için “0”,
o Mail Order işlem için “1”
olarak gönderilmelidir.
5.4.4.1 Ön Provizyon Örnek XML İstek Mesajı
<?xml version="1.0" encoding="utf-8"?>
<VposRequest>
 <MerchantId>***************</MerchantId>
 <Password>********</Password>
 <TerminalNo>********</TerminalNo>
 <TransactionType>Auth</TransactionType>
 <TransactionId>20170110s_005</TransactionId>
 <CurrencyAmount>10.03</CurrencyAmount>
 <CurrencyCode>949</CurrencyCode>
 <Pan> 4289450189088488</Pan>
 <Expiry>202109</Expiry>
<Cvv>***</Cvv>
 <ClientIp>190.20.13.12</ClientIp>
<TransactionDeviceSource>0</TransactionDeviceSource>
</VposRequest>
5.4.4.2 Ön Provizyon Örnek XML Cevap Mesajı
 <?xml version="1.0" encoding="utf-8" ?>
<VposResponse>
 <MerchantId>***************</MerchantId>
 <TransactionType>Auth</TransactionType>
 <TransactionId>20170110s_005</TransactionId>
 <ResultCode>0000</ResultCode>
 <ResultDetail>İŞLEM BAŞARILI</ResultDetail>
Gizli / Kişisel Veri
43
 <InstallmentTable />
 <AuthCode>175347</AuthCode>
 <HostDate>20170111134121</HostDate>
 <Rrn>000075498008</Rrn>
 <TerminalNo>********</TerminalNo>
 <CurrencyAmount>10.03</CurrencyAmount>
 <CurrencyCode>949</CurrencyCode>
 <ThreeDSecureType>1</ThreeDSecureType>
 <TransactionDeviceSource>0</TransactionDeviceSource>
 <BatchNo>28</BatchNo>
 <TLAmount>10.03</TLAmount>
 </VposResponse>
5.4.5 Surcharge Satış İşlemi
5.4.5.1 Surcharge Satış İsteği
<?xml version="1.0" encoding="utf-8"?>
<VposRequest>
<MerchantId>*************</MerchantId>
<Password>********</Password>
<TerminalNo> ******</TerminalNo>
<TransactionType>Sale</TransactionType>
<TransactionId>b2d71cc5-d242-4b01-8479-d56eb8f74d7c</TransactionId>
<CurrencyAmount>1.99</CurrencyAmount>
<SurchargeAmount>124</SurchargeAmount>
<CurrencyCode>949</CurrencyCode>
<Pan>42894501****8488</Pan>
<Cvv>***</Cvv>
<Expiry>****</Expiry>
<OrderId>SurchargeSatış</OrderId>
<ClientIp>190.20.13.12</ClientIp>
<Extract>sgk surcharge işlemi</Extract>
<ECI>05</ECI>
<ExpSign>131132451234314132</ExpSign> → BKM Ekspress işlemleri için, BKM Express
ExpSign değeri bu alanda gönderilebilir.
<TransactionDeviceSource>0</TransactionDeviceSource>
</VposRequest>
5.4.5.2 Surcharge Satış Cevabı
<?xml version="1.0" encoding="utf-8"?>
<VposResponse>
<MerchantId>**************</MerchantId>
<TransactionType>Sale</TransactionType>
<TransactionId>b2d71cc5-d242-4b01-8479-d56eb8f74d7c</TransactionId>
<ResultCode>0000</ResultCode>
<ResultDetail>İŞLEM BAŞARILI</ResultDetail>
<AuthCode>11234</AuthCode>
<HostDate>0905153509</HostDate>
<Rrn>201101240006</Rrn>
<TerminalNo>*****</TerminalNo>
<SurchargeAmount>1.24</SurchargeAmount>
<CurrencyAmount>1.23</CurrencyAmount>
<CurrencyCode>949</CurrencyCode>
<ThreeDSecureType>1</ThreeDSecureType>
<GainedPoint>0</GainedPoint>
<TotalPoint>2.35</TotalPoint>
Gizli / Kişisel Veri
44
<BatchNo>86</BatchNo>
<TransactionDeviceSource>0</TransactionDeviceSource>
<TLAmount>1.23</TLAmount>
</VposResponse>
6. REFERANSLI İŞLEMLER
Refenraslı işlemler (İptal, İade ve Ön Provizyon Kapama) Sanal POS Yönetim Paneli üzerinden
gerçekleşebileceği gibi api üzerinden de gerçekleştirilebilir. Referanslı işlemlerde kullanılacak ServisUrl bilgisi
Test Adresi Production Adresi
ServisUrl
(POX Request)
https://onlineodemetest.vakifbank.com.tr:44
43/VposService/v3/Vposreq.aspx
https://onlineodeme.vakifbank.com.tr:4443/Vp
osService/v3/Vposreq.aspx
ServisUrl
(Web Service)
https://onlineodemetest.vakifbank.com.tr:44
43/VposService/TransactionServices.asmx
https://onlineodeme.vakifbank.com.tr:4443/Vp
osService/TransactionServices.asmx
6.1. İptal (Cancel)
İptal işlemleri, başarılı gerçekleşmiş ve henüz günsonu alınmamış bir satış veya iade işlemini iptal etmek için
kullanılır.
• İptal işlemi için TransactionType alanının “Cancel” olarak belirtilmesi gereklidir.
• Her başarılı İptal işleminde “TransactionId” değiştirilmelidir.
• İptali yapılacak işleminin orjinal kaydının bulunabilmesi için üye işyeri “ReferenceTransactionId“
alanına iptal edilmek istenen işleme ait “TransactionId” numarasını göndermelidir. Aksi takdirde
işlem iptal edilemeyecek, ilgili hata kodu döndürülecektir.
• İptal ile satış işleminin tüm tutarı iptal edilmektedir
• Taksitli işlemlerinin iptallerinde herhangi bir farklılık yoktur.
• İptal işlemi iptal edilecek işlem ile aynı batch içinde yapılmalıdır.
• İptal işleminin gerçekleşmesi için sadece ReferenceTransactionId nin doldurulması yeterlidir. Pan
bilgileri veya CurrencyAmount bilgilerinin gönderilmesine ihtiyaç yoktur.
• Sadece Satış, Taksitli Satış, Satış, İade, Taksitli Satış İade, Ön Provizyon, Provizyon Kapama, Puan
Kullanım, VFT Satış işlemleri iptal edilebilir.
Örnek iptal mesajları ve VPOS 7/24’ün döndüğü cevaplar aşağıda gösterilmektedir.
6.1.1. İptal İsteği
<?xml version="1.0" encoding="utf-8"?>
<VposRequest>
 <MerchantId>**************</MerchantId>
 <Password>*******</Password>
 <TransactionType>Cancel</TransactionType>
 <ReferenceTransactionId>28476f85-11a2-45ac-b340-
8dccfa81497c</ReferenceTransactionId>
 <ClientIp>190.20.13.12</ClientIp>
</VposRequest>
Gizli / Kişisel Veri
45
6.1.2. İptal Cevabı
<?xml version="1.0" encoding="utf-8"?>
<VposResponse>
 <MerchantId>***************</MerchantId>
 <TransactionType>Cancel</TransactionType>
 <TransactionId>7022b92e-3aa1-44fb-86d4-33658c700c80</TransactionId>
 <ReferenceTransactionId>28476f85-11a2-45ac-b340-
8dccfa81497c</ReferenceTransactionId>
 <ResultCode>0000</ResultCode>
 <ResultDetail>İŞLEM BAŞARILI</ResultDetail>
 <InstallmentTable />
 <CampaignResult>
 <CampaignInfo/>
 </CampaignResult>
 <AuthCode>11234</AuthCode>
 <HostDate>201012</HostDate>
 <Rrn>201101240006</Rrn>
 <TerminalNo>******</TerminalNo>
 <GainedPoint>0</GainedPoint>
 <TotalPoint>100</TotalPoint>
 <CurrencyAmount>90.50</CurrencyAmount>
 <CurrencyCode>949</CurrencyCode>
 <ThreeDSecureType>1</ThreeDSecureType>
 <TransactionDeviceSource>0</TransactionDeviceSource>
 <BatchNo>86</BatchNo>
 <TLAmount>90.50</TLAmount>
</VposResponse>
6.2. İade (Refund)
İade işlemi, başarılı gerçekleşmiş ve günsonu alınarak finansallaşmış bir işlemi iade etmek için kullanılır.
• Bu mesaj için TransactionType değeri “Refund” olarak gönderilmelidir.
• Her iade işleminde TransactionId değiştirilmelidir.
• İadesi yapılacak satış işleminin orijinal kaydının bulunabilmesi için üye işyeri
“ReferenceTransactionId“ alanında orijinal işleme ait “TransactionId” alanını göndermelidir. Aksi
takdirde işlem iade edilemeyecek ilgili hata kodu döndürülecektir.
• İade işleminde iade edilecek tutar, iade edilecek işlemin tutarından küçük ya da eşit olmalıdır.
• VPOS 7/24 sisteminde 2 tür iade yapılabilir; Tam İade ya da kısmi iade. İade işlem tutarı satış işlem
tutarı ile aynı ise tam iade, satış işlem tutarından küçük ise kısmi iade yapılır.
• Satış, Taksitli Satış, Puan Kullanım, Ön Provizyon Kapama ve VFT Satış işlemleri iade edilebilir.
• Kısmî iade işlemleri toplam tutarı satış tutarını geçmeyecek şekilde birden fazla defa yapılabilir.
• İade isteği gün sonu alınan işlemlerde geçerli olacağı gibi, aynı gün sonu alınmamış işlem için de
geçerli olabilecektir. Gün sonu alınmaması işlemin iade edilmesi için engel değildir.
6.2.1. İade İsteği
<?xml version="1.0" encoding="utf-8"?>
<VposRequest>
 <MerchantId>**************</MerchantId>
 <Password>123Ab456</Password>
 <TransactionType>Refund</TransactionType>
Gizli / Kişisel Veri
46
 <CurrencyAmount>10.50</CurrencyAmount>
 <ReferenceTransactionId>28476f85-11a2-45ac-b340-
8dccfa81497c</ReferenceTransactionId>
 <ClientIp>190.20.13.12</ClientIp>
</VposRequest>
6.2.2. İade Cevabı
<?xml version="1.0" encoding="utf-8"?>
<VposResponse>
 <MerchantId>**************</MerchantId>
 <TransactionType>Refund</TransactionType>
 <TransactionId>7022b92e-3aa1-44fb-86d4-33658c700c80</TransactionId>
 <ReferenceTransactionId>28476f85-11a2-45ac-b340-
8dccfa81497c</ReferenceTransactionId>
 <ResultCode>0000</ResultCode>
 <ResultDetail>İŞLEM BAŞARILI</ResultDetail>
 <InstallmentTable />
 <CampaignResult>
 <CampaignInfo/>
 </CampaignResult>
 <AuthCode>11234</AuthCode>
 <HostDate>201012</HostDate>
 <Rrn>201908071244</Rrn>
 <TerminalNo>******</TerminalNo>
 <GainedPoint>0</GainedPoint>
 <TotalPoint>100</TotalPoint>
 <CurrencyAmount>10.50</CurrencyAmount>
 <CurrencyCode>949</CurrencyCode>
 <TransactionDeviceSource>0</TransactionDeviceSource>
 <BatchNo>86</BatchNo>
 <TLAmount>10.50</TLAmount>
</VposResponse>
6.3. Ön Provizyon Kapama (Capture)
Bu işlem ile karta, ön provizyon da koyulan blokajın finansallaştırılması sağlanır. Gün sonu işlemi ile
Provizyon kapamada belirtilen tutar kart sahibinden kesilir.
• Sadece Ön Provizyon açma (Auth) işlemlerinin kapaması (Capture) yapılabilir.
• Bu mesajda TransactionType alanı “Capture” olarak gönderilmelidir.
• Her başarılı ön provizyon kapama işleminde TransactionId değiştirilmelidir.
• Ön Provizyon Kapama işleminde tutar eksiksiz doldurulmalıdır. Tutar bilgileri Ön Provizyonda
belirtilen tutardan en fazla %15 fazla olmalıdır.
• ReferenceTransactionId alanında onay almış Ön Provizyon (Auth) işleminin TransactionId’sinin
yazılması gerekmektedir.Provizyon Kapama işleminde kart bilgilerinin doldurulmasına gerek
yoktur.

6.3.1. Ön Provizyon Kapama İsteği
<?xml version="1.0" encoding="utf-8"?>
<VposRequest>
 <MerchantId>***************</MerchantId>
 <Password>********</Password>
 <TerminalNo>******</TerminalNo>
 <TransactionType>Capture</TransactionType>
 <CurrencyAmount>42.00</CurrencyAmount>
 <CurrencyCode>949</CurrencyCode>
Gizli / Kişisel Veri
47
 <ClientIp>190.20.13.12</ClientIp>
 <ReferenceTransactionId>70asasd1-3aa1-44fb-86d4-
33658c7aac80</ReferenceTransactionId>
</VposRequest>
6.3.2. Ön Provizyon Kapama Cevabı
<?xml version="1.0" encoding="utf-8"?>
<VposResponse>
 <MerchantId>***************</MerchantId>
 <TransactionType>Auth</TransactionType>
 <TransactionId>70asasd1-3aa1-44fb-86d4-33658c7aac80</TransactionId>
 <ResultCode>0000</ResultCode>
 <ResultDetail>İŞLEM BAŞARILI</ResultDetail>
 <AuthCode>11234</AuthCode>
 <HostDate>201012</HostDate>
 <Rrn>201101240006</Rrn>
 <ThreeDSecureType>1</ThreeDSecureType>
 <GainedPoint>0</GainedPoint>
 <TotalPoint>100</TotalPoint>
 <CurrencyAmount>42.00</CurrencyAmount>
 <CurrencyCode>949</CurrencyCode>
 <TransactionDeviceSource>0</TransactionDeviceSource>
 <BatchNo>86</BatchNo>
</VposResponse>
6.4. Teknik İptal (Reversal)
Üye işyeri, VPOS 7/24’ten herhangi bir cevap alamaması durumunda gönderdiği işlemin geri alınması
amacıyla teknik iptal mesajı gönderir. Sadece finansal işlemlerin teknik iptali olabilir. VPOS 7/24 üye
işyerinin gönderdiği Teknik İptal isteğine gün sonu geçilmediği takdirde her zaman olumlu yanıt
verecektir. Eğer reverse edilmek istenen işlem başka batch e ait ise 2202 hatası verilecektir.
• Teknik iptal işlemi için TransactionType alanının “Reversal” olarak belirtilmesi gereklidir.
• Her teknik iptal işleminde farklı bir TransactionId kullanılmalıdır.
• Teknik iptali yapılacak işleminin orijinal kaydının bulunabilmesi için ÜİY, “ReferenceTransactionId“
alanına teknik iptalini gerçekleştirmek istediği işleme ait TransactionId numarasını göndermelidir.
• Teknik iptal işleminin gerçekleşmesi için sadece MerchantId, Password, ReferenceTransactionId,
TransactionType alanlarının doldurulması yeterlidir. Pan bilgileri veya CurrencyAmount bilgilerinin
gönderilmesine ihtiyaç yoktur.
• Taksitli işlemlerin teknik iptalinde herhangi bir farklılık bulunmamaktadır.
• Bir işlemin reverse edileceği VPOS 7/24 uygulamasına geldiyse o işlem üzerinde iptal veya iade
gibi işlemler yapılamaz.
• Referanslı bir işlem in teknik iptali yapıldıysa (iade, provizyon kapama gibi) orjinal işlem tekrar
referanslı işlem yapılmaya uygun hale gelir. Örneğin provizyon kapama işlemi reverse edildiyse,
reverse edilen provizyon kapama işlemine ait ön provizyon işlemine tekrar provizyon kapama
uygulanabilir.
• Gün sonu geçildikten sonra önceki batch numarasına ait işlemler reverse edilemez.
6.4.1. Teknik İptal İsteği
<?xml version="1.0" encoding="utf-8"?>
<VposRequest>
 <MerchantId>******</MerchantId>
Gizli / Kişisel Veri
48
 <Password>******</Password>
 <TerminalNo>******</TerminalNo>
 <TransactionType>Reversal</TransactionType>
 <ReferenceTransactionId>99asase1-3ba1-44fb-86d4-
33658c7abbaa</ReferenceTransactionId>
 <ClientIp>190.20.13.12</ClientIp>
</VposRequest>
1.1.1. Teknik İptal Cevabı
<?xml version="1.0" encoding="utf-8"?>
<VposResponse>
 <MerchantId>******</MerchantId>
 <TransactionType>Reversal</TransactionType>
 <TransactionId>80asasd1-3aa1-44fb-86d4-33658c7aaaaa</TransactionId>
 <ReferenceTransactionId>99asase1-3ba1-44fb-86d4-
33658c7abbaa</ReferenceTransactionId>
 <ResultCode>0000</ResultCode>
 <ResultDetail>İŞLEM BAŞARILI</ResultDetail>
 <HostDate>1130145930</HostDate>
 <Rrn>201101240006</Rrn>
</VposResponse>
7. 3DS ÜRÜNÜ ENTEGRASYONU
• 3DS ürünümüze göre web sitelerinde entegrasyon yapmak isteyen müşterlerimizin Bankaya bilgi
vererek üye işyeri tanımlarının 3DS yetkilerinin aktifleşmesini istemesi gerekmektedir.(Aktifleşme
için sanalpos@vakifbank.com.tr adresine mail iletilerek üye işyeri numarasıyla birlikte ilgili üye
işyerinin 3DS tanımlarının aktifleştirilmesi istenmelidir.)
• Bu ürünümüzü kullanabilmek için entegrasyonun 3D Secure alt yapısıyla yapılması zorunludur.
• 3DS ürünümüze entegrasyon yapan müşterilerimizin Enrollment ve Pares aşamalarında
uygulayacağı kuralların/akışların normal Sanal POS entegrasyonuna göre bir farklılığı
bulunmamaktadır. Yani 3D Secure akışı her 2 üründe de tamamen aynıdır.
• 3DS ürünümüz kullanacak müşterilerimizin provizyon aşamasında XML mesaj oluştururken Pan,
Expiry, CurrencyAmount, CurrencyCode parametrelerini göndermelerine gerek
bulunmamaktadır.
• 3DS ürününü kullanan müşterilerimiz İşyeri bilgilerine ek olarak 3D Secure aşaması sonucunda
başarılı adreslerine dönen ECI, CAVV ve VerifyEnrollmentRequestId (Provizyonda
MpiTransactionId parametresine set edilmelidir. ) parametrelerini de XML mesaja ekleyerek işlemi
tamamlamaları gerekmektedir.
• İşlem taksitli olacaksa provizyon istek mesajında “NumberOfInstallments” parametresi ve değeri yer
almalıdır.
• “TransactionDeviceSource” değeri 3DS bir işlemde “0” olmalıdır.
Gizli / Kişisel Veri
49
• 3DS ürünümüz tüm işlem tiplerini desteklemektedir. Satış, Ön provizyon, Tarım Kart İşlemleri, Bayi Yapısı
İşlemleri gibi tüm işlem tipleri desteklenmektedir.
7.1. 3DS Satış İstek Mesajı
<?xml version="1.0" encoding="utf-8"?>
<VposRequest>
<MerchantId>***************</MerchantId>
<Password>********</Password>
<TerminalNo>******</TerminalNo>
<TransactionType>Sale</TransactionType>
<MpiTransactionId>3ds_27042022</MpiTransactionId>
<ClientIp>190.20.13.12</ClientIp>
<CustomItems>
<Item name="İsim" value="İlyas" />
<Item name="Soyisim" value="KOVALAR" />
<Item name="Açıklama" value="EĞİTİM ÜCRETİ" />
</CustomItems>
<TransactionDeviceSource>0</TransactionDeviceSource>
</VposRequest>
7.2. 3DS Satış Cevap Mesajı
<?xml version="1.0" encoding="utf-8"?>
<VposResponse>
<MerchantId>***************</MerchantId>
<TransactionType>Sale</TransactionType>
<TransactionId>1e46baa4b3a34cd5a6bcaa8400bfb7e0</TransactionId>
<ResultCode>0000</ResultCode>
<ResultDetail>İŞLEM BAŞARILI</ResultDetail>
<CustomItems>
<Item name="isim" value="İlyas" customType="Text" />
<Item name="soyisim" value="KOVALAR" customType="Text" />
<Item name="Açıklama" value="EĞİTİM ÜCRETİ" customType="Text" />
<Item name="CardHolderName" value="İL* KO*" />
</CustomItems>
<InstallmentTable />
<CampaignResult />
<AuthCode>985347</AuthCode>
<HostDate>20190708113801</HostDate>
<Rrn>918911726582</Rrn>
<TerminalNo>******</TerminalNo>
<TotalPoint>1128.95</TotalPoint>
<CurrencyAmount>126.70</CurrencyAmount>
<CurrencyCode>949</CurrencyCode>
<ECI>05</ECI>
<ThreeDSecureType>2</ThreeDSecureType>
<TransactionDeviceSource>0</TransactionDeviceSource>
<BatchNo>207</BatchNo>
Gizli / Kişisel Veri
50
8. SORGULAMA İŞLEMLERİ
Bankamız kredi kartlarında yüklü World puan bilgisi, üye işyerimiz tanımlı Vade farklı taksit bilgisi ve üye
işyerimize tanımlı kampanyaların bilgileri aşağıdaki gibi sorgulanmalıdır.Srogu servislerine ait URL bilgisi
de tabloda belirtilmiştir.
Test Adresi Production Adresi
ServisUrl
(POX Request)
https://onlineodemetest.vakifbank.com.tr:444
3/VposService/v3/Vposreq.aspx
https://onlineodeme.vakifbank.com.tr:4443/Vpo
sService/v3/Vposreq.aspx
ServisUrl
(Web Service)
https://onlineodemetest.vakifbank.com.tr:444
3/VposService/TransactionServices.asmx
https://onlineodeme.vakifbank.com.tr:4443/Vpo
sService/TransactionServices.asmx
8.1. Puan Sorgulama (PointSearch)
Puan Sorgu işlemi müşteri kredi kartındaki puan bilgilerini sorgulamak için kullanılmaktadır.
• Her başarılı Puan Sorgu işleminde farklı bir TransactionId kullanılmalıdır.
• Puan Sorgu işlemi yapabilmek için TransactionType alanı “PointSearch” olarak işaretlenmelidir.
• Puan Sorgu işlemi sırasında Pan, Expiry alanlarının doldurulması zorunludur.
Örnek Puan Sorgu istek mesajları ve VPOS 7/24’ün bu mesajlara döndüğü cevaplar aşağıda
gösterilmektedir.
8.1.1. Puan Sorgu İsteği
<?xml version="1.0" encoding="utf-8"?>
<VposRequest>
 <MerchantId>******</MerchantId>
 <Password>******</Password>
 <TerminalNo>******</TerminalNo>
 <TransactionType>PointSearch</TransactionType>
 <Pan>4289450189088488</Pan>
 <Cvv>454</Cvv>
 <Expiry>201611</Expiry>
 <ClientIp>190.20.13.12</ClientIp>
 <TransactionDeviceSource>0</TransactionDeviceSource>
</VposRequest>
Gizli / Kişisel Veri
51
8.1.1. Puan Sorgu Cevabı
<VposResponse>
<MerchantId>******</MerchantId>
<TransactionType>PointSearch</TransactionType>
<TransactionId>9e92f49475194b5fac91a500014b8c62</TransactionId>
<ResultCode>0000</ResultCode>
<ResultDetail>İŞLEM BAŞARILI</ResultDetail>
<AuthCode>000000</AuthCode>
<HostDate>00000826200707</HostDate>
<Rrn>000075219885</Rrn>
<TerminalNo>******</TerminalNo>
<ThreeDSecureType>1</ThreeDSecureType>
<TotalPoint>119.26</TotalPoint>
<TransactionDeviceSource>0</TransactionDeviceSource>
<BatchNo>1</BatchNo>
</VposResponse>
8.2. Vade Farklı Taksit Sorgusu (VFTSearch)
VFT Sorgu işlemi müşteri kredi kartından VFT sorgulamak için kullanılmaktadır.
• VFT Sorgu işlemi yapabilmek için TransactionType alanı “VFTSearch” olarak işaretlenmelidir.
• Her başarılı VFT Sorgu işleminde farklı bir TransactionId kullanılmalıdır.
• VFT Sorgu işlemi sırasında Pan, CurrencyAmount CurrencyCode, Expiry alanlarının
doldurulması zorunludur.
8.2.1. Vade Farklı Taksitli İşlem Sorgu İsteği
<?xml version="1.0" encoding="utf-8"?>
<VposRequest>
 <MerchantId>***************</MerchantId>
 <Password>********</Password>
 <TransactionId>14371cc5-d242-4b01-8479-d56eb8f74d7c</TransactionId>
 <TerminalNo>******</TerminalNo>
 <TransactionType>VFTSearch</TransactionType>
 <CurrencyAmount>10.00</CurrencyAmount>
 <CurrencyCode>949</CurrencyCode>
 <NumberOfInstallments>5</NumberOfInstallments>
 <Pan>4289450189088488</Pan>
 <Cvv>454</Cvv>
 <Expiry>201611</Expiry>
 <OrderId>z2d71cc5-d242-4b01-8479-d56eb8f74d7c</OrderId> //opsiyonel
 <ClientIp>190.20.13.12</ClientIp>
 <TransactionDeviceSource>0</TransactionDeviceSource>
</VposRequest>
Gizli / Kişisel Veri
52
8.2.2. Vade Farklı Taksitli İşlem Sorgu Cevabı
<?xml version="1.0" encoding="utf-8"?>
<VposResponse>
 <MerchantId>***************</MerchantId>
 <TransactionType>VFTSearch</TransactionType>
 <ResultCode>0000</ResultCode>
 <ResultDetail>İŞLEM BAŞARILI</ResultDetail>
 <AuthCode>000000</AuthCode>
 <HostDate>0702104554</HostDate>
 <Rrn>000075001539</Rrn>
 <TerminalNo>******</TerminalNo>
 <VftAmount>10.36</VftAmount>
 <CurrencyAmount>10.00</CurrencyAmount>
 <CurrencyCode>949</CurrencyCode>
 <TransactionId>14371cc5-d242-4b01-8479-d56eb8f74d7c</TransactionId>
 <NumberOfInstallments>05</NumberOfInstallments>
 <OrderId>z2d71cc5-d242-4b01-8479-d56eb8f74d7c</OrderId>
 <ThreeDSecureType>1</ThreeDSecureType>
 <TransactionDeviceSource>0</TransactionDeviceSource>
 <BatchNo>38</BatchNo>
 <TLAmount>10.36</TLAmount>
</VposResponse>
8.3. Kampanya Sorgu (CampaignSearch)
Kampanya Sorgu işlemi, üye işyerine tanımlı kampanya bilgilerini sorgulamak için kullanılmaktadır.
• Kampanya Sorgu işlemi yapabilmek için TransactionType alanı “CampaignSearch” olarak
işaretlenmelidir.
• Her başarılı Kampanya Sorgu işleminde farklı bir TransactionId kullanılmalıdır.
8.3.1. Kampanya Sorgu İsteği
<?xml version="1.0" encoding="utf-8"?>
<VposRequest>
 <MerchantId>*****</MerchantId>
 <Password>******</Password>
 <TerminalNo>******</TerminalNo>
 <TransactionType> CampaignSearch</TransactionType>
</VposRequest>
8.3.2. Kampanya Sorgu Cevabı
<?xml version="1.0" encoding="utf-8"?>
<VposResponse>
 <MerchantId>***************</MerchantId>
 <TransactionType>CampaignSearch</TransactionType>
 <TransactionId>b2d71cc5-d242-4b01-8479-d56eb8f74d7c</TransactionId>
 <ResultCode>0000</ResultCode>
 <ResultDetail>İŞLEM BAŞARILI</ResultDetail>
 <InstallmentTable/>
 <MerchantCampaignResult>
 <HostResponseCode>000</HostResponseCode>
 <HostResponseMessage>Query successful</HostResponseMessage>
 <CampaignInfos>
 <CampaignInfo>
 <CampaignDescription>ARTI 2 TAKSİT VE 3 AY ERTELEME</CampaignDescription>
 </CampaignInfo>
 </CampaignInfos>
 </MerchantCampaignResult>
Gizli / Kişisel Veri
53
 <TerminalNo>******</TerminalNo>
</VposResponse>
8.4. Kart Aktiflik Sorgusu (CardTest)
Kredi kartının geçerliliğinin kontrolü için gerçekleştirilen işlem tipidir. Karttan 1 kuruşluk bir provizyon alınır ve
işlemin otomatik iptali sağlanır.
• Her başarılı CardTest işleminde farklı bir TransactionId kullanılmalıdır.
• Kart aktiflik sorgu işlemi yapabilmek için TransactionType alanı “CardTest” olarak işaretlenmelidir.
Örnek CardTest istek mesajları ve VPOS 7/24’ün bu mesajlara döndüğü cevaplar aşağıda gösterilmektedir.
8.4.1. Kart Aktiflik Kontrolü Sorgu İsteği
<?xml version="1.0" encoding="utf-8"?>
<VposRequest>
 <MerchantId>******</MerchantId>
 <Password>******</Password>
 <TerminalNo>******</TerminalNo>
 <TransactionType>CardTest</TransactionType>
 <ClientIp>190.20.13.12</ClientIp>
 <Pan>4289450189088488</Pan>
 <Cvv>060</Cvv>
 <Expiry>202304</Expiry>
 <TransactionDeviceSource>0</TransactionDeviceSource>
</VposRequest>
8.4.2. Kart Aktiflik Kontrolü Sorgu Cevabı
<?xml version="1.0" encoding="utf-8"?>
<VposResponse>
 <MerchantId>******</MerchantId>
 <TransactionType>CardTest</TransactionType>
 <TransactionId>b2d71cc5-d242-4b01-8479-d56eb8f74d7c</TransactionId>
 <ResultCode>0000</ResultCode>
 <ResultDetail>İŞLEM BAŞARILI</ResultDetail>
 <AuthCode>11234</AuthCode>
 <HostDate>175017</HostDate>
 <Rrn>201101240006</Rrn>
 <TerminalNo>******</TerminalNo>
 <CurrencyAmount>1.01</CurrencyAmount>
 <CurrencyCode>949</CurrencyCode>
 <ThreeDSecureType>1</ThreeDSecureType>
 <TransactionDeviceSource>0</TransactionDeviceSource>
 <BatchNo>1</BatchNo>
</VposResponse>
Gizli / Kişisel Veri
54
9. TARIM KART İŞLEMLERİ
9.1. Tarım Kart İşlemleri
• Tarım kart işlem gerçekleştirebilmek için üye işyerinin Bankamız tarafında işlem yetkisi olması
gerekmektedir.
• Ödemeler 3D Secure olacaksa istek mesajına 3D den alınan ECI, CAVV ve MpiTransactionId
değerleri mutlaka yer almalıdır.
• TransactionType değeri,
o Tarım Kart Eşit Taksitli Satış için “TKSale”
o Tarım Kart Esnek Taksitli Satış için “TKFlexSale” olarak gönderilmelidir.
• Provizyon mesajında “CustomInstallments” parametresi mutlaka olmalıdır ve
o Tarım Kart Eşit Taksit için “MaturityPeriod” ve “Frequency” alt parametrelerini içermelidir.
Bu parametrelerin değerleri Banka sisteminde üye işyeri üzerinde tanımlı olan Eşit Taksit
Çalışma Şablonuna göre gönderilmelidir.
o Tarım Kart Esnek Taksit için “date” ve “amount” attiributelarını içermelidir.
• “NumberOfInstallments” parametresi sadece Tarım Kart Esnek Taksit Satış işleminin provizyon
mesajında yer almalıdır.
• “TransactionDeviceSource” değeri,
o E-Ticaret işlemleri için “0”,
o Mail Order işlem için “1”
olarak gönderilmelidir.
9.1.1. Tarım Kart Eşit Taksit (TKSale)
Kampanyalı satış işlemi yapabilen üye işyerleri, üzerlerinde tanımlı “Vade – Ödeme Sıklığı” tanımına göre
satış işlemi yapabilmektedir.
9.1.1.1. Tarım Kart Eşit Taksit Örnek XML İstek Mesajı
<?xml version="1.0" encoding="utf-8"?>
<VposRequest>
<MerchantId>***************</MerchantId>
<Password>******</Password>
<TerminalNo>******</TerminalNo>
<TransactionType>TKSale</TransactionType>
<TransactionId>08022017tarim0003001</TransactionId>
<CurrencyAmount>1600.00</CurrencyAmount>
<CurrencyCode>949</CurrencyCode>
<Pan>4592520107264098</Pan>
<Expiry>201912</Expiry>
<ClientIp>190.20.13.12</ClientIp>
<TransactionDeviceSource>0</TransactionDeviceSource>
<CustomInstallments>
 <MaturityPeriod>4</MaturityPeriod>
 <Frequency>1</Frequency>
</CustomInstallments>
</VposRequest>
Gizli / Kişisel Veri
55
9.1.1.2. Tarım Kart Eşit Taksit Örnek XML Cevap Mesajı
<VposResponse>
<MerchantId>***************</MerchantId>
<TransactionType>TKSale</TransactionType>
<TransactionId>08022017tarim0003001</TransactionId>
<ResultCode>0000</ResultCode>
<ResultDetail>İŞLEM BAŞARILI</ResultDetail>
<InstallmentTable>
 <InstallmentItem date="20170308" amount="400.00"/>
 <InstallmentItem date="20170408" amount="400.00"/>
 <InstallmentItem date="20170508" amount="400.00"/>
 <InstallmentItem date="20170608" amount="400.00"/>
</InstallmentTable>
<AuthCode>750722</AuthCode>
<HostDate>20170208122944</HostDate>
<Rrn>000075542136</Rrn>
<TerminalNo>******</TerminalNo>
<CurrencyAmount>1600.00</CurrencyAmount>
<CurrencyCode>949</CurrencyCode>
<ThreeDSecureType>1</ThreeDSecureType>
<TransactionDeviceSource>0</TransactionDeviceSource>
<BatchNo>40</BatchNo>
<TLAmount>1600.00</TLAmount>
</VposResponse>
9.1.2. Tarım Kart Esnek Taksit (TKFlexSale)
Esnek taksitli işlemlerde müşteri ödeme yapacağı tarihi ve o tarihte yapacağı ödeme tutarını kendisi
belirlemektedir.
9.1.2.1 Tarım Kart Esnek Taksit Örnek XML İstek Mesajı
<?xml version="1.0" encoding="utf-8"?>
<VposRequest>
<MerchantId>***************</MerchantId>
<Password>******</Password>
<TerminalNo>******</TerminalNo>
<TransactionType>TKFlexSale</TransactionType>
<TransactionId>08022017tarim0004002</TransactionId>
<CurrencyAmount>90.50</CurrencyAmount>
<CurrencyCode>949</CurrencyCode>
<Pan>4592520107264098</Pan>
<Expiry>201912</Expiry>
<ClientIp>190.20.13.12</ClientIp>
<TransactionDeviceSource>1</TransactionDeviceSource>
<CustomInstallments>
 <CustomInstallment date="20200201" amount="80.00"/>
 <CustomInstallment date="20200528" amount="10.50"/>
</CustomInstallments>
<NumberOfInstallments>02</NumberOfInstallments>
</VposRequest>
Gizli / Kişisel Veri
56
9.1.2.2 Tarım Kart Esnek Taksit Örnek XML Cevap Mesajı
<?xml version="1.0" encoding="utf-8"?>
<VposResponse>
<MerchantId>***************</MerchantId>
<TransactionType>TKFlexSale</TransactionType>
<TransactionId>08022017tarim0004002</TransactionId>
<ResultCode>0000</ResultCode>
<ResultDetail>İŞLEM BAŞARILI</ResultDetail>
<InstallmentTable>
 <InstallmentItem date="20200201" amount="80.00"/>
 <InstallmentItem date="20200528" amount="10.50"/>
</InstallmentTable>
<AuthCode>982549</AuthCode>
<HostDate>20170208134239</HostDate>
<Rrn>000075542146</Rrn>
<TerminalNo>******</TerminalNo>
<CurrencyAmount>90.50</CurrencyAmount>
<CurrencyCode>949</CurrencyCode>
<NumberOfInstallments>02</NumberOfInstallments>
<ThreeDSecureType>1</ThreeDSecureType>
<TransactionDeviceSource>1</TransactionDeviceSource>
<BatchNo>40</BatchNo>
<TLAmount>90.50</TLAmount>
</VposResponse>
9.2 Tarım Kart İptal İşlemleri
Tarım Kart İptal işlemleri için 6.1. İptal (Cancel) başlığında yer alan bilgiler geçerlidir.
9.3 Tarım Kart İade İşlemleri
9.3.2 Tarım Kart Eşit Taksit İade İsteği
Tarım Kart İptal işlemleri için 6.2. İade (Refund) başlığında yer alan bilgiler geçerlidir.
9.3.3 Tarım Kart Esnek Taksitli İşlemlerde İadeler
9.3.3.1 Tarım Kart Esnek Taksit İade İsteği
<?xml version="1.0" encoding="utf-8"?>
<VposRequest>
 <MerchantId>******</MerchantId>
 <Password>******</Password>
 <TransactionType>Refund</TransactionType>
 <CurrencyAmount>41.62</CurrencyAmount>
 <ReferenceTransactionId>28476f85-11a2-45ac-b340-
8dccfa81497c</ReferenceTransactionId>
 <ClientIp>190.20.13.12</ClientIp>
 <CustomInstallments>
 <CustomInstallment date="20170417" amount="17.00"/>
 <CustomInstallment date="20170430" amount="3.50"/>
 <CustomInstallment date="20170609" amount="21.12"/>
</CustomInstallments>
<NumberOfInstallments>03</NumberOfInstallments>
</VposRequest>
Gizli / Kişisel Veri
57
9.3.3.2 Tarım Kart Esnek Taksit İade Cevabı
<VposResponse>
<MerchantId>******</MerchantId>
<TransactionType>Refund</TransactionType>
<TransactionId>f52bb776a2244026bcb0a74e00c5b452</TransactionId>
<ReferenceTransactionId>28476f85-11a2-45ac-b340-8dccfa81497c
</ReferenceTransactionId>
<ResultCode>0000</ResultCode>
<ResultDetail>İŞLEM BAŞARILI</ResultDetail>
<InstallmentTable/>
<CampaignResult>
<CampaignInfo/>
</CampaignResult>
<AuthCode>797946</AuthCode>
<HostDate>20170407115949</HostDate>
<Rrn>000075558838</Rrn>
<TerminalNo>******</TerminalNo>
<CurrencyAmount>41.62</CurrencyAmount>
<CurrencyCode>949</CurrencyCode>
<NumberOfInstallments>3</NumberOfInstallments>
<TransactionDeviceSource>1</TransactionDeviceSource>
<BatchNo>40</BatchNo>
<TLAmount>41.62</TLAmount>
</VposResponse>
9.4 Tarım Kart Limit Sorgusu (TKLimitSearch)
Ödeme alınacak Tarım Kartın hangi ana bayilerde ne kadar limiti olduğunu sorgulayan işlemdir.
• Her başarılı TKLimitSearch işleminde farklı bir TransactionId kullanılmalıdır.
• Tarım Kart Limit Sorgu işlemi yapabilmek için TransactionType alanı “TKLimitSearch” olarak
işaretlenmelidir.
Örnek TKLimitSearch istek mesajları ve VPOS 7/24’ün bu mesajlara döndüğü cevaplar aşağıda
gösterilmektedir.
9.4.1. Tarım Kart Limit Sorgu İsteği
<?xml version="1.0" encoding="utf-8"?>
<VposRequest>
<MerchantId>******</MerchantId>
<Password>******</Password>
<TerminalNo>******</TerminalNo>
<TransactionType>TKLimitSearch</TransactionType>
<TransactionId>dg1233g554dh535tdaagf1gfdg</TransactionId>
<Pan>459252******0821</Pan>
<Cvv>***</Cvv>
<Expiry>****</Expiry>
<OrderId>dsadas5jd5546d4a34j512sdf</OrderId>
<ClientIp>190.20.13.12</ClientIp>
<TransactionDeviceSource>0</TransactionDeviceSource>
</VposRequest>
Gizli / Kişisel Veri
58
9.4.2. Tarım Kart Limit Sorgu Cevabı
<VposResponse>
<MerchantId>******</MerchantId>
<TransactionType>TKLimitSearch</TransactionType>
<TransactionId>dg1233g554dh535tdaagf1gfdg</TransactionId>
<ResultCode>0000</ResultCode>
<ResultDetail>İŞLEM BAŞARILI</ResultDetail>
<InstallmentTable/>
<AuthCode/>
<HostDate>20160824150150</HostDate>
<Rrn>000075034891</Rrn>
<TerminalNo>******</TerminalNo>
<OrderId>dsadas5jd5546d4a34j512sdf</OrderId>
<ThreeDSecureType>1</ThreeDSecureType>
<TransactionDeviceSource>0</TransactionDeviceSource>
<BatchNo>1</BatchNo>
<LimitSearchResults>
 <LimitSearchResult type="Genel Ana Bayi" limit="30000.00"/>
 <LimitSearchResult type="Ozel Panko Birlik" limit="100.00"/>
</LimitSearchResults>
</VposResponse>
9.5. Tarım Kart Üye İşyeri Ödeme Planı Sorgusu (TKPlanSearch)
Tarım Kart üye işyerinin Banka tarafında sahip olduğu eşit taksitli çalışma şablonunu sorgulamayı sağlar.
Üye işyeri bu sorgudaki şablonda yer alan ödeme planına göre üyeliğinde tnaımlı eşit taksitlere göre ödeme
alabilir.
• Her başarılı TKLimitSearch işleminde farklı bir TransactionId kullanılmalıdır.
• Tarım Kart Ödeme Planı Sorgu işlemi yapabilmek için TransactionType alanı “TKPlanSearch”
olarak işaretlenmelidir.
Örnek TKPlanSearch istek mesajları ve VPOS 7/24’ün bu mesajlara döndüğü cevaplar aşağıda
gösterilmektedir.
9.5.1. Tarım Kart Üye İşyeri Ödeme Planı Sorgu İsteği
<?xml version="1.0" encoding="utf-8"?>
<VposRequest>
<MerchantId>******</MerchantId>
<Password>******</Password>
<TerminalNo>******</TerminalNo>
<TransactionType>TKPlanSearch</TransactionType>
<TransactionId>PlanSearch210220170001001</TransactionId>
<Pan>459252******0821</Pan>
<Cvv>***</Cvv>
<Expiry>******</Expiry>
<ClientIp>190.20.13.12</ClientIp>
<TransactionDeviceSource>0</TransactionDeviceSource>
</VposRequest>
Gizli / Kişisel Veri
59
9.5.2. Tarım Kart Üye İşyeri Ödeme Planı Sorgu Cevabı
<VposResponse>
<MerchantId>******</MerchantId>
<TransactionType>TKPlanSearch</TransactionType>
<TransactionId>PlanSearch210220170001001</TransactionId>
<ResultCode>0000</ResultCode>
<ResultDetail>Başarılı</ResultDetail>
<InstallmentTable/>
<HostDate/>
<TerminalNo>******</TerminalNo>
<ThreeDSecureType>1</ThreeDSecureType>
<TransactionDeviceSource>0</TransactionDeviceSource>
<BatchNo>40</BatchNo>
<PlanSearchResults>
<PlanSearchResult maturityPeriod="8" frequency="1"/>
<PlanSearchResult maturityPeriod="3" frequency="3"/>
<PlanSearchResult maturityPeriod="4" frequency="1"/>
<PlanSearchResult maturityPeriod="5" frequency="5"/>
</PlanSearchResults>
</VposResponse>
Gizli / Kişisel Veri
60
10.PF/ALT BAYİ YAPISI PROVİZYON İŞLEMLERİ
• Ana bayi-Alt bayi yapısında ödeme almak isteyen müşterilerimizin alt bayileri için bankamız tarafında
tanım işlemleri sonucunda üye işyeri ile paylaşılan SubMerchant bilgisiyle ya da Identity bilgisiyle
Sanal POS uygulamamız üzerinden ödeme alabilirler.
• Müşterilerimiz ürünlerimizden hangisiyle ödeme alacağına karar vererek entegrasyonlarını
yapabilmektedirler.
• Üye işyerimiz tercih ettiği modeli alt bayili yapıyı Bankamız ekipleri ile paylaşmalıdır.
• Üye işyeri için belirlenen modele göre iş akışları/kuralları belirlenecek olup seçilen yapıya göre üye
işyerimizin ödeme alması sağlanacaktır.
Belirtilen ürünler ve ürünlerle ilgili detaylar aşağıda belirtilmiştir.
❖ SubMerchant Bilgisi İle Ödeme Alma
❖ Identity Bilgisi İle Ödeme Alma
10.1. SubMerchant Bilgisi İle Ödeme Alma
Parametre Adı SubMerchant Bilgisi İle Ödeme Alma
Ana Bayi Alt bayi
MerchantId (Üye İşyeri No) Ana İşyeri Numarası Ana İşyeri Numarası
MerchantPaswword(Api Şifresi) Ana İşyeri Api Şifresi Ana İşyeri Api Şifresi
Terminal Numarası(POS No) Ana İşyeri Terminal No Alt İşyeri Terminal No
MerchantType 1 2
SubMerchantId( Alt bayi Üye
işyeri No)
X Alt İşyeri No
Identity ( Alt bayi VKN-TCKN
Bilgisi)
X X
• Üye işyerleri; Ana Bayi Üye İşyeri veya Alt Bayi Üye İşyeri olarak tanımlanmaktadır. Belli bir
hiyerarşiye göre konumlanmış firmalarda, tanımlamalar Ana bayiye bağlı alt bayiler için yapılmaktadır.
Gizli / Kişisel Veri
61
• Ana Bayi-Alt bayiyapısında müşterimizin çalışma şartında değişiklik olduğunda ana bayi bilgisi de
değişecektir.
• Ana Bayiler, kendileri adına ya da kendisine bağlı alt bayiler adına işlem geçebilirken, Alt Bayiler
ise, sadece kendi işyeleri adına işlem geçebilmektedir.
• Bir Ana Bayi kendi adına işlem geçmek istiyorsa; MerhantId, Terminal No, Merchant Password
bilgileri ana bayiye ait bilgiler olmalıdır. Ayrıca MerchantType değeri 1 olarak gönderilmelidir.
• İşlem bir alt bayi üzerinden gerçekleşecekse; MerhantId bilgisi ana bayiye ait işyeri numarası
olmalıdır. SubMerhantId, Terminal No, MerchantPassword bilgileri alt bayiye ait olmalıdır. Bu
durumda MerchantType değeri 2 olmalıdır.
• PF Ana Bayi- Alt Bayi entegrasyonu kapsamında gönderilmesi gereken ek parametreler
SubMerchantId’li yapı için aşağıdaki gibidir.
XML alan adı Açıklama Alan biçimi ve Uzunluğu Alabileceği
değer
Zorunlu mu?
MerchantType Üye İşyeri Tipi Üye İşyeri tipi. Banka tarafından
Üye işyerine iletilmektedir. Üye
işyeri için sabit bir değerdir. Tüm
isteklerde, bu değer
kullanılmalıdır.Kullanılmaması
durumunda hata alınır. Ana bayi
ve alt bayiler için gönderimi
zorunludur.
Ana Bayi: 1
Alt Bayi:2
Koşullu
(Sadece Bayi
kapsamındaki
işyerleri için
zorunludur.)
SubMerchantId Alt Bayi İşyeri Numarası Alfanumeric. Banka tarafından
AltBayiler için üye işyerine
iletilecektir. İşlem anında banka
tarafından işyeriyle paylaşılan
işyeri numarası gönderilmelidir.
Alt bayi adına işlem geçecekse
gönderimi zorunludur.
Ör:00000000007955 Koşullu:
MerchantType:2
ise zorunlu,Alt bayi
işyeri numarası
gönderilmelidir.
MerchantType:1
ise, Ana bayi kendi
adına işlem geçiyor
ise
gönderilmemeli,
Altbayisi adına
işlem geçiyor ise
zorunludur.
TerminalNo Alt bayi Terminal No VP123000 VP123000 Zorunlu
MerchantPassword Ana bayi Api şifresi İşyeri için banka tarafından
oluşturulan şifre
Alfanumerik Zorunlu
Gizli / Kişisel Veri
62
10.1.1. PF/Alt Bayi 3D Secure Satış İşlemi
• ECI, CAVV ve MpiTransactionId değerleri 5,1. ve 5,2. başlıklarında belirtilen 3D doğrulama akışı sonucunda
alınan değerlerdir. Bu nedenle provizyon aşamasına gelmeden önce 3D Secure doğrulma adımlarının
tamamlanmış olması gerekmektedir.
10.1.1.1. Alt Bayi 3D Secure Satış İsteği
<VposRequest>
<MerchantId>00000000000001</MerchantId> Ana Bayi İşyeri bilgisi
<Password>******</Password>
<Pan>***************</Pan>
<Expiry>******</Expiry>
<CurrencyAmount>105.80</CurrencyAmount>
<CurrencyCode>949</CurrencyCode>
<TerminalNo>VP000001</TerminalNo> Alt Bayi Terminal bilgisi
<TransactionType>Sale</TransactionType>
<TransactionId>pf3d2200320170001001</TransactionId> →opsiyonel
<OrderDescription>Bu bir 3d li pf işlemidir</OrderDescription> →opsiyonel
<ClientIp>190.20.13.12</ClientIp>
<ECI>05</ECI>
<Cvv>123</Cvv>→opsiyonel
<CAVV>AAABAgElVQAAAAZIBiVVAAAAAAA=</CAVV> → PaRes Status Y ve A ise zorunlu
<MpiTransactionId>pf3d2200320170001001</MpiTransactionId>
 <CustomItems> →opsiyonel
 <Item name="İsim" value="İLYAS" />
 <Item name="Soyisim" value="KOVALAR" />
 <Item name="Açıklama" value="Eğitim Ücreti" />
</CustomItems>
<HostSubMerchantId>000000000000002</HostSubMerchantId> AltBayi İşyeri No
<MerchantType>2</MerchantType>
<TransactionDeviceSource>0</TransactionDeviceSource>
</VposRequest>
10.1.1.2. Alt Bayi 3D Secure Satış Cevabı
<VposResponse>
<MerchantId>00000000000001</MerchantId>
<TransactionType>Sale</TransactionType>
<TransactionId>pf3d2200320170001001</TransactionId>
<ResultCode>0000</ResultCode>
<ResultDetail>İŞLEM BAŞARILI</ResultDetail>
<InstallmentTable/>
<AuthCode>085033</AuthCode>
<HostDate>20170323141139</HostDate>
<Rrn>000196161982</Rrn>
<TerminalNo>VP011539</TerminalNo>
<GainedPoint>0.01</GainedPoint>
<TotalPoint>1.54</TotalPoint>
<CurrencyAmount>1.00</CurrencyAmount>
<CurrencyCode>949</CurrencyCode>
<ECI>05</ECI>
<ThreeDSecureType>2</ThreeDSecureType>
<TransactionDeviceSource>0</TransactionDeviceSource>
<BatchNo>4</BatchNo>
<TLAmount>1.00</TLAmount>
<HostSubMerchantId>000000000000002</HostSubMerchantId>
<MerchantType>2</MerchantType>
</VposResponse>
Gizli / Kişisel Veri
63
10.1.2. Alt Bayi Non Secure (Normal) Satış İşlemi
10.1.2.1. Alt Bayi Non Secure (Normal) Satış İsteği
<VposRequest>
<MerchantId>00000000000001</MerchantId>
<Password>******</Password>
<TerminalNo>VP000001</TerminalNo>
<TransactionType>Sale</TransactionType>
<TransactionId>pf3d2200320170001001</TransactionId> →opsiyonel
<OrderDescription>Bu bir pf işlemidir.</OrderDescription> →opsiyonel
<CurrencyAmount>1.00</CurrencyAmount>
<CurrencyCode>949</CurrencyCode>
<Pan>479909******7726</Pan>
<Expiry>202002</Expiry>
<Cvv>392</Cvv>
<ClientIp>190.20.13.12</ClientIp>
 <CustomItems> →opsiyonel
 <Item name="İsim" value="İLYAS" />
 <Item name="Soyisim" value="KOVALAR" />
 <Item name="Açıklama" value="Online Bilet Ücreti" />
</CustomItems>
<HostSubMerchantId>000000000000002</HostSubMerchantId>
<MerchantType>2</MerchantType>
<TransactionDeviceSource>0</TransactionDeviceSource>
</VposRequest>
10.1.2.2. Alt Bayi Non Secure (Normal Satış Cevabı
<VposResponse>
<MerchantId>00000000000001</MerchantId>
<TransactionType>Sale</TransactionType>
<TransactionId>pf3d2200320170001001</TransactionId>
<ResultCode>0000</ResultCode>
<ResultDetail>İŞLEM BAŞARILI</ResultDetail>
<InstallmentTable/>
<AuthCode>403586</AuthCode>
<HostDate>20170322175412</HostDate>
<Rrn>000196061146</Rrn>
<TerminalNo>VP000001</TerminalNo>
<GainedPoint>0.01</GainedPoint>
<TotalPoint>1.53</TotalPoint>
<CurrencyAmount>1.00</CurrencyAmount>
<CurrencyCode>949</CurrencyCode>
<ThreeDSecureType>1</ThreeDSecureType>
<TransactionDeviceSource>0</TransactionDeviceSource>
<BatchNo>3</BatchNo>
<TLAmount>1.00</TLAmount>
<HostSubMerchantId>000000000000002</HostSubMerchantId>
<MerchantType>2</MerchantType>
</VposResponse>
Gizli / Kişisel Veri
64
10.1.3. Alt Bayi İptal İşlemi
10.1.3.1. Alt Bayi İptal İsteği
<VposRequest>
<MerchantId>00000000000001</MerchantId>
<Password>******</Password>
<TransactionType>Cancel</TransactionType>
<MerchantType>2</MerchantType>
<HostSubMerchantId>000000000000002</HostSubMerchantId>
<ReferenceTransactionId>7478e0b902d34f6e9647a75200e5553d</ReferenceTransactionId>
<ClientIp>190.20.13.12</ClientIp>
</VposRequest>
10.1.3.2. Alt Bayi İptal Cevabı
<VposResponse>
<MerchantId>00000000000001</MerchantId>
<TransactionType>Cancel</TransactionType>
<TransactionId>70bcfd0de22b4a2b99f6a75200ebfdac</TransactionId>
<ReferenceTransactionId>7478e0b902d34f6e9647a75200e5553d</ReferenceTransactionId>
<ResultCode>0000</ResultCode>
<ResultDetail>İŞLEM BAŞARILI</ResultDetail>
<InstallmentTable/>
<CampaignResult>
<CampaignInfo/>
</CampaignResult>
<HostDate/>
<TerminalNo>VP000001</TerminalNo>
<GainedPoint>0.01</GainedPoint>
<TotalPoint>51.82</TotalPoint>
<CurrencyAmount>1.00</CurrencyAmount>
<CurrencyCode>949</CurrencyCode>
<TransactionDeviceSource>1</TransactionDeviceSource>
<TLAmount>1.00</TLAmount>
<HostSubMerchantId>000000000000002</HostSubMerchantId>
<MerchantType>2</MerchantType>
</VposResponse>
Gizli / Kişisel Veri
65
10.1.4. Alt Bayi İade İşlemi
10.1.4.1. Alt Bayi İade İsteği
<VposRequest>
 <MerchantId>00000000000001</MerchantId>
 <Password>******</Password>
 <TransactionType>Refund</TransactionType>
 <CurrencyAmount>90.50</CurrencyAmount>
 <TransactionId>7022b92e3aa144fb86d433658c700c80</TransactionId>
 <ReferenceTransactionId>28476f8511a245acb3408dccfa81497c</ReferenceTransactionId>
 <MerchantType>2</MerchantType>
 <HostSubMerchantId>000000000000002</HostSubMerchantId>
 <ClientIp>190.20.13.12</ClientIp>
</VposRequest>
10.1.4.2. PF/Alt Bayi İade Cevabı
<?xml version="1.0" encoding="utf-8"?>
<VposResponse>
 <MerchantId>00000000000001</MerchantId>
 <TransactionType>Refund</TransactionType>
 <TransactionId>7022b92e3aa144fb86d433658c700c80</TransactionId>
 <ReferenceTransactionId>28476f8511a245acb3408dccfa81497c</ReferenceTransactionId>
 <ResultCode>0000</ResultCode>
 <ResultDetail>İŞLEM BAŞARILI</ResultDetail>
 <InstallmentTable />
 <CampaignResult>
 <CampaignInfo/>
 </CampaignResult>
 <AuthCode>11234</AuthCode>
 <HostDate>201012</HostDate>
 <Rrn>201101240006</Rrn>
 <TerminalNo>VP000001</TerminalNo>
 <GainedPoint>0</GainedPoint>
 <TotalPoint>100</TotalPoint>
 <CurrencyAmount>90.50</CurrencyAmount>
 <CurrencyCode>949</CurrencyCode>
 <TransactionDeviceSource>0</TransactionDeviceSource>
 <BatchNo>86</BatchNo>
 <TLAmount>90.50</TLAmount>
 <HostSubMerchantId>000000000000002</HostSubMerchantId>
 <MerchantType>2</MerchantType>
</VposResponse>
Gizli / Kişisel Veri
66
10.1.5. Ana Bayi Üzerinden 3D Secure Satış İşlemi
<VposRequest>
<MerchantId>00000000000001</MerchantId> Ana Bayi İşyeri bilgisi
<Password>******</Password>
<Pan>***************</Pan>
<Expiry>******</Expiry>
<CurrencyAmount>123.80</CurrencyAmount>
<CurrencyCode>949</CurrencyCode>
<TerminalNo>VP000002</TerminalNo> Ana Bayi Terminal bilgisi
<TransactionType>Sale</TransactionType>
<TransactionId>pf3d2200320170001001</TransactionId> →opsiyonel
<OrderDescription>Bu bir 3d li pf işlemidir</OrderDescription> →opsiyonel
<ClientIp>190.20.13.12</ClientIp>
<Cvv>123</Cvv>→opsiyonel
<ECI>05</ECI>
<CAVV>AAABAgElVQAAAAZIBiVVAAAAAAA=</CAVV> → PaRes Status Y ve A ise zorunlu
<MpiTransactionId>pf3d2200320170001001</MpiTransactionId>
 <CustomItems> →opsiyonel
 <Item name="İsim" value="İLYAS" />
 <Item name="Soyisim" value="KOVALAR" />
 <Item name="Açıklama" value="Eğitim Ücreti" />
</CustomItems>
<MerchantType>1</MerchantType>
<TransactionDeviceSource>0</TransactionDeviceSource>
</VposRequest>
10.1.6. Ana Bayi 3D Secure Satış Cevabı
<VposResponse>
<MerchantId>00000000000001</MerchantId>
<TransactionType>Sale</TransactionType>
<TransactionId>pf3d2200320170001001</TransactionId>
<ResultCode>0000</ResultCode>
<ResultDetail>İŞLEM BAŞARILI</ResultDetail>
<InstallmentTable/>
<AuthCode>085044</AuthCode>
<HostDate>20220323141139</HostDate>
<Rrn>000196161325</Rrn>
<TerminalNo>VP011539</TerminalNo>
<GainedPoint>0.01</GainedPoint>
<TotalPoint>1.54</TotalPoint>
<CurrencyAmount>123.80</CurrencyAmount>
<CurrencyCode>949</CurrencyCode>
<ECI>05</ECI>
<ThreeDSecureType>2</ThreeDSecureType>
<TransactionDeviceSource>0</TransactionDeviceSource>
<BatchNo>4</BatchNo>
<TLAmount>1.00</TLAmount>
<MerchantType>1</MerchantType>
</VposResponse>
Gizli / Kişisel Veri
67
10.2. Identity Bilgisi İle Ödeme Alma

X:İlgili parametrenin gönderilmemesi gerektiğini belirtir.
• Identity bilgisi ile ödeme alınabilmesi için ilgili alt bayinin bankamıza bildirİlmiş olması ve bankamız
tarafında alt bayi için üye işyerimize olumlu dönüş yapılmış olması gerekmektedir.
• Bankaya bildirim yapılmadan bir VKN-TCKN ile ödeme isteği geldiğinde hata alınacaktır.
XML alan adı Açıklama Alan biçimi ve Uzunluğu Alabileceği
değer
Zorunlu mu?
MerchantType Üye İşyeri Tipi Üye İşyeri tipi. Banka tarafından
Üye işyerine iletilmektedir. Üye
işyeri için sabit bir değerdir. Tüm
isteklerde, bu değer
kullanılmalıdır.Kullanılmaması
durumunda hata alınır. Ana bayi
ve alt bayiler için gönderimi
zorunludur.
Ana Bayi: 1
Alt Bayi:2
Koşullu
(Sadece Bayi
kapsamındaki işyerleri
için zorunludur.)
Identity Alt Bayi VKN ya da TCKN
bilgisi
Alfanumeric.
Alt bayi adına işlem geçecekse
gönderimi zorunludur.
Ör:
VKN:1234567890
TCKN:12345678901
Koşullu:
MerchantType:2 ise
zorunlu,Alt bayi VKNTCKN bilgisi
gönderilmelidir.
MerchantPassword Ana bayi Api şifresi İşyeri için banka tarafından
oluşturulan şifre
Alfanumerik Zorunlu
Parametre Adı Identity Bilgisi İle Ödeme Alma
Ana Bayi Alt Bayi
MerchantId(Üye İşyeri
No)
Ana Bayi İşyeri numarası Ana Bayi İşyeri numarası
MerchantPaswword(Api
Şifresi)
Ana bayi Api Şifresi Ana bayi Api Şifresi
Terminal Numarası(POS
No)
Ana bayi Terminal No X
MerchantType 1 2
SubMerchantId( Alt bayi
Üye işyeri No)
X X
Identity ( Alt bayi VKNTCKN Bilgisi)
X Alt bayi VKN-TCKN bilgisi
Gizli / Kişisel Veri
68
10.2.1. İşlem Kuralları
10.2.1.1. 3D Secure Aşaması
➢ Ana bayi İşyeri Üzerinden Ödeme Geçme
• İstek ana bayi işyeri üzerinden yapılıyorsa herhangi bir Identity bilgisi gönderilmez sadece
MerchantType bilgisi 1 olarak gönderilerek doğrulama akışına devam edilir.
• Standart işyeri ve kart bilgilerine ek olarak sadece MerchantType=1 parametresi gönderilmektedir.
➢ Alt bayi İşyeri Üzerinden Ödeme Geçme
• İstek alt bayi adına yapılıyorsa MerchantType=2 olarak gönderilmelidir.
• İstek alt bayi adına yapılıyorsa, Enrollment aşamasında ilgili alt bayinin VKN/TCKN bilgisi Identity
parametresinde gönderilmelidir.
10.2.1.2. Provizyon aşaması
➢ Ana bayi İşyeri Üzerinden Ödeme Geçme
• İstek ana bayi adına yapılıyorsa MerchantType=1 olarak gönderilir ve Identity bilgisi hiç
gönderilmez.
• TerminalNo, MerchantPassword ve MerchantId parametrelerinde ana bayiye ait bilgiler
gönderilmelidir.
➢ Alt bayi İşyeri Üzerinden Ödeme Geçme
• İstek alt bayi adına yapılıyorsa MerchantType=2 olarak gönderilir ve Identity parametresinde ilgili
alt bayiye ait VKN/TCKN bilgisi gönderilir.
• MerchantId ve MerchantPassword bilgisi ana bayiye ait bilgiler olur ve Identity ile yapılan
isteklerde
• Terminal numarası bilgisi hiç gönderilmez.
Gizli / Kişisel Veri
69
10.2.2. Identity’li Ana Bayi Non Secure Satış isteği
<VposRequest>
<MerchantId>000000000011445</MerchantId>
<MerchantType>1</MerchantType>
<Password>Ab123456</Password>
<Pan>411979******4284</Pan>
<Expiry>20**04</Expiry>
<Cvv>123</Cvv>→opsiyonel
<TerminalNo>VP***265</TerminalNo>
<CurrencyAmount>11.97</CurrencyAmount>
<CurrencyCode>949</CurrencyCode>
<TransactionType>Sale</TransactionType>
<ClientIp>190.20.13.12</ClientIp>
<TransactionDeviceSource>0</TransactionDeviceSource>
</VposRequest>
10.2.3. Identity’li Ana Bayi Non Secure Cevap Mesajı
<?xml version="1.0" encoding="utf-8"?>
<VposResponse>
 <MerchantId>000000000011445</MerchantId>
 <TransactionType>Sale</TransactionType>
 <TransactionId>090c1e8d451a4f31abc4abd400a162ba</TransactionId>
 <ResultCode>0000</ResultCode>
 <ResultDetail>İŞLEM BAŞARILI</ResultDetail>
 <CustomItems>
 <Item name="CardHolderName" value="İB* KÖ*" />
 </CustomItems>
 <InstallmentTable />
 <CampaignResult />
 <AuthCode>582303</AuthCode>
 <HostDate>20200608094735</HostDate>
 <Rrn>016009774992</Rrn>
 <TerminalNo>VP000265</TerminalNo>
 <TotalPoint>162.54</TotalPoint>
 <CurrencyAmount>11.97</CurrencyAmount>
 <CurrencyCode>949</CurrencyCode>
 <ThreeDSecureType>1</ThreeDSecureType>
 <TransactionDeviceSource>0</TransactionDeviceSource>
 <BatchNo>11</BatchNo>
 <TLAmount>11.97</TLAmount>
 <MerchantType>1</MerchantType>
</VposResponse>
Gizli / Kişisel Veri
70
10.2.4. Identity’li 3D Secure Satış İsteği
<VposRequest>
<MerchantId>000000000011445</MerchantId>
<MerchantType>2</MerchantType>
<Password>Ab123456</Password>
<ECI>05</ECI>
<CAVV>ABIBCRcAAD6uAAARkAAAAAAAAAA=</CAVV>
<MpiTransactionId>08062020_008</MpiTransactionId>
<Pan>411979****4284</Pan>
<Cvv>123</Cvv>→opsiyonel
<Expiry>202404</Expiry>
<CurrencyAmount>16.90</CurrencyAmount>
<CurrencyCode>949</CurrencyCode>
<Identity>1234567890</Identity>
<TransactionType>Sale</TransactionType>
<ClientIp>190.20.13.12</ClientIp>
<TransactionDeviceSource>0</TransactionDeviceSource>
</VposRequest>
10.2.5. Identity’li 3D Secure Cevap Mesajı
<?xml version="1.0" encoding="utf-8"?>
<VposResponse>
 <MerchantId>000000000011445</MerchantId>
 <TransactionType>Sale</TransactionType>
 <TransactionId>a9690228e048416e8481abd400a3a273</TransactionId>
 <ResultCode>0000</ResultCode>
 <ResultDetail>İŞLEM BAŞARILI</ResultDetail>
 <CustomItems>
 <Item name="CardHolderName" value="İB* KÖ*" />
 </CustomItems>
 <InstallmentTable />
 <CampaignResult />
 <AuthCode>354051</AuthCode>
 <HostDate>20200608095546</HostDate>
 <Rrn>016009774993</Rrn>
 <TerminalNo>VP000375</TerminalNo>
 <TotalPoint>162.54</TotalPoint>
 <CurrencyAmount>11.90</CurrencyAmount>
 <CurrencyCode>949</CurrencyCode>
 <ECI>05</ECI>
 <ThreeDSecureType>2</ThreeDSecureType>
 <TransactionDeviceSource>0</TransactionDeviceSource>
 <BatchNo>24</BatchNo>
 <TLAmount>11.90</TLAmount>
 <Identity>1234567890</Identity>
 <MerchantType>2</MerchantType>
</VposResponse>
Gizli / Kişisel Veri
71
10.2.6. Identity’li Alt Bayi Non Secure Satış İsteği
<VposRequest>
<MerchantId>000000000011445</MerchantId>
<Password>Ab123456</Password>
<Pan>411979****4284</Pan>
<Expiry>202404</Expiry>
<MerchantType>2</MerchantType>
<CurrencyAmount>11.97</CurrencyAmount>
<Cvv>123</Cvv>→opsiyonel
<CurrencyCode>949</CurrencyCode>
<Identity>1234567890</Identity>
<TransactionType>Sale</TransactionType>
<ClientIp>190.20.13.12</ClientIp>
<TransactionDeviceSource>0</TransactionDeviceSource>
</VposRequest>
10.2.7. Identity’li Alt Bayi Non Secure Cevap Mesajı
<?xml version="1.0" encoding="utf-8"?>
<VposResponse>
 <MerchantId>000000000011445</MerchantId>
 <TransactionType>Sale</TransactionType>
 <TransactionId>ead1b5cf879c4af6a852abd400a42970</TransactionId>
 <ResultCode>0000</ResultCode>
 <ResultDetail>İŞLEM BAŞARILI</ResultDetail>
 <CustomItems>
 <Item name="CardHolderName" value="İB* KÖ*" />
 </CustomItems>
 <InstallmentTable />
 <CampaignResult />
 <AuthCode>799747</AuthCode>
 <HostDate>20200608095741</HostDate>
 <Rrn>016009774994</Rrn>
 <TerminalNo>VP000375</TerminalNo>
 <TotalPoint>162.54</TotalPoint>
 <CurrencyAmount>11.97</CurrencyAmount>
 <CurrencyCode>949</CurrencyCode>
 <ThreeDSecureType>1</ThreeDSecureType>
 <TransactionDeviceSource>0</TransactionDeviceSource>
 <BatchNo>24</BatchNo>
 <TLAmount>11.97</TLAmount>
 <Identity>1234567890</Identity>
 <MerchantType>2</MerchantType>
</VposResponse>
Gizli / Kişisel Veri
72
10.2.8. Identity’li İptal İşlemi

10.2.8.1. Identity’li İptal İstek Mesajı
<VposRequest>
<MerchantId>00000000000001</MerchantId>
<Password>******</Password>
<TransactionType>Cancel</TransactionType>
<MerchantType>2</MerchantType>
<Identity>3260811874</HostSubMerchantId>
<ReferenceTransactionId>identitytest_28042022</ReferenceTransactionId>
<ClientIp>190.14.13.12</ClientIp>
</VposRequest>
10.2.8.2. Identity’li İptal Cevap Mesajı
<?xml version="1.0" encoding="utf-8"?>
<VposResponse>
 <MerchantId>00000000000001</MerchantId>
 <TransactionType>Cancel</TransactionType>
 <TransactionId>336d121f8a5d4a6ca660ae8500c4bcf6</TransactionId>
 <ReferenceTransactionId>identitytest_28042022</ReferenceTransactionId>
 <ResultCode>0000</ResultCode>
 <ResultDetail>İŞLEM BAŞARILI</ResultDetail>
 <InstallmentTable />
 <CampaignResult />
 <AuthCode>000000</AuthCode>
 <HostDate>20220428115618</HostDate>
 <Rrn>211811859086</Rrn>
 <TerminalNo>VP000371</TerminalNo>
 <CurrencyAmount>1.00</CurrencyAmount>
 <CurrencyCode>949</CurrencyCode>
 <BatchNo>110</BatchNo>
 <TLAmount>1.00</TLAmount>
 <Identity>3260811874</Identity>
 <MerchantType>2</MerchantType>
</VposResponse>
Gizli / Kişisel Veri
73
10.2.9. Identity’li İade İşlemi
10.2.9.1. İdentity’li İade İstek Mesajı

<VposRequest>
<MerchantId>00000000000001</MerchantId>
<Password>******</Password>
<TransactionType>Refund</TransactionType>
<CurrencyAmount>1.00</ CurrencyAmount >
<MerchantType>2</MerchantType>
<Identity>3260811874</HostSubMerchantId>
<ReferenceTransactionId>identitytest_2804202201</ReferenceTransactionId>
<ClientIp>190.14.13.12</ClientIp>
</VposRequest>
10.2.9.2. Identity’li İade Cevap Mesajı

<?xml version="1.0" encoding="utf-8"?>
<VposResponse>
 <MerchantId>000000000011445</MerchantId>
 <TransactionType>Refund</TransactionType>
 <TransactionId>2c789d8e8a0345a8bf30ae8500c7232c</TransactionId>
 <ReferenceTransactionId>identitytest_2804202201</ReferenceTransactionId>
 <ResultCode>0000</ResultCode>
 <ResultDetail>İŞLEM BAŞARILI</ResultDetail>
 <InstallmentTable />
 <CampaignResult />
 <AuthCode>526920</AuthCode>
 <HostDate>20220428120502</HostDate>
 <Rrn>211812859089</Rrn>
 <TerminalNo>VP000371</TerminalNo>
 <CurrencyAmount>1.00</CurrencyAmount>
 <CurrencyCode>949</CurrencyCode>
 <BatchNo>110</BatchNo>
 <TLAmount>1.00</TLAmount>
 <Identity>3260811874</Identity>
 <MerchantType>2</MerchantType>
</VposResponse>

Gizli / Kişisel Veri
74
11. MUTABAKAT SORGULARI
Sanal POS İşlem Sorgulama istekleri şu şekilde yapılabilmektedir:
• Web Servis Çağrısı ile: bu yöntemde ilgili servis adres wsdl ı projeye eklenir ve bu servisin ilgili web
metodu çağrılarak işlem sorgulama yapılabilir. Servis metotlarının işlevleri aşağıda belirtilmiştir:
o Search: Belli bir tarih aralığında, İşlem Numarası, Sipariş Numarası ya da Host otorizasyon
kodu bilgisi bilinen bir işlem sorgulanabilir
o Settlement: Belli bir tarih aralığında, bir terminal üzerinden iletilmiş isteklerin toplamları
sorgulanabilir
o SettlementDetail: Belli bir tarih aralığında, bir terminal üzerinden iletilmiş istekler
sorgulanabilir.
o SuccededOpenBatchTransactions: Belli bir terminalin henüz gün sonu yapılmamış Batch
inden geçmiş ve günsonu yapıldığında dikkate alınacak finansal işlemler getirilebilir.
Sanal Pos aracılığıyla gönderilmiş olan işlemlerin sorgulanabilmesi için kullanılabilen servisler aşağıda
belirtilmiştir.
Belirtilen servisler, mutabakatlaşma süreçlerinin gerçekleştirilmesini sağlamaktadır.
Mutabakat servisi URL bilgisi aşağıdaki tablodaki gibidir.
Test Adresi Production Adresi
SorgulamaServis
Url
(POX Request)
https://onlineodemetest.vakifbank.com.tr:44
43/UIService/
https://onlineodeme.vakifbank.com.tr:4443/UI
Service/
SorgulamaServis
Url
(Web Service)
https://onlineodemetest.vakifbank.com.tr:44
43/UIService/TransactionSearchOperations
.asmx
https://onlineodeme.vakifbank.com.tr:4443/UI
Service/TransactionSearchOperations.asmx
11.1. Başarılı İşlem Sorgulama (SettlementDetail)
Günlük, başarılı olarak gerçekleşmiş işlemlerin listesi, sayfa bazlı olarak alınabilmektedir. Bir sayfada
maksimum 50 adet kayıt alınabilmekle birlikte, sayfadaki maksimum kayıt sayısı, Üye İşyeri tarafından da
iletilebilir.
• İşlem Tarihi(SettlementDate) zorunludur ve formatı şu şekilde olmalıdır: yyyyMMdd
• Sayfadaki Maksimum Kayıt Sayısı(PageSize), bir sayfada dönülecek maksimum kayıt sayısını
vermektedir.
• Sayfa Numarası(PageIndex), sayfalama için kullanılır. Örneğin, gün içinde toplam 502 işlem geçilmiş
olduğunda, son iki işlemi sorgulamak istendiğinde, PageIndex=11, PageSize=50 gönderilmelidir.(50
* 10 + 2 = 502) Ya da aynı kayda erişmek için, PageIndex=21, PageSize=25 gönderilmelidir.(25 * 20
+ 2 = 502)
Örnek Başarılı İşlem Sorgulama istek mesajları ve VPOS 7/24’ün bu mesajlara döndüğü cevaplar aşağıda
gösterilmektedir.
Gizli / Kişisel Veri
75
11.1.1. Başarılı İşlem Sorgulama İsteği
https://onlineodeme.vakifbank.com.tr:4443/UIService/SettlementDetail.as
px?prmstr=
<SettlementDetailRequest><MerchantCriteria><HostMerchantId>******</HostM
erchantId><MerchantPassword>******</MerchantPassword></MerchantCriteria>
<DateCriteria><StartDate>2019-05-05</StartDate><EndDate>2019-06-
05</EndDate></DateCriteria><PagedRequestInfo><PageIndex>21</PageIndex><P
ageSize>25</PageSize></PagedRequestInfo></SettlementDetailRequest>
11.1.2. Başarılı İşlem Sorgulama Cevabı
<?xml version="1.0" encoding="utf-8"?>
<SettlementDetailResponse>
 <ResponseInfo>
 <Status>Success</Status>
 <ResponseCode>0000</ResponseCode>
 <ResponseMessage>Succeeded.</ResponseMessage>
 <ResponseDateTime>2019-05-05T13:32:39.9272296+02:00</ResponseDateTime>
 <IsIdempotent>false</IsIdempotent>
 </ResponseInfo>
 <PagedResponseInfo>
 <PageIndex>21</PageIndex>
 <PageSize>25</PageSize>
 <TotalItemCount>50</TotalItemCount>
 </PagedResponseInfo>
 <TransactionSearchResultInfo>
 <PaymentTransactionInfo>
 <TransactionType>
 <TransactionTypeId>30</TransactionTypeId>
 <TransactionTypeName> Sale</TransactionTypeName>
 </TransactionType>
 <Terminal>
 <HostTerminalId>VP0000095</HostTerminalId>
 </Terminal>
 <AuthCode>11234</AuthCode>
 <SurchargeAmount>22.00</SurchargeAmount>
 <SurchargeCode>949</ SurchargeCode >
 <CurrencyAmount>20.00</CurrencyAmount>
 <CurrencyCode>949</CurrencyCode>
 <Location>1</Location>
 <TransactionId> b2d71cc5-d242-4b01-8479-d56eb8f74d7c</TransactionId>
 <OrderId> 25353648-e242-4a02-8599- d56eb2d74d7c </OrderId>
 <RefTransactionId> </RefTransactionId>
 <CardHoldersName> İlyas KOVALAR</CardHoldersName>
 <DeviceType>1</DeviceType>
 </PaymentTransactionInfo>
 <PaymentTransactionInfo>
 <TransactionType>
 <TransactionTypeId>35</TransactionTypeId>
 <TransactionTypeName> Refund</TransactionTypeName>
 </TransactionType>
Gizli / Kişisel Veri
76
 <Terminal>
 <HostTerminalId>VP0000095</HostTerminalId>
 </Terminal>
 <AuthCode>11234</AuthCode>
 <SurchargeAmount>00.00</SurchargeAmount>
 <SurchargeCode>949</ SurchargeCode >
 <CurrencyAmount>2.00</CurrencyAmount>
 <CurrencyCode>949</CurrencyCode>
 <Location>1</Location>
 <TransactionId> 12d71cc5-d242-4b01-8479-d56eb8f74d7c</TransactionId>
 <OrderId> 25353648-e242-4a02-8599- d56eb2d74d7c </OrderId>
 <RefTransactionId> b2d71cc5-d242-4b01-8479-d56eb8f74d7c
</RefTransactionId>
 <CardHoldersName> İlyas KOVALAR</CardHoldersName>
 <DeviceType>1</DeviceType>
 </PaymentTransactionInfo>
 </TransactionSearchResultInfo>
 </SettlementDetailResponse>
11.2. Başarılı İşlem Kırılımı Sorgulama (Settlement)
Günlük, başarılı olarak gerçekleşmiş işlemlerin işlem tipi bazında,
• Toplam işlem adedi sayısı
• Toplam para tutarı
• Toplam para birimi kırılımı altında alınabilmektedir.
Örnek Başarılı İşlem Kırılımı Sorgulama istek mesajları ve Sanal POS uygulamasının bu mesajlara döndüğü
cevaplar aşağıda gösterilmektedir.
11.2.1. Başarılı İşlem Kırılımı Sorgulama İsteği
https://onlineodeme.vakifbank.com.tr:4443/UIService/Settlement.aspx?prm
str=<SettlementRequest><MerchantCriteria><HostMerchantId>******</HostMer
chantId><MerchantPassword>******</MerchantPassword></MerchantCriteria><D
ateCriteria><StartDate>2014-10-05</StartDate><EndDate>2015-01-
05</EndDate></DateCriteria></SettlementRequest>
11.2.2. Başarılı İşlem Kırılımı Sorgulama Cevabı
<?xml version="1.0" encoding="utf-8"?>
<SettlementResponse>
 <ResponseInfo>
 <Status>Success</Status>
 <ResponseCode>0000</ResponseCode>
 <ResponseMessage>Succeeded.</ResponseMessage>
 <ResponseDateTime>2015-01-05T13:32:39.9272296+02:00</ResponseDateTime>
 <IsIdempotent>false</IsIdempotent>
 </ResponseInfo>
 <HostMerchantId>******</HostMerchantId>
 <TotalCount>50</TotalCount>
 <Sale>
Gizli / Kişisel Veri
77

<Items
>

<TotalItem
>

<TotalCount
> 12</TotalCount
>

<TotalAmount
>1232.00</TotalAmount
>

<
CurrencyCode
>949</
CurrencyCode
>

<
/TotalItem
>

<TotalItem
>

<TotalCount
> 23</TotalCount
>

<TotalAmount
>123.00</TotalAmount
>

<
CurrencyCode
>840</
CurrencyCode
>
 </TotalItem
>

<TotalItem
>

<TotalCount
> 54</TotalCount
>

<TotalAmount
>785.00</TotalAmount
>

<
CurrencyCode
>978</
CurrencyCode
>
 </TotalItem
>
 </Items
>
 </Sale
>

<Capture
>

<Items
>

<TotalItem
>

<TotalCount
> 22</TotalCount
>

<TotalAmount
>232.00</TotalAmount
>

<
CurrencyCode
>949</
CurrencyCode
>
 </TotalItem
>

<TotalItem
>

<TotalCount
> 16</TotalCount
>

<TotalAmount
>232.00</TotalAmount
>

<
CurrencyCode
>840</
CurrencyCode
>
 </TotalItem
>
 </Items
>
 </Capture
>

<Cancel
>

<Items
>

<TotalItem
>

<TotalCount
> 41</TotalCount
>

<TotalAmount
>432.00</TotalAmount
>

<
CurrencyCode
>949</
CurrencyCode
>
 </TotalItem
>

<TotalItem
>

<TotalCount
> 54</TotalCount
>

<TotalAmount
>532.00</TotalAmount
>

<
CurrencyCode
>840</
CurrencyCode
>
 </TotalItem
>
 </Items
>
 </Cancel>

<Refund
>

<Items
>

<TotalItem
>

<TotalCount
> 41</TotalCount
>

<TotalAmount
>432.00</TotalAmount
>

<
CurrencyCode
>949</
CurrencyCode
>
 </TotalItem
>
Gizli / Kişisel Veri
78
 </Items>
 </Refund>
 <Auth>
 <Items>
 <TotalItem>
 <TotalCount> 41</TotalCount>
 <TotalAmount>432.00</TotalAmount>
 <CurrencyCode>949</CurrencyCode>
 </TotalItem>
 </Items>
 </Auth>
 <PointSale>
 <Items>
 <TotalItem>
 <TotalCount> 43</TotalCount>
 <TotalAmount>24.00</TotalAmount>
 <CurrencyCode>949</CurrencyCode>
 </TotalItem>
 </Items>
 </PointSale>
 <VFTSale>
 <Items>
 <TotalItem>
 <TotalCount> 75</TotalCount>
 <TotalAmount>97.00</TotalAmount>
 <CurrencyCode>949</CurrencyCode>
 </TotalItem>
 </Items>
 </VFTSale>
 <Credit>
 <Items>
 <TotalItem>
 <TotalCount> 85</TotalCount>
 <TotalAmount>48.00</TotalAmount>
 <CurrencyCode>949</CurrencyCode>
 </TotalItem>
 </Items>
 </Credit>
</SettlementResponse>
Gizli / Kişisel Veri
79
11.3. Kayıt Detay Sorgulama (Search)
Kayıt Detay Sorgulama işlemi, ÜİY ne ait belli OrderId ya da TransactionId ye sahip işlemleri sorgulamak için
kullanılmaktadır. İşlem anında dönen yanıtın (xml) birebir aynısı dönülmektedir.
• Her başarılı Kayıt Detay Sorgulama işleminde farklı bir TransactionId kullanılmalıdır.
• TransactionId alanına sorgulanmak istenen işlemin TransactionId bilgisi yazılmalıdır.
• OrderId alanına sorgulanmak istenen işlemin OrderId bilgisi yazılmalıdır.
• TransactionId ya da OrderId alanlarının biri zorunludur. Hem TransactionId hem de OrderId
gönderilerek yapılan bir sorgulamada, TransactionId dikkate alınmaktadır.
• OrderID ile sorgulamada bu OrderId ile başarılı işlem varsa başarılı işlem, yoksa son gönderilen işlem
raporda görüntülenecektir.
• Kayıt birden fazla olabilir. Örneğin, aynı TransactionId ile birden fazla istek yapılmış ise her bir kayıt
sorgu cevabına dönecektir.
• Hiç kayıt dönmezse, kriterlere uygun kayıt bulunamamış anlamına gelir ve cevaptaki TotalItemCount
değeri 0 döner aynı zamanda da cevaptaki TransactionSearchResultInfo listesinde hiçbir işlem
dönülmez.
• ResponseInfo alanı, sorgulama işleminin başarılı olarak gerçekleşip gerçekleşmediğini döner.
Örnek Kayıt Detay Sorgulama, istek mesajları ve Sanal POS uygulamasının bu mesajlara döndüğü cevaplar
aşağıda gösterilmektedir.
11.3.1. Kayıt Detay Sorgulama İsteği
https://onlineodeme.vakifbank.com.tr:4443/UIService/Search.aspx?prmstr=
<SearchRequest><MerchantCriteria><HostMerchantId>******</HostMerchantId>
<MerchantPassword>******</MerchantPassword></MerchantCriteria><DateCrite
ria><StartDate>2014-10-05</StartDate><EndDate>2015-01-
05</EndDate></DateCriteria><TransactionCriteria><TransactionId> b2d71cc5-
d242-4b01-8479-d56eb8f74d7c</TransactionId><OrderId> </OrderId><AuthCode>
</AuthCode></TransactionCriteria></SearchRequest>
11.3.2. Kayıt Detay Sorgulama Cevabı
<?xml version="1.0" encoding="utf-8"?>
<SearchResponse>
 <ResponseInfo>
 <Status>Success</Status>
 <ResponseCode>0000</ResponseCode>
 <ResponseMessage>Succeeded.</ResponseMessage>
 <ResponseDateTime>2015-01-05T13:32:39.9272296+02:00</ResponseDateTime>
 <IsIdempotent>false</IsIdempotent>
 </ResponseInfo>
 <PagedResponseInfo>
 <PageIndex>1</PageIndex>
 <PageSize>10</PageSize>
 <TotalItemCount>50</TotalItemCount>
 </PagedResponseInfo>
 <TransactionSearchResultInfo>
Gizli / Kişisel Veri
80
 <TransactionSearchResultInfo>
<MerchantId>******</MerchantId>
 <TransactionType>Sale</TransactionType>
 <TransactionId>b2d71cc5-d242-4b01-8479-d56eb8f74d7c</TransactionId>
 <OrderId>z2d71cc5-d242-4b01-8479-d56eb8f74d7c</OrderId>
 <ResultCode>0000</ResultCode>
 <ResponseMessage>İŞLEM BAŞARILI</ResponseMessage>
 <HostResultCode>000</HostResultCode>
 <AuthCode>11234</AuthCode>
 <HostDate>1130145930</HostDate>
 <Rrn>201101240006</Rrn>
 <CurrencyAmount>90.50</CurrencyAmount>
 <CurrencyCode>949</CurrencyCode>
 <ThreeDSecureType>1</ThreeDSecureType>
<GainedPoint>0</GainedPoint>
 <TotalPoint>100</TotalPoint>
 <SurchargeAmount>92.50</SurchargeAmount>
 <Extract>090020304</Extract>
 <CustomItems>
 <CustomItem>
 <Name>Kontrol1</Name>
 <Value>01</Value>
 </CustomItem>
 <CustomItem>
 <Name>Kontrol2</Name>
 <Value>02</Value>
 </CustomItem>
 </CustomItems>
 </TransactionSearchResultInfo>
 </TransactionSearchResultInfo>
</SearchResponse>
11.4. Gün Sonu Alınacak Kayıtları Sorgulama (Succeeded
OpenBatchTransactions)
Belirli bir terminale ait henüz kapatılmamış olan Batch numarası üzerinden, başarılı olarak gerçekleşmiş
işlemlerin işlem tipi bazında,
• Toplam işlem adedi sayısı
• Toplam para tutarı
• Toplam para birimi kırılımı altında alınabilmektedir.
Örnek Gün Sonu Alınacak Kayıtlar Sorgulama istek mesajları ve Sanal POS’un bu mesajlara döndüğü
cevaplar aşağıda gösterilmektedir.
11.4.1. Gün Sonu Alınacak Kayıtlar Sorgu İsteği
https://onlineodeme.vakifbank.com.tr:4443/UIService/SucceededOpenBatchT
ransactions.aspx?prmstr=<SucceededOpenBatchTransactionsRequest><Merchan
tCriteria><HostMerchantId>******</HostMerchantId><MerchantPassword>******
</MerchantPassword>******</MerchantCriteria>HostTerminalId>
*******</HostTerminalId></SucceededOpenBatchTransactionsRequest>
Gizli / Kişisel Veri
81
11.4.2. Gün Sonu Alınacak Kayıtlar Sorgu Cevabı
<?xml version="1.0" encoding="utf-8"?>
<SucceededOpenBatchTransactionsResponse>
 <ResponseInfo>
 <Status>Success</Status>
 <ResponseCode>0000</ResponseCode>
 <ResponseMessage>Succeeded.</ResponseMessage>
 <ResponseDateTime>2015-01-05T13:32:39.9272296+02:00</ResponseDateTime>
 <IsIdempotent>false</IsIdempotent>
 </ResponseInfo>
 <HostMerchantId>******</HostMerchantId>
 <HostTerminalId>term1234</HostTerminalId>
 <BatchNo>term1234</BatchNo>
 <TotalCount>517</TotalCount>
 <Sale>
 <Items>
 <TotalItem>
 <TotalCount> 12</TotalCount>
 <TotalAmount>1232.00</TotalAmount>
 <CurrencyCode>949</CurrencyCode>
 </TotalItem>
 <TotalItem>
 <TotalCount> 23</TotalCount>
 <TotalAmount>123.00</TotalAmount>
 <CurrencyCode>840</CurrencyCode>
 </TotalItem>
 <TotalItem>
 <TotalCount> 54</TotalCount>
 <TotalAmount>785.00</TotalAmount>
 <CurrencyCode>978</CurrencyCode>
 </TotalItem>
 </Items>
 </Sale>
 <Capture>
 <Items>
 <TotalItem>
 <TotalCount> 22</TotalCount>
 <TotalAmount>232.00</TotalAmount>
 <CurrencyCode>949</CurrencyCode>
 </TotalItem>
 <TotalItem>
 <TotalCount> 16</TotalCount>
 <TotalAmount>232.00</TotalAmount>
 <CurrencyCode>840</CurrencyCode>
 </TotalItem>
 </Items>
 </Capture>
 <Cancel>
 <Items>
 <TotalItem>
 <TotalCount> 41</TotalCount>
 <TotalAmount>432.00</TotalAmount>
 <CurrencyCode>949</CurrencyCode>
Gizli / Kişisel Veri
82
 </TotalItem>
 <TotalItem>

<TotalCount
> 54</TotalCount
>

<TotalAmount
>532.00</TotalAmount
>

<CurrencyCode
>840</CurrencyCode
>
 </TotalItem>
 </Items
>
 </Cancel>

<Refund
>

<Items
>
 <TotalItem>

<TotalCount
> 41</TotalCount
>

<TotalAmount
>432.00</TotalAmount
>

<CurrencyCode
>949</CurrencyCode
>
 </Item
>
 </Items
>
 </Refund>

<Auth
>

<Items
>
 <TotalItem>

<TotalCount
> 41</TotalCount
>

<TotalAmount
>432.00</TotalAmount
>

<CurrencyCode
>949</CurrencyCode
>
 </TotalItem>
 </Items
>
 </Auth>

<PointSale
>

<Items
>
 <TotalItem>

<TotalCount
> 43</TotalCount
>

<TotalAmount
>24.00</TotalAmount
>

<CurrencyCode
>
0</CurrencyCode
>
 </TotalItem>
 </Items
>
 </PointSale
>

<VFTSale
>

<Items
>

<TotalItem
>

<TotalCount
> 75</TotalCount
>

<TotalAmount
>97.00</TotalAmount
>

<CurrencyCode
>949</CurrencyCode
>
 </TotalItem
>
 </Items
>
 </VFTSale
>

<Credit
>

<Items
>

<TotalItem
>

<TotalCount
> 85</TotalCount
>

<TotalAmount
>48.00</TotalAmount
>

<CurrencyCode
>949</CurrencyCode
>
 </TotalItem>
 </Items
>
 </Credit
>
</SucceededOpenBatchTransactionsResponse
>
Gizli / Kişisel Veri
83
 12.TEKRARLI TAHSİLAT SİSTEMİ (RECURRING PAYMENTS)
• Recurring işlemleri temel olarak satış işleminin aynısıdır. Belirtilen tutar recurring alanlarında
belirtilen periyodlara göre bölünerek hosta parçalı olarak gönderilir.
• RecurringFrequencyType, RecurringFrequency, RecurringInstallmentCount alanlarının eksiksiz
doldurulması gereklidir.
• Örnek: Bir satış işleminin alanlarının aşağıdaki şekilde işaretlendiğini varsayalım.
 CurrencyAmount = 1200,00 TL
 RecurringFrequencyType = Month,
 RecurringFrequency = 1
TriggerDate = 20220425
 RecurringInstallmentCount =12
• Yukarıdaki işlem Sanal POS’a, bu işlemin ayda 100.00 TL olacak şekilde 12 ay boyunca toplam 12
kez tekrar etmesi gerektiğini söyler.
• TriggerDate ilk tahsilat tarihinin ne zaman olacağını belirtir.
• Her başarılı recurring işleminde farklı bir TransactionId kullanılmalıdır.
• Recurring işlemleri “peşin/taksitli satış” şeklinde çalışır.
• Recurring işlemi yapabilmek için TransactionType alanı “Sale” olarak işaretlenmeli ve recurring
alanları eksiksiz doldurulmalıdır.
• Recurring işlemi yapılırken Pan, CurrencyAmount CurrencyCode, Expiry alanlarının doldurulması
zorunludur.
• Recurring işlem yapabilmek için yetkinizin bulunması gereklidir.
•
12.1. Tekrarlı Tahsilat İşlem İsteği ve Cevabı
12.1.1. Recurring İşlem İsteği
<VposRequest>
 <MerchantId>000000000007955</MerchantId>
 <Password>123Ab456</Password>
 <TerminalNo>VP000123</TerminalNo>
 <TransactionType>Sale</TransactionType>
 <CurrencyAmount>20.00</CurrencyAmount>
 <CurrencyCode>949</CurrencyCode>
 <Pan>4289450189088488</Pan>
 <Cvv>060</Cvv>
 <Expiry>202304</Expiry>
 <OrderId>vakifbank_tts_12072019</OrderId> → Talimat numarası olarak
kullanılmaktadır.
 <CustomerNumber>123654789</CustomerNumber>
 <CustomerName>AHMET TEKİN</CustomerName>
 <CustomItems>
 <Item name="İsim" value="iLYAS" />
 <Item name="Soyisim" value="KOVALAR" />
Gizli / Kişisel Veri
84
 <Item name="Açıklama" value="2019-2020 Eğitim Dönemi" />
 <Item name="Okul" value="X Koleji" />
 </CustomItems>
 <IsRecurring>true</IsRecurring>
 <RecurringFrequencyType>Day</RecurringFrequencyType>
 <RecurringFrequency>15</RecurringFrequency>
 <TriggerDate>20140128</TriggerDate>
 <RecurringInstallmentCount>4</RecurringInstallmentCount>
 <ClientIp>190.20.13.12</ClientIp>
 <TransactionDeviceSource>0</TransactionDeviceSource> → ilk işlem o gün ise
zorunlu, ileri tarihli bir işlemse zorunlu değil.
</VposRequest>
12.1.2. Recurring İşlem Cevabı
<?xml version="1.0" encoding="utf-8"?>
<VposResponse>
 <MerchantId>000000000007955</MerchantId>
 <TransactionType>Sale</TransactionType>
 <TransactionId>90asasd1-3aa1-44fb-86d4-33658c7aaaaa</TransactionId>
 <ResultCode>0000</ResultCode>
 <ResultDetail>İŞLEM BAŞARILI</ResultDetail>
 <InstallmentTable>
 <InstallmentItem date="01122014" amount="10.5" />
 <InstallmentItem date="01012015" amount="10.5" />
 <InstallmentItem date="01022015" amount="10.5" />
 <InstallmentItem date="01032015" amount="10.5" />
 </InstallmentTable>
 <AuthCode>11234</AuthCode>
 <HostDate>1130145930</HostDate>
 <Rrn>201101240006</Rrn>
 <CurrencyAmount>20.00</CurrencyAmount>
 <CurrencyCode>949</CurrencyCode>
</VposResponse>
12.2. Tekrarlı Tahsilat İşlem Sorgulama (SearchBatchTransactionSum)
Talimatlı işlemlerin bilgilerini ve bekleyen kırılımları, detayları sorgulamak için kullanılır. Parametre bilgisi
aşağıdaki gibidir.
BatchOrderId: Güncellenmesi istenilen talimat bilgisinin işlem numarasıdır. Zorunludur.
12.2.1. Talimatlı İşlem Sorgu İsteği
https://onlineodeme.vakifbank.com.tr:4443/UIService/SearchBatchTransactionSum.aspx?pr
mstr=<BatchTransactionSumDetailRequest>
 <RequestInfo>
 <ClientId>1</ClientId>
 <ClientPassword>pasClient1</ClientPassword>
 <ClientRequestDateTime>2015-01-14T14:07:00</ClientRequestDateTime>
 <ClientRequestId>1</ClientRequestId>
 </RequestInfo>
 <MerchantCriteria>
Gizli / Kişisel Veri
85
 <HostMerchantId>000000000006528</HostMerchantId>
 <MerchantPassword>123456</MerchantPassword>
 </MerchantCriteria>
 <BatchOrderId>335f8be992c24a56b3bba3fe0103b8fc</BatchOrderId>
 </BatchTransactionSumDetailRequest>
12.2.2. Talimatlı İşlem Sorgu Cevabı
<?xml version="1.0" encoding="utf-8"?>
 <SearchBatchTransactionSumResponse xmlns="http://tempuri.org/">
 <SearchBatchTransactionSumResult>
 <ResponseInfo>
 <Status>Success</Status>
 <ResponseCode>0000</ResponseCode>
 <ResponseMessage>Succeded.</ResponseMessage>
 <ResponseDateTime>2015-01-
19T16:16:50.3998794+02:00</ResponseDateTime>
 <IsIdempotent>false</IsIdempotent>
 </ResponseInfo>
 <BatchTransactionSumId>131</BatchTransactionSumId>
 <BatchOrderId>729e9e1ee650484f89a9a39b00c423e4</BatchOrderId>
 <HostMerchantId>000000000006528</HostMerchantId>
 <HostTerminalId>VP000095</HostTerminalId>
 <BatchTransactionType>Sale</BatchTransactionType>
 <CurrencyCode>949</CurrencyCode>
 <TotalAmount>20.00</TotalAmount>
 <InstallmentCount>2</InstallmentCount>
 <RecurringFrequencyType>Day</RecurringFrequencyType>
 <RecurringFrequency>15</RecurringFrequency>
 <RecurringInstallmentCount>4</RecurringInstallmentCount>
 <CustomerNumber>5B43EFEC7A77449</CustomerNumber>
 <CustomerName>İLYAS KOVALAR</CustomerName>
 <CustomItem>
 <Name>İsim</Name>
 <Value>Serdar</Value>
 </CustomItem>
 <InstallmentItemDetails>
 <InstallmentItemDetail>
 <TransactionId>729e9e1ee650484f89a9a39b00c423e4</Transactio
nId>
 <Date>20220420</Date>
 <Amount>5.00</Amount>
 <BatchTransactionSumStatus>Success</BatchTransactionSumStat
us>
 <ResultCode>0000</ResultCode>
 <ResultDetail>İŞLEM BAŞARILI</ResultDetail>
 <PanMasked>493841******2912</PanMasked>
 <AuthCode>006654</AuthCode>
 <PaymentTransactionStatus>İptal</PaymentTransactionStatus>
 </InstallmentItemDetail>
 <InstallmentItemDetail>
 <Date>20140918</Date>
 <Amount>5.00</Amount>
Gizli / Kişisel Veri
86
 <BatchTransactionSumStatus>Pending</BatchTransactionSumStat
us>
 <PanMasked>542119******3226</PanMasked>
 </InstallmentItemDetail>
 <InstallmentItemDetail>
 <Date>20141003</Date>
 <Amount>5.00</Amount>
 <BatchTransactionSumStatus>Pending</BatchTransactionSumStat
us>
 <PanMasked>493841******2912</PanMasked>
 </InstallmentItemDetail>
 <InstallmentItemDetail>
 <TransactionId>05af53ab3c004f23bb8da3d80107bed8</Transactio
nId>
 <Date>20141018</Date>
 <Amount>5.00</Amount>
 <BatchTransactionSumStatus>Failed</BatchTransactionSumStatu
s>
 <ResultCode>0054</ResultCode>
 <ResultDetail>RED-GEÇERSIZ KART</ResultDetail>
 <PanMasked>493841******2912</PanMasked>
 <AuthCode>000000</AuthCode>
 </InstallmentItemDetail>
 </InstallmentItemDetails>
 </SearchBatchTransactionSumResult>
12.3. Talimat Güncelleme
Talimatlı işlemlerin, bekleyen ve tamamlanmamış (başarısız vs.) işlem kırılımlarını güncelleyebilmek için
kullanılır. Talimat güncelleme sorgu isteği işlemi için parametre tanımları aşağıdaki gibidir:
Parametre Adı Parametre Açıklaması Zorunlu?
BatchOrderId Güncellenmesi istenilen talimat bilgisinin işlem numarasıdır. Zorunludur.
HasNewPanInformation Kart bilgisi güncellenmesi durumunda true olmalıdır. Zorunlu değildir.
NewPanInformation Güncel kart numarasıdır. Zorunlu değildir.
NewExpiryInformation Güncel kart son kullanım tarihi numarasıdır. (YYYYMM) Zorunludur.
NewProcessTime Güncel işlem zamanıdır. (YYYY-MM-DD) Zorunlu değildir.
TransactionSumStatus Güncel işlem durumudur.
(Pending,Success,Failed,CollectedManually,LawProcess,Other)
Zorunlu değildir.
OrderDescription Güncel açıklama bilgisidir. Zorunlu değildir.
InstallmentCount Güncel taksit sayısıdır. Zorunlu değildir.
Gizli / Kişisel Veri
87
12.3.1. Talimat Güncelleme Sorgu İsteği
[SorgulamaServisUrl(POX Request)]/EditMerchantBatchTransactionSum.aspx?prmstr=
<EditMerchantBatchTransactionSumRequest><MerchantCriteriaInfo><HostMerchantId>0000000
00006528</HostMerchantId><MerchantPassword>123456</MerchantPassword></MerchantCriteri
aInfo><BatchOrderId>2814f3d423754de7b4a5a4190115247b</BatchOrderId<HasNewPanInformati
on>true</HasNewPanInformation><NewPanInformation>4012001037141112</NewPanInformation>
<NewExpiryInformation>201609</NewExpiryInformation<TransactionSumStatus>Pending</Tran
sactionSumStatus><NewProcessTime /><InstallmentCount /><OrderDesctription /><Installm
entCount /></EditMerchantBatchTransactionSumRequest>
12.3.2. Talimat Güncelleme Sorgu Cevabı
<?xml version="1.0" encoding="utf-8"?>
 <EditMerchantBatchTransactionSumResponse xmlns="http://tempuri.org/
">
 <EditMerchantBatchTransactionSumResult>
 <ResponseInfo>
 <Status>Success</Status>
 <ResponseCode>0000</ResponseCode>
 <ResponseMessage>Succeded.</ResponseMessage>
 <ResponseDateTime>2015-01-
14T09:37:45.7361805+02:00</ResponseDateTime>
 <IsIdempotent>false</IsIdempotent>
 </ResponseInfo>
 <HostMerchantId>000000000000471</HostMerchantId>
 <BatchOrderId>2814f3d423754de7b4a5a4190115247b </BatchOrderId>
 <RecurringInstallmentCount>3</RecurringInstallmentCount>
 </EditMerchantBatchTransactionSumResult>
 </EditMerchantBatchTransactionSumResponse>
13. ÜYE İŞYERİ YARDIMCI SERVİSLERİ
Üye İşyeri tarafından, Sanal POS sisteminin, tahsilat işlemleri dışındaki ek özelliklerinin kullanılabilmesi için
ihtiyaç duyulacak yardımcı servisler yer almaktadır.
Belirtilen servisler, Üye işyerinin müşteri ve kart bilgilerini kendi sisteminde tutmak yerine, Sanal POS
sisteminde tutmasına ve ihtiyacı olduğunda, referans numarası üzerinden, tahsilat işlemleri göndermesine
yardımcı olmaktadır. Bu şekilde, özellikle, Kredi kartı numarasının kendi sistemlerinde tutulmasının sebep
olacağı, güvenlik zafiyetlerini minimize etmiş olacaktır.
Servis URL Test Ortam Prod Ortam
Müşteri Ekleme
(CreateCustomer)
https://onlineodemetest.vakifbank.com.tr:4443/
UIService/CreateCustomer.aspx
https://onlineodeme.vakifbank.com.tr:4443/
UIService/CreateCustomer.aspx
Müşteri Güncelleme
(EditCustomer)
https://onlineodemetest.vakifbank.com.tr:4443/
UIService/EditCustomer.aspx
https://onlineodeme.vakifbank.com.tr:4443/
UIService/EditCustomer.aspx
Gizli / Kişisel Veri
88
Kart Ekleme
(CreateCustomerPan)
https://onlineodemetest.vakifbank.com.tr:4443/
UIService/CreateCustomerPan.aspx
https://onlineodeme.vakifbank.com.tr:4443/
UIService/CreateCustomerPan.aspx
Kart Güncelleme
(EditCustomerPan)
https://onlineodemetest.vakifbank.com.tr:4443/
UIService/EditCustomerPan.aspx
https://onlineodeme.vakifbank.com.tr:4443/
UIService/EditCustomerPan.aspx
Kart Silme
(DeleteCustomerPan)
https://onlineodemetest.vakifbank.com.tr:4443/
UIService/DeleteCustomerPan.aspx
https://onlineodeme.vakifbank.com.tr:4443/
UIService/DeleteCustomerPan.aspx
PanCode ile satış https://onlineodemetest.vakifbank.com.tr:4443/
VposService/v3/Vposreq.aspx
https://onlineodeme.vakifbank.com.tr:4443/
VposService/v3/Vposreq.aspx
13.1. Müşteri Ekleme (CreateCustomer)
Üye İşyerinin, müşterilerini, Sanal Pos sistemine eklemesi için kullanılabilecek API servisidir. İstekler POX
Request Yöntemi ile yapılabileceği gibi, Web Service çağrısı ile de iletilebilmektedir.
• CustomerNumber: Müşteri numarasıdır. Üye işyerinin, aynı müşteri numarasına sahip birden fazla
müşterisi olmayacağı varsayılmıştır. Aynı müşteri numarasıyla yeni bir müşteri kayıt edilmeye
çalışılırsa, Kayıt Zaten Mevcut hatası dönülecektir.
Örnek istek mesajları ve VPOS7/24’ün bu mesajlara döndüğü cevaplar aşağıda gösterilmektedir.
13.1.1. Müşteri Ekleme İsteği
https://onlineodemetest.vakifbank.com.tr:4443/UIService/CreateCustomer.
aspx?prmstr=
<CreateCustomerRequest><MerchantCriteria><HostMerchantId>******</HostMe
rchantId><MerchantPassword>******</MerchantPassword></MerchantCriteria>
<CustomerNumber>müşteri1</CustomerNumber><Name>İLYAS
KOVALAR</Name><FatherName>Baba Adı</FatherName><Address>Saray Mahallesi
Dr. Adnan Büyükdeniz
Caddesi</Address><CityName>İstanbul</CityName><TownName>Türkiye</TownNa
me><Phone>902124443322</Phone><MobilePhone>905554443322</MobilePhone><E
mailAddress>vpos724@vakifbank.com.tr</EmailAddress></CreateCustomerRequ
est>
13.1.2. Müşteri Ekleme Cevabı
<?xml version="1.0" encoding="utf-8"?>
<CreateCustomerResponse>
 <ResponseInfo>
 <Status>Success</Status>
 <ResponseCode>0000</ResponseCode>
 <ResponseMessage>Succeeded.</ResponseMessage>
 <ResponseDateTime>2015-01-
05T13:32:39.9272296+02:00</ResponseDateTime>
 <IsIdempotent>false</IsIdempotent>
 </ResponseInfo>
 <HostMerchantId>******</HostMerchantId>
 <CustomerNumber> müşteri1</CustomerNumber>
</CreateCustomerResponse>
Gizli / Kişisel Veri
89
13.2. Müşteri Güncelleme (EditCustomer)
Üye İşyerinin, müşterilerini, Sanal Pos sisteminde güncellemesi için kullanılabilecek API servisidir. İstekler
POX Request Yöntemi ile yapılabileceği gibi, Web Service çağrısı ile de iletilebilmektedir.
• CustomerNumber: Müşteri numarasıdır. Üye işyerinin, aynı müşteri numarasına sahip birden fazla
müşterisi olmayacağı varsayılmıştır. Sistem var olmayan bir müşteri numarasıyla bir müşteri
güncellenmeye çalışılırsa, Kayıt Bulunamadı hatası dönülecektir.
Örnek istek mesajları ve VPOS7/24’ ün bu mesajlara döndüğü cevaplar aşağıda gösterilmektedir.
13.2.1. Müşteri Güncelleme İsteği
https://onlineodemetest.vakifbank.com.tr:4443/UIService/EditCustomer.as
px?prmstr=
<EditCustomerRequest><MerchantCriteria><HostMerchantId>******</HostMerc
hantId><MerchantPassword>******</MerchantPassword></MerchantCriteria><C
ustomerNumber>müşteri1</CustomerNumber><Name>Serdar
Metin</Name><FatherName>Baba
Adı</FatherName><Address>Vakıfbank</Address><CityName>İstanbul</CityNam
e><TownName>Türkiye</TownName><Phone>902124443322</Phone><MobilePhone>9
05854443322</MobilePhone><EmailAddress>vpos724@vakifbank.com.tr</EmailA
ddress></EditCustomerRequest>
13.2.2. Müşteri Güncelleme Cevabı
<?xml version="1.0" encoding="utf-8"?>
<EditCustomerResponse>
 <ResponseInfo>
 <Status>Success</Status>
 <ResponseCode>0000</ResponseCode>
 <ResponseMessage>Succeeded.</ResponseMessage>
 <ResponseDateTime>2015-01-
05T13:32:39.9272296+02:00</ResponseDateTime>
 <IsIdempotent>false</IsIdempotent>
 </ResponseInfo>
 <HostMerchantId>******</HostMerchantId>
 <CustomerNumber>müşteri1</CustomerNumber>
</EditCustomerResponse>
Gizli / Kişisel Veri
90
13.3. Kart Ekleme (CreateCustomerPan)
Üye İşyerinin, mevcut müşterileri için, Sanal Pos sisteminde yeni kart eklemesi için kullanılabilecek API
servisidir.
Istekler POX Request Yöntemi ile yapılabileceği gibi, Web Service çağrısı ile de iletilebilmektedir.
• Pan: Kart numarasıdır. Üye işyerinin, aynı müşterisi için aynı kart numarasını yeniden kaydetmeye
çalışması durumunda Kayıt Zaten mevcut hatası dönülecektir.
• ExpireDate: kartın son kullanma tarihidir: yyyyMM formatındadır. Ör: Aralık 2020 olan bir kart için,
202012 gönderilmelidir.
• CustomerNumber: sistemde tanımlı olan müşterinin müşteri numarasıdır.
• PanCode: işlem sonucu başarılı olduğu durumda, sistem tarafından otomatik olarak üretilecek
PanCode değeri dönülecektir. Tahsilat isteklerinde, bundan sonra bu değer ile istek gönderilebilecektir.
Örnek istek mesajları ve VPOS7/24’ ün bu mesajlara döndüğü cevaplar aşağıda gösterilmektedir.
13.3.1. Kart Ekleme İsteği
https://onlineodemetest.vakifbank.com.tr:4443/UIService/CreateCustomerP
an.aspx?prmstr=
<CreateCustomerPanRequest><MerchantCriteria><HostMerchantId>******</Hos
tMerchantId><MerchantPassword>123456</MerchantPassword></MerchantCriter
ia><CustomerNumber>müşteri1</CustomerNumber><Pan>4444333322221111</Pan>
<ExpireDate>202012</ExpireDate><CardHolderName>İLYAS
KOVALAR</CardHolderName></CreateCustomerPanRequest>
13.3.2. Kart Ekleme Cevabı
<?xml version="1.0" encoding="utf-8"?>
<CreateCustomerPanResponse>
 <ResponseInfo>
 <Status>Success</Status>
 <ResponseCode>0000</ResponseCode>
 <ResponseMessage>Succeeded.</ResponseMessage>
 <ResponseDateTime>2015-01-
05T13:32:39.9272296+02:00</ResponseDateTime>
 <IsIdempotent>false</IsIdempotent>
 </ResponseInfo>
 <HostMerchantId>******</HostMerchantId>
 <CustomerNumber>müşteri1</CustomerNumber>
 <PanCode>112314AASDFSAASDASDFA234</PanCode>
</CreateCustomerPanResponse>
Gizli / Kişisel Veri
91
13.4. Kart Güncelleme (EditCustomerPan)
Üye İşyerinin, mevcut müşterileri için daha önce eklemiş oldukları kart bilgilerinin, Sanal Pos sisteminde
güncellenebilmesi için kullanılabilecek API servisidir.
Istekler POX Request Yöntemi ile yapılabileceği gibi, Web Service çağrısı ile de iletilebilmektedir.
• Pan: Kart numarasıdır. Üye işyerinin, aynı müşterisi için aynı kart numarasını yeniden kaydetmeye
çalışması durumunda Kayıt Zaten mevcut hatası dönülecektir.
• ExpireDate: kartın son kullanma tarihidir: yyyyMM formatındadır. Ör: Aralık 2020 olan bir kart için,
202012 gönderilmelidir.
• CustomerNumber: sistemde tanımlı olan müşterinin müşteri numarasıdır.
• PanCode: güncellenecek olan kartın, PanCode değeridir.
Örnek istek mesajları ve VPOS7/24’ ün bu mesajlara döndüğü cevaplar aşağıda gösterilmektedir.
13.4.1. Kart Güncelleme İsteği
https://onlineodemetest.vakifbank.com.tr:4443/UIService/EditCustomerPan
.aspx?prmstr=
<EditCustomerPanRequest><MerchantCriteria><HostMerchantId>******</HostM
erchantId><MerchantPassword>******</MerchantPassword></MerchantCriteria
><CustomerNumber>müşteri1</CustomerNumber><PanCode>112314AASDFSAASDASDF
A234</PanCode><Pan>4444333322221111</Pan><ExpireDate>202011</ExpireDate
><CardHolderName>İLYAS
KOVALAR</CardHolderName></EditCustomerPanRequest>
13.4.2. Kart Güncelleme Cevabı
<?xml version="1.0" encoding="utf-8"?>
<EditCustomerPanResponse>
 <ResponseInfo>
 <Status>Success</Status>
 <ResponseCode>0000</ResponseCode>
 <ResponseMessage>Succeeded.</ResponseMessage>
 <ResponseDateTime>2015-01-
05T13:32:39.9272296+02:00</ResponseDateTime>
 <IsIdempotent>false</IsIdempotent>
 </ResponseInfo>
 <HostMerchantId>******</HostMerchantId>
 <CustomerNumber>müşteri1</CustomerNumber>
 <PanCode>112314AASDFSAASDASDFA234</PanCode>
</EditCustomerPanResponse>
Gizli / Kişisel Veri
92
13.5. Kart Silme (DeleteCustomerPan)
Üye İşyerinin, mevcut müşterileri için daha önce eklemiş oldukları kart bilgilerinin, Sanal Pos sisteminden
silinebilmesi için kullanılabilecek API servisidir. Istekler POX Request Yöntemi ile yapılabileceği gibi, Web
Service çağrısı ile de iletilebilmektedir.
▪ PanCode: silinecek olan kartın, PanCode değeridir.
Örnek istek mesajları ve VPOS7/24’ ün bu mesajlara döndüğü cevaplar aşağıda gösterilmektedir.
13.5.1. Kart Silme İsteği
https://onlineodemetest.vakifbank.com.tr:4443/UIService/DeleteCustomerP
an.aspx?prmstr=
<DeleteCustomerPanRequest><MerchantCriteria><HostMerchantId>******</Hos
tMerchantId><MerchantPassword>******</MerchantPassword></MerchantCriter
ia><CustomerNumber>müşteri1</CustomerNumber><PanCode>112314AASDFSAASDAS
DFA234</PanCode></DeleteCustomerPanRequest>
13.5.2. Kart Silme Cevabı
<?xml version="1.0" encoding="utf-8"?>
<DeleteCustomerPanResponse>
 <ResponseInfo>
 <Status>Success</Status>
 <ResponseCode>0000</ResponseCode>
 <ResponseMessage>Succeeded.</ResponseMessage>
 <ResponseDateTime>2015-01-
05T13:32:39.9272296+02:00</ResponseDateTime>
 <IsIdempotent>false</IsIdempotent>
 </ResponseInfo>
 <HostMerchantId>******</HostMerchantId>
 <CustomerNumber>müşteri1</CustomerNumber>
 <PanCode>112314AASDFSAASDASDFA234</PanCode>
</DeleteCustomerPanResponse>
13.6. PanCode ile Ödeme Alma
PanCode ile gerçekleştirilecek ödemelerde kart bilgilerine ihtiyaç yoktur. Provizyon istek mesajında daha
önce eklenmiş bir PanCode değeri yer almalıdır.
ServisUrl: https://onlineodeme.vakifbank.com.tr:4443/VposService/v3/Vposreq.aspx
13.6.1. PanCode ile Provizyon İstek Mesaj Örneği
<?xml version="1.0" encoding="utf-8"?>
<VposRequest>
<MerchantId>******</MerchantId>
<Password>******</Password>
<TerminalNo>******</TerminalNo>
Gizli / Kişisel Veri
93
<TransactionType>Sale</TransactionType>
<TransactionId> b2d71cc5-d242-4b01-8479-
d56eb8f74d7c</TransactionId>→opsiyonel
<CurrencyAmount>90.50</CurrencyAmount>
<CurrencyCode>949</CurrencyCode>
<PanCode>112314AASDFSAASDASDFA234</PanCode>
<OrderId>z2d71cc5-d242-4b01-8479-d56eb8f74d7c</OrderId>→opsiyonel
<ClientIp>190.20.13.12</ClientIp>
 <CustomerNumber>FTAVPOSVKF1388</CustomerNumber>
 <CustomItems> →opsiyonel
 <Item name="İsim" value="A" />
 <Item name="Soyisim" value="B" />
 <Item name="Açıklama" value="Online Bilet Satışı" />
</CustomItems>
<TransactionDeviceSource>0</TransactionDeviceSource>→ECommerce
</VposRequest>
13.6.2. PanCode ile Provizyon Cevap Mesaj Örneği
<?xml version="1.0" encoding="utf-8"?>
<VposResponse>
<MerchantId>******</MerchantId>
<TransactionType>Sale</TransactionType>
<TransactionId>b2d71cc5-d242-4b01-8479-d56eb8f74d7c</TransactionId>
<OrderId>z2d71cc5-d242-4b01-8479-d56eb8f74d7c</OrderId>
<ResultCode>0000</ResultCode>
<ResultDetail>İŞLEM BAŞARILI</ResultDetail>
<AuthCode>11234</AuthCode>
<HostDate>175017</HostDate>
<Rrn>201101240006</Rrn>
<CurrencyAmount>90.50</CurrencyAmount>
<CurrencyCode>949</CurrencyCode>
<ThreeDSecureType>1</ThreeDSecureType>
<GainedPoint>0</GainedPoint>
<TotalPoint>100</TotalPoint>
<BatchNo>86</BatchNo>
</VposResponse>
Gizli / Kişisel Veri
94
14. TÜM UYGULAMA CEVAP KODLARI VE AÇIKLAMALARI
MPI ve Sanal POS uygulamalarımıza ait cevap kodu ve açıklamaları aşağıdaki tabloda belirtilmiştir.
SANAL POS (PROVİZYON AŞAMASI) HATA KODLARI
Hata Kodu Hata Kaynağı Hata Kodu Açıklaması Hata Detayı
0000 SANAL POS İşlem Başarılı Bir işlemin başarılı olduğunu gösterir.
0001 SANAL POS Red-Bankanızı Arayın
Kart sahibi kredi kartını aldığı bankanın kredi kartları
servisiyle görüşerek kartını e-ticarette kullanamadığını
belirtmelidir.
0002 SANAL POS Kategori Yok
Kart sahibi kredi kartını aldığı bankanın kredi kartları
servisiyle görüşerek kartını e-ticarette kullanamadığını
belirtmelidir.
0003 SANAL POS Isyerı Kategorisi Hatalı/Tanımsız
0004 SANAL POS Karta El Koyunuz/Sakıncalı IP bloklanarak aynı IP den işlem gelmesi engellenebilir.
0005 SANAL POS Red/Onaylanmadı
Kart sahibi kredi kartını aldığı bankanın kredi kartları
servisiyle görüşerek kartını e-ticarette kullanamadığını
belirtmelidir.
0006 SANAL POS Hatalı İşlem
0007 SANAL POS Karta El Koyunuz IP bloklanarak aynı IP den işlem gelmesi engellenebilir.
0008 SANAL POS Kimlik Kontrolü/Onaylandı
0009 SANAL POS Tekrar Deneyiniz
Hatanın devam etmesi halinde Kart sahibi kredi kartını
aldığı bankanın kredi kartları servisiyle görüşerek kartını
e-ticarette kullanamadığını belirtmelidir.
0010 SANAL POS Tekrar Deneyiniz
Hatanın devam etmesi halinde Kart sahibi kredi kartını
aldığı bankanın kredi kartları servisiyle görüşerek kartını
e-ticarette kullanamadığını belirtmelidir.
0011 SANAL POS Tekrar Deneyiniz
Hatanın devam etmesi halinde Kart sahibi kredi kartını
aldığı bankanın kredi kartları servisiyle görüşerek kartını
e-ticarette kullanamadığını belirtmelidir.
0012 SANAL POS Hatalı İşlem / Red
Kart sahibi kart bilgilerini doğru girdiğinden veya sanal
limitinin yeterli olup olmadığından emin olduktan sonra
işlemini tekrar denemelidir. Kart sahibi hata almaya
devam ediyorsa kredi kartını aldığı bankanın kredi
kartları servisiyle görüşerek kartını e-ticarette
kullanamadığını belirtmelidir.
0013 SANAL POS Gecersız İşlem Tutarı
0014 SANAL POS Geçersiz Kart Numarası
0015 SANAL POS Müşteri Yok/Bın Hatalı
0021 SANAL POS İşlem Yapılamadı
Kart sahibi kredi kartını aldığı bankanın kredi kartları
servisiyle görüşerek kartını e-ticarette kullanamadığını
belirtmelidir
0030 SANAL POS Format Hatası (Üye İşyeri)
0032 SANAL POS Dosyasına Ulaşılamadı
0033 SANAL POS Süresi Bitmiş/İptal Kart
0034 SANAL POS Sahte Kart
0038 SANAL POS Şifre Aşımı/Karta El Koy IP bloklanarak aynı IP den işlem gelmesi engellenebilir.
0041 SANAL POS Kayıp Kart- Karta El Koy IP bloklanarak aynı IP den işlem gelmesi engellenebilir.
0043 SANAL POS Çalıntı Kart-Karta El Koy IP bloklanarak aynı IP den işlem gelmesi engellenebilir.
0051 SANAL POS Bakiyesi-Kredi Limiti Yetersiz
0052 SANAL POS Hesap Noyu Kontrol Edin
0053 SANAL POS Hesap Yok
0054 SANAL POS Vade Sonu Geçmiş Kart
Gizli / Kişisel Veri
95
0055 SANAL POS Hatalı Kart Şifresi
0056 SANAL POS Kart Tanımlı Değil.
0057 SANAL POS Kart İşlem Tipine Kapalı
Kart sahibi kredi kartını aldığı bankanın kredi kartları
servisiyle görüşerek kartını e-ticarette kullanamadığını
belirtmelidir
0058 SANAL POS İşlem Tipi Terminale Kapalı Girilen kart numarası hatalı veya rastgele girilmiş bir
değer olabilir.
0059 SANAL POS Sahtekarlık Şüphesi IP bloklanarak aynı IP den işlem gelmesi engellenebilir.
0061 SANAL POS Para Çekme Tutar Limiti Aşıldı
0062 SANAL POS Yasaklanmış Kart IP bloklanarak aynı IP den işlem gelmesi engellenebilir.
0063 SANAL POS Güvenlik İhlali
0065 SANAL POS Para Çekme Limiti Aşıldı
Kart sahibi kredi kartını aldığı bankanın kredi kartları
servisiyle görüşerek kartını e-ticarette kullanamadığını
belirtmelidir
0075 SANAL POS Şifre Deneme Sayısı Aşıldı
Kart sahibi kredi kartını aldığı bankanın kredi kartları
servisiyle görüşerek kartını e-ticarette kullanamadığını
belirtmelidir
0077 SANAL POS Şifre Scrıpt Talebi Reddedildi
Kart sahibi kredi kartını aldığı bankanın kredi kartları
servisiyle görüşerek kartını e-ticarette kullanamadığını
belirtmelidir
0078 SANAL POS Şifre Güvenilir Bulunmadı
Kart sahibi kredi kartını aldığı bankanın kredi kartları
servisiyle görüşerek kartını e-ticarette kullanamadığını
belirtmelidir
0089 SANAL POS İşlem Onaylanmadı
Kart sahibi kredi kartını aldığı bankanın kredi kartları
servisiyle görüşerek kartını e-ticarette kullanamadığını
belirtmelidir
0091 SANAL POS Kartı Veren Banka Hizmet Dışı
Kart sahibi kredi kartını aldığı bankanın kredi kartları
servisiyle görüşerek kartını e-ticarette kullanamadığını
belirtmelidir
0092 SANAL POS Bankası Bilinmiyor
0093 SANAL POS Kartınız E-Ticaret İşlemlerine Kapalıdır. Bankanızı
Arayınız. Kart E-Ticarete Kapalı
0096 SANAL POS Bankasının Sistemi Arızalı
Kart sahibi kredi kartını aldığı bankanın kredi kartları
servisine yönlendirilmelidir. Farklı bankalarından da aynı
hata alınıyorsa, hatayı vpos724@vakifbank.com.tr
adresine bildiriniz.
0312 SANAL POS Kartın Cvv2 Değeri Hatalı
0315 SANAL POS Kartın Sanal Limiti Yeterli Değil
0320 SANAL POS Önprovizyon Yok Hatayı vpos724@vakifbank.com.tr adresine bildiriniz.
0323 SANAL POS Önpr. Kapama Tutar Eşlenmedi Hatayı vpos724@vakifbank.com.tr adresine bildiriniz.
0357 SANAL POS Eksik Ödeme Sayacı:Nakit Red
Kart sahibi kredi kartını aldığı bankanın kredi kartları
servisiyle görüşerek kartını e-ticarette kullanamadığını
belirtmelidir
0358 SANAL POS Kart Kapalı
0359 SANAL POS Aylık Ciro Limiti Aşıldı Hatayı vpos724@vakifbank.com.tr adresine iletiniz.
0381 SANAL POS Red Karta El Koy IP bloklanarak aynı IP den işlem gelmesi engellenebilir.
0382 SANAL POS Sahte Kart-Karta El Koyunuz IP bloklanarak aynı IP den işlem gelmesi engellenebilir.
0400 SANAL POS 3D Secure Şifre Doğrulaması Yapılamadı Hatayı vpos724@vakifbank.com.tr adresine iletiniz.
0501 SANAL POS Geçersiz Taksit/İşlem Tutarı Taksit tanımı yok veya denenen işlem tutarı 1 TL nin
altındadır.
0503 SANAL POS Ekstre-Taksit Sayısı Uyumsuz
0504 SANAL POS İşyerinin Storeu İçin Bu Kartın Bıni Tanımlı Değil
Hatayı vpos724@vakifbank.com.tr adresine bildiriniz.
0540 SANAL POS İade Edilecek İşlemin Orijinali Bulunamadı
0541 SANAL POS Orj. İşlem Tamamı İade Edildi
0542 SANAL POS Günlük İade Limiti Aşımı Hatayı vpos724@vakifbank.com.tr adresine bildiriniz.
Gizli / Kişisel Veri
96
0550 SANAL POS İşlem Ykb Pos Undan Yapılmalı
0570 SANAL POS Yurtdışı Kart İşlem İzni Yok Yurt dışı kart işlem izni için talebinizi şubenize iletmeniz
gerekmektedir.
0571 SANAL POS İşyeri Amex İşlem İzni Yok Amex Kart İşlem izni için Şubenize başvurunuz.
0572 SANAL POS İşyeri Amex Tanımları Eksik Hatayı vpos724@vakifbank.com.tr adresine bildiriniz.
0574 SANAL POS Kampüs Karta Uygun İşyeri Değil Hatayı vpos724@vakifbank.com.tr adresine bildiriniz.
0575 SANAL POS Limitsiz Takip Kart
Kart sahibi kredi kartını aldığı bankanın kredi kartları
servisiyle görüşerek kartını e-ticarette kullanamadığını
belirtmelidir
0577 SANAL POS Taksite Kapalı Sektör
0580 SANAL POS Cavv Veya Bkm Expsign değeri Hatalı ECI ve CAVV değerlerinin provizyon mesajında boş veya
hatalı gönderilmektedir.
0581 SANAL POS Ecı Veya Cavv Bilgisi Eksik ECI ve CAVV değerlerinin provizyon mesajında boş veya
hatalı gönderilmektedir.
0582 SANAL POS Cavv Acs Error ECI ve CAVV değerlerinin provizyon mesajında boş veya
hatalı gönderilmektedir.
0583 SANAL POS Bkm Expsign Mükerrer ECI ve CAVV değerlerinin provizyon mesajında boş veya
hatalı gönderilmektedir.
0961 SANAL POS Debit Kartla İade Yapılamaz
0962 SANAL POS Terminalıd Tanımısız
0963 SANAL POS Üye İşyeri Tanımlı Değil
0966 SANAL POS Duplicate İşlem Numarası Hatası
0971 SANAL POS Eşleşmiş (Capture) Bir İşlem İptal Edilemez
0972 SANAL POS Para Kodu Geçersiz.Onus Kart İle Yp İşlem
Yapılamaz.
0973 SANAL POS İşlem Onaylanmadı
0974 SANAL POS Reversal Farklı Günde Gelmiş. Hatayı vpos724@vakifbank.com.tr adresine bildiriniz.
0975 SANAL POS İşlem İzni Yok Sanal POS un bu işleme yetkisi yoktur.
0976 SANAL POS Onus Kart Tanımlı Değil Hatayı vpos724@vakifbank.com.tr adresine bildiriniz.
0977 SANAL POS Onus Kart Tanımlı Değil Hatayı vpos724@vakifbank.com.tr adresine bildiriniz.
0978 SANAL POS Notonus Kart İle Taksitli İşlem Diğer Banka kartları ile taksitli işlem yapılamaz.
0980 SANAL POS Son Kur Bilgisi Bulunamadı
0981 SANAL POS 3D Secure Acquiring İle İlgili Eksik Güvenlik Alanı ECI ve CAVV değerlerinin provizyon mesajında boş veya
hatalı gönderilmelidir.
0982 SANAL POS İşlem İptal Durumda. İade Edilemez
0983 SANAL POS İade Edilecek İşlemin Orijinali Bulunamadı
0984 SANAL POS İade Tutarı Satış Tutarından Büyük Olamaz İade Tutarı Satış Tutarından Büyük Olamaz
0985 SANAL POS İşyeri Store A Bağlı Olmalıdır Hatayı vpos724@vakifbank.com.tr adresine bildiriniz.
0986 SANAL POS Gıb Taksit Hata
0987 SANAL POS İşyeri Mp Taksit Tanımı Bulunamadı Hatayı vpos724@vakifbank.com.tr adresine bildiriniz.
1001 SANAL POS Sistem Hatasi.
1006 SANAL POS
Bu İşlem Numarası İle Daha Önce Bir İslem
Gerçekleştirilmiş, İşleme Yeni Bir Numara
Verebilir Yada Bu Alanı Boş Bırakabilirsiniz
1007 SANAL POS Referans Transaction Alinamadi
Genel olarak iade işlemlerinde, iade edilecek işlemin
ReferansTransactionId değeriyle uyuşmadığı durumlarda
alınır.
1044 SANAL POS Debit Kartlarla Taksitli İslem Yapilamaz
1046 SANAL POS Toplam İade Tutarı Orjinal Tutarı Aştı.
1047 SANAL POS Islem Tutari Geçersiz.
1049 SANAL POS Geçersiz Tutar.
Üye işyerinin CurrencyAmount alanında XX.YY
formatında kayıt ilettiği kontrol edilmelidir. Virgül
kullanılmamalı, noktadan sonra 2 hane olmalıdır. 1 tl lik
işlem için 1.00 gönderilmelidir.
Gizli / Kişisel Veri
97
1050 SANAL POS Cvv Hatali. CVV nin formatının hatalı gönderilmesinden ya da hiç
gönderilmemesinden dolayı alınan hatadır.
1051 SANAL POS Kredi Karti Numarasi Hatali.
1052 SANAL POS Kart Vadesi Hatalı Veya Vade Formatı Hatalı
1053 SANAL POS Gönderilen Pancode Kayıtlı Değil
1054 SANAL POS Islem Numarasi Hatali.
1059 SANAL POS İşlemin Tamamı İade Edilmiş.
1060 SANAL POS Hatali Taksit Sayisi.
1061 SANAL POS Ayni Siparis Numarasiyla Daha Önceden Basarili
İslem Yapilmis
1065 SANAL POS Ön Provizyon Daha Önceden Kapatilmis
1073 SANAL POS Terminal Üzerinde Aktif Olarak Bir Batch
Bulunamadi
1074 SANAL POS Islem Henüz Sonlanmamis Yada Referans İslem
Henüz Tamamlanmamis.
1075 SANAL POS Sadakat Puan Tutari Hatali
1076 SANAL POS Sadakat Puan Kodu Hatali
1077 SANAL POS Para Kodu Hatali
1078 SANAL POS Geçersiz Siparis Numarasi
1079 SANAL POS Geçersiz Siparis Açiklamasi
1080 SANAL POS Sadakat Tutari Ve Para Tutari Gönderilmemis.
1081 SANAL POS Puanla Satış İşleminde Taksit Sayısı Gönderilemez
1082 SANAL POS Geçersiz İslem Tipi
1083 SANAL POS Referans İslem Daha Önceden İptal Edilmis.
1087 SANAL POS Yabanci Para Birimiyle Taksitli Provizyon Kapama
İslemi Yapilamaz
1088 SANAL POS Önprovizyon İptal Edilmis
1089 SANAL POS Referans İslem Yapilmak İstenen İslem İçin Uygun
Degil
1091 SANAL POS Recurring İslemin Toplam Taksit Sayisi Hatali
1092 SANAL POS Recurring İslemin Tekrarlama Araligi Hatali
1093 SANAL POS Sadece Satis (Sale) İslemi Recurring Olarak
İsaretlenebilir
1095 SANAL POS Lütfen Geçerli Bir Email Adresi Giriniz
1096 SANAL POS Provizyon Talep Mesajına Clientıp Değerini
Gönderiniz.
1097 SANAL POS Lütfen Geçerli Bir Cavv Degeri Giriniz
1098 SANAL POS Lütfen Geçerli Bir Ecı Degeri Giriniz
1099 SANAL POS Lütfen Geçerli Bir Kart Sahibi İsmi Giriniz
1100 SANAL POS Lütfen Geçerli Bir Brand Girisi Yapin.
1101 SANAL POS Referans Transaction Reverse Edilmis.
1102 SANAL POS Recurring İslem Araligi Geçersiz.
1103 SANAL POS Taksit Sayisi Girilmeli
1104 SANAL POS İzinsiz Taksitli İşlem.
1105 SANAL POS Üye İsyeri Ip Si Sistemde Tanimli Degil
Güvenlik nedeniyle uygulamaya gelen provizyon
isteklerinde Statik IP kontrolü yapılmaktadır. Statik IP
bilginizi üye işyeri numranızla birlikte
vpos724@vakifbank.com.tr adresine iletmeniz
gerekmektedir.
1106 SANAL POS Extract Maksimum 40 Karakter Olmalıdır. Extract maksimum 40 karakter olmalıdır.
Gizli / Kişisel Veri
98
1107 SANAL POS Expsign Alanın Uzunluğu Hatalı
1108 SANAL POS Mpitransactionıd Alanın Uzunluğu Hatalı
1109 SANAL POS Valuelist Alanın Uzunluğu Hatalı
1110 SANAL POS Bu Üye İşyerii 3D İşlem Yapamaz
1111 SANAL POS Bu Üye İşyeri Non Secure İşlem Yapamaz
1112 SANAL POS Terminal Aktif Değil
1113 SANAL POS Terminalde Açık Reversal Bulunuyor
1114 SANAL POS Mpitransactionıd Alanı Boş Gönderilmiş
1115 SANAL POS Mpitransactionı Buluanamıyor
1116 SANAL POS Eci Değeri Mpı İle Uyumsuz
1117 SANAL POS Cavv Değeri Mpı İle Uyumsuz
1118 SANAL POS 3D Secure İşlemler Mailorder Olarak
Gönderilemez
1119 SANAL POS Otomatik Gün Sonu Tanımlı Üye İşyerleri Manuel
Gün Sonu Yapamazlar
1120 SANAL POS Geçersiz Security Code
1121 SANAL POS Transactiondevicesource Alanının Gönderilmesi
Zorunludur.
1122 SANAL POS Surcharge Tutarı 0 Dan Büyük Olmalı.
1123 SANAL POS Kayıt İade Durumda İade Edilmiş Bir Kayıt İptal Edilmeye Çalışılıyor
1124 SANAL POS Kayıt İptal Durumda İptal Edilmiş Bir Kayıt İade Edilmeye Çalışılıyor
1125 SANAL POS Terminal Bulunamadi
1126 SANAL POS Mpi İşlemindeki Veriler İle Uyumsuz
1127 SANAL POS 3Ds İşlemlerde Kart Bilgisi Veya Tutar Provizyon
Mesajında Yer Almamalıdır
1128 SANAL POS Mpitransactionıd Daha Önce Başka Bir İşlem İçin
Kullanılmış
1129 SANAL POS Express Ve 3D Secure İşlem Aynı Anda
Gönderilemez. Express ve 3D Secure işlem aynı anda gönderilemez.
1130 SANAL POS Expsign Değeri İletilen İşlem İçin Ecı Değeri
Geçerli Değil ExpSign değeri iletilen işlem için ECI değeri geçerli değil
1131 SANAL POS Customıtems Alanının Uzunluğu Hatalı CustomItems alanının uzunluğu hatalı
1132 SANAL POS İşleme Ait Kanal Bilgisine Göre, Expsign Değeri
Boş Olmalı İşleme ait kanal bilgisine göre, Expsign değeri boş olmalı
1133 SANAL POS Üye İş Yeri Yetkileri Arasında Ekstre Gönderme
Yetkisi Bulunmamaktadır.
Üye İş Yeri Yetkileri Arasında Ekstre Gönderme Yetkisi
Bulunmamaktadır.
1134 SANAL POS Custom Items Name Alanının Uzunluğu
Maksimum 100 Karakter Olmalı.
Custom Items Name Alanının Uzunluğu Maksimum 100
Karakter Olmalı
1135 SANAL POS Customıtem İçerisinde Tutar Hatalı CustomItem içerisinde Tutar Hatalı
1136 SANAL POS Customıtem İçerisinde Telefon Hatalı CustomItem içerisinde Telefon Hatalı
1137 SANAL POS Customıtem İçerisinde E-Posta Hatalı CustomItem içerisinde E-Posta Hatalı
1138 SANAL POS Customıtem İçerisinde Tip Hatalı CustomItem içerisinde Tip Hatalı
1139 SANAL POS Tanımlı Customıtem Hatalı Customtype Tanımlı CustomItem Hatalı CustomType
1140 SANAL POS Sıra Numarası Zorunlu. Sıra Numarası Zorunlu.
1141 SANAL POS Vade Süresi(Ay) Zorunlu. Vade Süresi(Ay) Zorunlu.
1142 SANAL POS Ödeme Sıklığı(Ay) Zorunlu. Ödeme Sıklığı(Ay) Zorunlu.
1143 SANAL POS Öteleme Süresi(Ay) Zorunlu. Öteleme Süresi(Ay) Zorunlu.
1144 SANAL POS Vade Ödeme Sıklığı Zorunlu. Vade Ödeme Sıklığı Zorunlu.
1145 SANAL POS Sgk Tutarı Küsüratlı Olamaz. Sgk Tutarı Küsüratlı Olamaz.
1146 SANAL POS Ödeme Planı Bulunamadı. Ödeme Planı Bulunamadı.
1147 SANAL POS Üye İş Yeri Yetkileri Arasında Gib Taksit Yetkisi
Bulunmamaktadır.
Üye İş Yeri Yetkileri Arasında Gib Taksit Yetkisi
Bulunmamaktadır.
1148 SANAL POS Üye İş Yeri Yetkileri Arasında Tekrarlı Tahsilat
Yetkisi Bulunmamaktadır.
Üye İş Yeri Yetkileri Arasında Tekrarlı Tahsilat Yetkisi
Bulunmamaktadır.
Gizli / Kişisel Veri
99
1152 SANAL POS Customıtem İçerisindeki Vftbankreferansno Bu
İşlem Tipi İçin Geçerli Değildir
CustomItem içerisindeki VFTBankReferansNo bu işlem
tipi için geçerli değildir
1153 SANAL POS Üye İş Yerinin Bkm Express İzni Yoktur. Üye iş yerinin BKM express izni yoktur.
2012 SANAL POS Batch Bulunamadı Batch Bulunamadı
2013 SANAL POS Terminal Bulunamadı. Terminal Bulunamadı.
2200 SANAL POS Is Yerinin İslem İçin Gerekli Hakki Yok.
2202 SANAL POS Islem İptal Edilemez. ( Batch Kapali )
2203 SANAL POS
Batch Kapama İsteginden Once Batch E Ait
Settlementqueue Daki İslemler Tamamlanmis
Olmali.
Batch Kapama isteginden once Batch e ait
SettlementQueue daki islemler tamamlanmis olmali.
4000 SANAL POS İşlem Tipi Hatalı İşlem Tipi Hatalı
4001 SANAL POS Bitiş Tarihi, Başlangıç Tarihinden Küçük Olamaz
Bitiş Tarihi, Başlangıç Tarihinden Küçük Olamaz
4002 SANAL POS Başlangıç Tarihi Zorunlu Başlangıç Tarihi Zorunlu
4003 SANAL POS Bitiş Tarihi Zorunlu Bitiş Tarihi Zorunlu
4004 SANAL POS Otorizasyon Kodu Zorunlu Otorizasyon Kodu Zorunlu
4005 SANAL POS En Az Bir Sorgu Kriteri Zorunlu En Az Bir Sorgu Kriteri Zorunlu
4006 SANAL POS En Az Bir Sorgu Kriteri Zorunlu En Az Bir Sorgu Kriteri Zorunlu
4007 SANAL POS Arama Kriteri Hatalı Arama Kriteri Hatalı
4008 SANAL POS Mutabakat Tarihi Zorunlu Mutabakat Tarihi Zorunlu
5000 SANAL POS En Az 1 Sayfa İçeriği Zorunlu En Az 1 Sayfa İçeriği Zorunlu
5001 SANAL POS Kimlik Doğrulama İşlemi Başarısız. İşyeri numarasının veya İşyeri şifresinin veya istekte
bulunulan url adresinin doğruluğundan emin olunuz.
5002 SANAL POS Is Yeri Aktif Degil.
5003 SANAL POS Sayfanın 1 Adet Tutar Tipinde İçeriği Olmalı Sayfanın 1 Adet Tutar Tipinde İçeriği Olmalı
5004 SANAL POS Sayfanın 1 Den Fazla Tutar Tipinde İçeriği Olamaz Sayfanın 1 den Fazla Tutar Tipinde İçeriği Olamaz
5005 SANAL POS Tutar Tipindeki Sayfa İçeriğinde Para Birimi
Zorunlu Tutar Tipindeki Sayfa İçeriğinde Para Birimi Zorunlu
5006 SANAL POS Sayfa İçerik Başlığı Zorunlu Sayfa İçerik Başlığı Zorunlu
5007 SANAL POS Sayfa İçeriği Hatalı Sayfa İçeriği Hatalı
5008 SANAL POS Bağış Sayfası İçerik Etiket Uzunluğu Hatalı
5009 SANAL POS Bağış Sayfası İçerik Etiket Değer Uzunluğu Hatalı
5010 SANAL POS Girilen Değer 200 Karakteri Geçmemeli
5011 SANAL POS Dikkate Alınacak Tutar Alanı Seçili İse, Para Birimi
De Seçilebilmelidir.
5012 SANAL POS Dikkate Alınacak Tutar Alanı Seçili İse, Dikkate
Alınacak Adet Alanı Seçilmemelidir.
5013 SANAL POS Dikkate Alınacak Tutar Alanı Seçili İse, Giriş
Zorunlu Olmalıdır.
5014 SANAL POS Dikkate Alınacak Adet Alanı Seçili İse, Para Birimi
Seçilmemelidir.
5015 SANAL POS Dikkate Alınacak Adet Alanı Seçili İse, Giriş
Zorunlu Olmalıdır.
5016 SANAL POS Değer Başlık Alanı Boş Bırakılamaz.
5017 SANAL POS Sayfanın 1 Den Fazla Adet Tipinde İçeriği Olamaz.
5018 SANAL POS İçerik Tipi Liste Yada Radyo Butonu Olan İçeriklere
İçerik Değeri Atanabilir
6000 SANAL POS Merchant Isactive Field Is Invalid
6001 SANAL POS Merchant Contactaddressline1 Length Is Invalid
6002 SANAL POS Merchant Contactaddressline2 Length Is Invalid
Gizli / Kişisel Veri
100
6003 SANAL POS Merchant Contactcitylength Is Invalid
6004 SANAL POS Merchant Contactemail Must Be Valid Email
6005 SANAL POS Merchant Contactemail Length Is Invalid
6006 SANAL POS Merchant Contactname Length Is Invalid
6007 SANAL POS Merchant Contactphone Length Is Invalid
6008 SANAL POS Merchant Hostmerchantıd Length Is Invalid
6009 SANAL POS Merchant Hostmerchantıd Is Empty
6010 SANAL POS Merchant Merchantname Length Is Invalid
6011 SANAL POS Merchant Merchantpassword Length Is Invalid
6012 SANAL POS Terminalınfo Hostterminalıd Is Invalid
6013 SANAL POS Terminalınfo Hostterminalıd Length Is Invalid
6014 SANAL POS Terminalınfo Hostterminalıd Is Empty
6015 SANAL POS Terminalınfo Terminalname Is Invalid
6016 SANAL POS Üye İşyeri Departmanı Hatalı Üye İşyeri Departmanı Hatalı
6017 SANAL POS Üye İşyeri Departman No Hatalı Üye İşyeri Departman No Hatalı
6018 SANAL POS Merchant Not Found
6019 SANAL POS Invalidrequest
6020 SANAL POS Birim Zaten Mevcut Birim Zaten Mevcut
6021 SANAL POS Birim Bulunamadı Birim Bulunamadı
6022 SANAL POS Transaction Type Exist In Merchant Permission
6023 SANAL POS Merchant Permission Exist In Merchant
6024 SANAL POS Currency Code Exist In Merchant Currency Codes
Permission
6025 SANAL POS Terminal Exist In Merchantterminals
6026 SANAL POS Terminal Can Not Be Found In Merchantterminals
6027 SANAL POS Invalid Login Attempti. Please Check Clientıd And
Clientpassword Fields
6028 SANAL POS Merchant İs Already Exist. You Should Try To
Update Method
6029 SANAL POS Üye İşyeri Eposta Hatalı Üye İşyeri Eposta Hatalı
6030 SANAL POS Üye İşyeri Web Adresi Hatalı Üye İşyeri Web Adresi Hatalı
6031 SANAL POS Otomatik Günsonu Zamanı Zorunlu Otomatik GünSonu Zamanı Zorunlu
6032 SANAL POS Otomatik Günsonu Zamanı Hatalı Otomatik GünSonu Zamanı Hatalı
6033 SANAL POS 3D Üye İşyeri Tipi Hatalı 3D Üye İşyeri Tipi Hatalı
6034 SANAL POS Parenthostmerchantıd Dolu Olmamalıdır. ParentHostMerchantId dolu olmamalıdır.
6035 SANAL POS Parenthostmerchantıd Dolu Olmalıdır. ParentHostMerchantId dolu olmalıdır.
6036 SANAL POS Yalnızca Ana Bayi,Alt Bayi İşlemlerini Görebilir. Yalnızca Ana Bayi,Alt Bayi İşlemlerini Görebilir.
6037 SANAL POS Ana Bayi Sistemde Tanımlı Değil. Ana Bayi Sistemde Tanımlı Değil.
6038 SANAL POS Alt Bayi Olan Bir İşyeri Başka Bir İşyerinin
Parenthostmerchantıd Si Olamaz.
Alt Bayi Olan Bir İşyeri Başka Bir İşyerinin
ParentHostMerchantId si Olamaz.
6039 SANAL POS Tckn Veya Vkn Alanları Dolu Olmalıdır. TCKN veya VKN alanları dolu olmalıdır.
6040 SANAL POS Aynı Tckn Ye Sahip Sadece Bir Üye İşyeri Olabilir. Aynı TCKN ye Sahip Sadece Bir Üye İşyeri Olabilir.
6041 SANAL POS Aynı Vkn Ye Sahip Sadece Bir Üye İşyeri Olabilir.
Aynı VKN ye Sahip Sadece Bir Üye İşyeri Olabilir.
6042 SANAL POS Tckn 11 Hane Olmalı. TCKN 11 Hane Olmalı.
6043 SANAL POS Tckn Numerik Olmalıdır. TCKN Numerik Olmalıdır.
6044 SANAL POS Vkn 10 Hane Olmalıdır. VKN 10 Hane Olmalıdır.
6045 SANAL POS Vkn Numerik Olmalıdır. VKN Numerik Olmalıdır.
Gizli / Kişisel Veri
101
6046 SANAL POS Tckn Ve Vkn 10 Veya 11 Hane Olmalıdır. TCKN ve VKN 10 veya 11 Hane olmalıdır.
6047 SANAL POS Tckn Ve Vkn Alanı Boş Olamaz. TCKN ve Vkn alanı boş olamaz.
6048 SANAL POS Vkn Ve Tckn Boş Olmalıdır. VKN ve TCKN Boş olmalıdır.
6049 SANAL POS Merchantıd Boş Olmalıdır. MerchantId Boş olmalıdır.
6050 SANAL POS Merchantıd Boş Olamaz. MerchantId boş olamaz.
6051 SANAL POS Parent Hostmerchant Ana Bayi Olmalıdır. Parent HostMerchant Ana Bayi Olmalıdır.
6052 SANAL POS Kullanıcının Onaylama Yetkisi Yok Kullanıcının Onaylama Yetkisi yok
6053 SANAL POS Üye İş Yerinin Vade Ve Ödeme Sıklığı Tekil
Olmalıdır. Üye iş yerinin Vade ve Ödeme Sıklığı Tekil Olmalıdır.
6054 SANAL POS Ödeme Sıklığı Nümerik Olmalı. Ödeme Sıklığı Nümerik Olmalı.
6055 SANAL POS Vade Süresi Nümerik Olmalı. Vade Süresi Nümerik Olmalı.
6056 SANAL POS Sıra Numarası Nümerik Olmalı. Sıra Numarası Nümerik Olmalı.
6057 SANAL POS Öteleme Süresi Nümerik Olmalı. Öteleme Süresi Nümerik Olmalı.
6058 SANAL POS Ödeme Sıklığı Zorunlu. Ödeme Sıklığı Zorunlu.
6059 SANAL POS Vade Süresi Zorunlu. Vade Süresi Zorunlu.
6060 SANAL POS Sıra Numarası Zorunlu. Sıra Numarası Zorunlu.
6061 SANAL POS Öteleme Süresi Zorunlu. Öteleme Süresi Zorunlu.
6063 SANAL POS Na Bayi, Alt Bayi İlişkisi Bulunmuyor Ana Bayi, Alt Bayi ilişkisi bulunmuyor
6064 SANAL POS Hostmerchantıd Veri Uzunluğu Geçersiz HostMerchantId veri uzunluğu geçersiz
6065 SANAL POS Hostsubmerchantıd Veri Uzunluğu Geçersiz HostSubMerchantId veri uzunluğu geçersiz
6066 SANAL POS Hostsubmerchantıd Must Not Be Empty. HostSubMerchantId Must Not Be Empty.
6067 SANAL POS Hostsubmerchantıd Değeri Boş Olmalı HostSubMerchantId Değeri Boş Olmalı
7777 SANAL POS Banka Tarafinda Gün Sonu Yapildigindan İslem
Gerçeklestirilemedi
9000 SANAL POS İşlem Yükleme Limit Aşıldı
9001 SANAL POS İşlem Yükleme Limit Aşıldı
9025 SANAL POS Hatalı İstek. Hatalı istek.
9026 SANAL POS İstek Bilgisi Hatalı. İstek bilgisi hatalı.
9027 SANAL POS Kullanıcı Adı Veya Şifre Yanlış. Kullanıcı adı veya şifre yanlış.
9028 SANAL POS Rol Bulunamadı. Rol bulunamadı.
9029 SANAL POS Rol Adı Boş Bırakılamaz. Rol adı boş bırakılamaz.
9030 SANAL POS Rol İçerisinde Tanımlı User Varken Silemezsiniz.
Rol içerisinde tanımlı user varken silemezsiniz.
9031 SANAL POS Kullanıcı Adı Veya Şifre Yanlış. Kullanıcı adı veya şifre yanlış.
9032 SANAL POS Kullanıcı Pasif Kullanıcı Pasif
9033 SANAL POS Kullanıcı Silinmiş Kullanıcı Silinmiş
9034 SANAL POS Üye İşyerinin Yönetici Kullanıcısı Bulunuyor. Üye işyerinin yönetici kullanıcısı bulunuyor.
9035 SANAL POS Üye İşyerine Ait Bir Yönetici Rolü Bulunuyor Üye işyerine ait bir yönetici rolü bulunuyor
9036 SANAL POS Bloklanmış Kullanıcı Bloklanmış Kullanıcı
9037 SANAL POS Kullanıcının Şifre Süresi Dolmuş Kullanıcının şifre süresi dolmuş
9038 SANAL POS Yeni Şifre Eski Şifreyle Aynı Olamaz Yeni Şifre Eski Şifreyle Aynı Olamaz
9039 SANAL POS Üye İşyeri Bulunamadı.
9041 SANAL POS Üye İşyerine Tanımlanabilecek Maksimum Web
Sitesi Sayısına Ulaştınız
Üye İşyerine Tanımlanabilecek Maksimum Web Sitesi
Sayısına Ulaştınız
9042 SANAL POS Üye İşyerinin 1 Adet Ekstre Tipinde E-Postası
Olmak Zorundadır
Üye İşyerinin 1 adet Ekstre Tipinde E-Postası Olmak
Zorundadır
9043 SANAL POS Üye İşyerine Tanımlanabilecek Maksimum EPosta Sayısına Ulaştınız
Üye İşyerine Tanımlanabilecek Maksimum E-Posta
Sayısına Ulaştınız
9044 SANAL POS Üye İşyerinin Sadece 1 Adet Ekstre Tipinde EPostası Olabilir
Üye İşyerinin sadece 1 Adet Ekstre Tipinde E-Postası
Olabilir
9045 SANAL POS Üye İşyeri E-Posta Adreslerinin E-Posta Tipi
Değiştirilemez
Üye İşyeri E-Posta Adreslerinin E-Posta Tipi
Değiştirilemez
9046 SANAL POS Ip Tipi Bulunamadı IP Tipi Bulunamadı
9047 SANAL POS Ip Hatalıdır IP Hatalıdır
Gizli / Kişisel Veri
102
9048 SANAL POS Ip Aralık Sonu Hatalıdır IP Aralık Sonu Hatalıdır
9049 SANAL POS Banka Bulunamadı Banka Bulunamadı
9050 SANAL POS Kart Sağlayıcı Alanı Zorunlu Kart Sağlayıcı alanı zorunlu
9051 SANAL POS Bin Boş Bırakılamaz Bin boş bırakılamaz
9052 SANAL POS Bin 6 Karakter Olmalı Bin 6 karakter olmalı
9053 SANAL POS Kart Tipi Boş Bırakılamaz Kart tipi boş bırakılamaz
9054 SANAL POS Bin Kaydı Zaten Mevcut Bin kaydı zaten mevcut
9055 SANAL POS Bankaya Ait Bin Bulunamıyor Bankaya ait bin bulunamıyor
9056 SANAL POS Dosya Boş Dosya boş
9057 SANAL POS Zaman 4 Aydan Büyük Olamaz Zaman 4 aydan büyük olamaz
9058 SANAL POS Tutar Hatalı Tutar Hatalı
9059 SANAL POS Para Birimi Hatalı Para Birimi Hatalı
9060 SANAL POS Kredi Kartı Numarası Hatalı Kredi Kartı Numarası Hatalı
9061 SANAL POS Cvv2 Hatalı Cvv2 Hatalı
9062 SANAL POS Brand Hatalı Brand hatalı
9063 SANAL POS Son Kullanma Tarihi Hatalı Son Kullanma Tarihi Hatalı
9064 SANAL POS Referans Transaction Numarası Hatalı Referans Transaction Numarası Hatalı
9065 SANAL POS Üye İşyeri Bulunamadı Üye işyeri bulunamadı
9066 SANAL POS Üye İşyeri Pasif Üye işyeri pasif
9067 SANAL POS Transaction Numarası Hatalı Transaction Numarası hatalı
9068 SANAL POS Sipariş Numarası Hatalı Sipariş Numarası Hatalı
9069 SANAL POS Sipariş Açıklaması Hatalı Sipariş Açıklaması Hatalı
9070 SANAL POS Ip Adresi Hatalı Ip adresi hatalı
9071 SANAL POS Kart Sahibi Hatalı Kart sahibi hatalı
9072 SANAL POS Referans İşlem İade Edilmiştir. Referans işlem iade edilmiştir.
9073 SANAL POS Ön Provizyon İptal Edilmiş Ön Provizyon İptal Edilmiş
9074 SANAL POS İşlem Teknik Sebeplerden Dolayı İptal Edilmiş. İşlem teknik sebeplerden dolayı iptal edilmiş.
9075 SANAL POS Referans İşlem Geçersiz Referans işlem geçersiz
9076 SANAL POS Puan İle Satışta Taksit Sayısı Gönderilemez Puan ile satışta taksit sayısı gönderilemez
9077 SANAL POS İşlem Zaten İade Edilmiş İşlem zaten iade edilmiş
9078 SANAL POS İşlem Zaten İptal Edilmiş İşlem zaten iptal edilmiş
9079 SANAL POS Geçersiz İade Tutarı Geçersiz iade tutarı
9080 SANAL POS Puan Tutarı Hatalı Puan Tutarı Hatalı
9081 SANAL POS Terminal Bulunamadı Terminal Bulunamadı
9083 SANAL POS Kullanıcı Ldap Bilgileri Hatalı Kullanıcı Ldap Bilgileri Hatalı
9084 SANAL POS Tek Kullanımlık Şifre Girişi Yapılmalıdır Tek Kullanımlık Şifre Girişi Yapılmalıdır
9085 SANAL POS Kullanıcı Ldap Sisteminde Bulunamadı Kullanıcı Ldap Sisteminde Bulunamadı
9086 SANAL POS Tek Kullanımlık Şifre Bulunamadı Tek Kullanımlık Şifre Bulunamadı
9087 SANAL POS Girilen Tek Kullanımlık Şifre Yanlış Girilen Tek Kullanımlık Şifre Yanlış
9088 SANAL POS Tek Kullanımlık Şifrenin Süresi Doldu Tek Kullanımlık Şifrenin Süresi Doldu
9089 SANAL POS Mesaj Servisi Hata Aldı Mesaj Servisi Hata Aldı
9090 SANAL POS Hatalı Kullanıcı E-Posta Hatalı Kullanıcı E-Posta
9091 SANAL POS Puan Kodu Zorunlu Puan Kodu Zorunlu
9092 SANAL POS Hatalı E-Posta Tipi Hatalı E-Posta Tipi
9093 SANAL POS Rol Pasif Yapılamaz. Bu Role Sahip Aktif
Kullanıcılar Bulunmaktadır.
Rol pasif yapılamaz. Bu role sahip aktif kullanıcılar
bulunmaktadır.
9094 SANAL POS Kullanıcı Rolü Aktif Değil Ya Da Silinmiş. Kullanıcı rolü aktif değil ya da silinmiş.
9096 SANAL POS Üye İşyeri Yönetici Rolü Eklemek İçin Üye İşyeri
Seçmelisiniz.
Üye işyeri yönetici rolü eklemek için üye işyeri
seçmelisiniz.
9097 SANAL POS Geçersiz Müşteri Bilgisi Geçersiz müşteri bilgisi
9098 SANAL POS Geçersiz İşlem Tarihi Geçersiz işlem tarihi
9099 SANAL POS Geçersiz İşlem Tipi Geçersiz işlem tipi
9100 SANAL POS Geçersiz Tekrar Sayısı Geçersiz Tekrar Sayısı
9101 SANAL POS Geçersiz Tekrarlama Aralığı Geçersiz Tekrarlama Aralığı
Gizli / Kişisel Veri
103
9102 SANAL POS Geçersiz Periyot Tipi Geçersiz periyot tipi
9103 SANAL POS Kaydın Statüsü Bu İşlem İçin Uygun Değil Kaydın Statüsü Bu işlem İçin Uygun Değil
9104 SANAL POS City Information Is Not Found. City Information Is Not Found.
9105 SANAL POS Town Information Is Not Found. Town Information Is Not Found.
9106 SANAL POS Customer Name Information Is Not Found. Customer Name Information Is Not Found.
9107 SANAL POS Customer Surname Information Is Not Found.
Customer Surname Information Is Not Found.
9108 SANAL POS Invalid Customer Number. Invalid Customer Number.
9109 SANAL POS Invalid Customer Email Information. Invalid Customer Email Information.
9110 SANAL POS Bu Müşteri Numarasına Sahip Zaten Bir Müşteri
Mevcut Bu müşteri numarasına sahip zaten bir müşteri mevcut
9111 SANAL POS Role Atanan Üye İşyeri Numarası İle Kullanıcıya
Atanan Numara Eşleşmiyor.
Role atanan üye işyeri numarası ile kullanıcıya atanan
numara eşleşmiyor.
9112 SANAL POS İşlem Numarası Zaten Mevcut İşlem Numarası Zaten Mevcut
9113 SANAL POS Tekrarlama Aralığı Değeri Boş Bırakılamaz.
9114 SANAL POS Pancode Zorunlu PanCode Zorunlu
9115 SANAL POS Pancode Zaten Mevcut PanCode Zaten Mevcut
9116 SANAL POS Müşteri Ad-Soyad Uzunlugu Hatalı Müşteri Ad-Soyad Uzunlugu Hatalı
9117 SANAL POS 3Dsecure Islemlerde Ecı Degeri Bos Olamaz 3DSecure Islemlerde ECI degeri bos olamaz
9118 SANAL POS Bu Batch Daha Önce Kapatılmıştır. Bu batch daha önce kapatılmıştır.
9121 SANAL POS Lütfen Geçerli Bir Ay Giriniz. Lütfen geçerli bir ay giriniz.
9121 SANAL POS Lütfen Geçerli Bir Yıl Giriniz. Lütfen geçerli bir yıl giriniz.
9198 SANAL POS Üye işyerinin 3D işlemlerde CAVV kontrol etme
yetkisi bulunmamaktadır.
3D Secure işlem provizyona iletilirken CAVV ve ECI
değerleri ile birlikte gönderilmelidir.
9200 SANAL POS Gib Taksit Yetkisi Sadece Gib Üye İşyerlerine
Verilebilir. Gib Taksit Yetkisi Sadece Gib Üye İşyerlerine Verilebilir.
9201 SANAL POS Girilen Üye İş Yeri Numarası Zaten Sisteme
Kayıtlıdır. Girilen üye iş yeri numarası zaten sisteme kayıtlıdır.
9553 SANAL POS Response Kodu Boş Response Kodu Boş
9578 SANAL POS Client Request Id Boş Client Request Id Boş
9579 SANAL POS Client Request Id Çok Uzun Client Request Id Çok Uzun
9580 SANAL POS Client Id Boş Client Id Boş
9581 SANAL POS Client Şifre Boş Client Şifre Boş
9582 SANAL POS Client Şifre Çok Uzun Client Şifre Çok Uzun
9583 SANAL POS Client Request Zamanı Boş Client Request Zamanı Boş
9587 SANAL POS Client Id Ya Da Şifre Hatalı Client Id ya da Şifre Hatalı
9595 SANAL POS Kayıt Zaten Mevcut Kayıt Zaten Mevcut
9601 SANAL POS Kayıt Bulunamadı Kayıt bulunamadı
9602 SANAL POS Yeni Kayıt Silinmiş Olamaz
9603 SANAL POS Kayıt Bilgisi Boş Olamaz
9612 SANAL POS Sayfa No En Az 1 Olabilir Sayfa No En Az 1 Olabilir
9614 SANAL POS Sayfadaki Kayıt Sayısı En Az 1 Olabilir Sayfadaki Kayıt Sayısı En Az 1 Olabilir
9615 SANAL POS En Fazla 50 Kayıt Listelenebilir En Fazla 50 Kayıt Listelenebilir
9993 SANAL POS Url Formatı Yanlış
9994 SANAL POS Doküman Başlığı Formatı Yanlış
9995 SANAL POS Dil Kodu Bilinmiyor Dil Kodu Bilinmiyor
9996 SANAL POS Geçersiz Doküman
9997 SANAL POS Url Bulunamadı
9998 SANAL POS Doküman Başlığı Bulunamadı
9999 SANAL POS Doküman Açıklaması Bulunamadı
Gizli / Kişisel Veri
104
MPİ (3D SECURE AŞAMASI) HATA KODLARI
Hata Kodu Hata Kaynağı Hata Kodu Açıklaması Hata Detayı
200 GET 7/24 Enrollment ve Pares status değerleri Y ise
başarılı.Aksi durumda doğrulama eksik.
20 GET 7/24
Kart 3D Secure programına dahil değil Kart hamili bankasının çağrı merkeziyle görüşmelidir.
33 GET 7/24
Kartın 3D Secure doğrulaması yapılamadı Kart hamili bankasının çağrı merkeziyle görüşmelidir.
400 GET 7/24
3D Şifre doğrulaması yapılamadı.
1001 GET 7/24 System Error Sistem Hatası
1002 GET 7/24 Success url format is invalid
1003 GET 7/24 Brand Id format is invalid
1004 GET 7/24 Device category format is invalid
1005 GET 7/24 Session info format is invalid
1006 GET 7/24 Xid format is invalid
1007 GET 7/24 Currency format is invalid
1008 GET 7/24 Purchase amount format is invalid
1009 GET 7/24 Expire date format is invalid
1010 GET 7/24 Pan format is invalid
1011 GET 7/24 Merchant acquirer bin password format is
invalid
1012 GET 7/24 Host merchant format is invalid
1013 GET 7/24 Bank Id format is invalid
1014 GET 7/24 Is recurring format is Invalid
1015 GET 7/24 Recurring frequency format is invalid
1016 GET 7/24 Recurring end date format is invalid
1017 GET 7/24 Installment count format is invalid
1018 GET 7/24 AcctId format is invalid
1019 GET 7/24 Protocol format is invalid
1020 GET 7/24 Acs url format is invalid
1021 GET 7/24 Error message format is invalid
1022 GET 7/24 Pares cavv format is invalid
1023 GET 7/24 Pares eci format is invalid
1024 GET 7/24 Pares cavv algorithm format is invalid
1025 GET 7/24 VeRes message Id does not match VeReq
message Id
1026 GET 7/24 Invalid fail url
1027 GET 7/24 VeRes status format is invalid
1028 GET 7/24 Veres version format is invalid
Gizli / Kişisel Veri
105
1029 GET 7/24 Pares version format is invalid
1030 GET 7/24 Pares acquirer bin format is invalid
1031 GET 7/24 Pares merchant Id format is invalid
1032 GET 7/24 Pares pan format is invalid
1033 GET 7/24 Pares time format is invalid
1034 GET 7/24 Pares date format is invalid
1035 GET 7/24 Pares Xid format is invalid
1036 GET 7/24 Pares status format is invalid
1037 GET 7/24 Pares IReq format is invalid
1038 GET 7/24 Pares vendor code format is invalid
1039 GET 7/24 Pares exponent format is invalid
1040 GET 7/24 Invalid Xid
2000 GET 7/24 Acquirer info is empty
2005 GET 7/24 Merchant cannot be found for this bank
Api şifresi ve istek url adresi kontrol edilmeli.
2006 GET 7/24 Merchant acquirer bin password is required
2009 GET 7/24 Brand not found
2010 GET 7/24 Card holder info is empty
2011 GET 7/24 Pan is empty
2012 GET 7/24 Device category must be between 0 and 2
2013 GET 7/24 Threed secure message can not be found
2014 GET 7/24 Pares message id does not match threed secure
message id
2015 GET 7/24 Signature verification failed
2017 GET 7/24 Acquire bin can not be found
2018 GET 7/24 Merchant acquirer bin password is wrong
2019 GET 7/24 Bank not found
2020 GET 7/24 Bank Id does not match merchant bank
2021 GET 7/24 Invalid currency code
2022 GET 7/24 Verify enrollment request Id cannot be empty
2023 GET 7/24 Verify enrollment request Id already exists for
this merchant
2024 GET 7/24 Acs certificate cannot be found in database
2025 GET 7/24 Certificate could not be found in certificate
store
Gizli / Kişisel Veri
106
2026 GET 7/24 Brand certificate not found in store
2027 GET 7/24 Invalid xml file
2028 GET 7/24 Threed secure message is in an invalid state
2029 GET 7/24 Invalid pan
2030 GET 7/24 Invalid expire date
2031 GET 7/24 Verification failed: No signature was found in
the document
2032 GET 7/24 Verification failed: More that one signature was
found for the document
2033 GET 7/24 Actual brand can not be found
2034 GET 7/24 Invalid amount
2035 GET 7/24 Invalid recurring information
2036 GET 7/24 Invalid recurring frequency
2037 GET 7/24 Invalid reccuring end date
2038 GET 7/24 Recurring end date must be earlier than expire
date
2039 GET 7/24 Invalid x509 certificate data
2040 GET 7/24 Invalid installment
2041 GET 7/24 Pares exponent value does not match Pareq
exponent
2042 GET 7/24 Pares acquirer bin value does not match Pareq
acqiurer bin
2043 GET 7/24 Pares Merchant Id does not match Pareq
Merchant Id
2044 GET 7/24 Pares Xid does not match Pareq Xid
2045 GET 7/24 Pares purchase amount does not match Pareq
purchase amount
2046 GET 7/24 Pares currency does not match pareq currency
2047 GET 7/24 VeRes Xsd validation error
2048 GET 7/24 PaRes Xsd validation exception
2049 GET 7/24 Invalid request
2050 GET 7/24 File is empty
2051 GET 7/24 Custom error
2052 GET 7/24 Bank brand bin already exists
2053 GET 7/24 Directory server communication error
DS iletişiminde hata oluştu.
2054 GET 7/24 ACS error occurred ACS hata bildirdi.
2055 GET 7/24 Encryption key not found
2056 GET 7/24 Hsm session not found
2057 GET 7/24 Max on us brand count is one
9595 GET 7/24 This record already exists
Gizli / Kişisel Veri
107
9601 GET 7/24 This record does not exist
3000 GET 7/24 Bank not found
3001 GET 7/24 Country not found
3002 GET 7/24 Invalid fail url
3003 GET 7/24 Host merchant number cannot be empty
3004 GET 7/24 Merchant brand acquirer bin cannot be empty
3005 GET 7/24 Merchant name cannot be empty
3006 GET 7/24 Merchant password cannot be empty
3007 GET 7/24 Invalid sucess url
3008 GET 7/24 Invalid merchant site url
3009 GET 7/24 Invalid acquirer bin length
3010 GET 7/24 Brand cannot be null
3011 GET 7/24 Invalid acquirer bin password length
3012 GET 7/24 Invalid host merchant number length
3013 GET 7/24 End date must be greater than start
3014 GET 7/24 Start date must be greater than DateTime
MinVal
3015 GET 7/24 End date must be greater than DateTime MinVal
3016 GET 7/24 Invalid search period
3017 GET 7/24 Bin cannot be empty
3018 GET 7/24 Card type cannot be empty
3019 GET 7/24 Bank brand bin not found
3020 GET 7/24 Bin length must be six
Gizli / Kişisel Veri
108
15. VPOS 7/24 SANAL POS ENTEGRASYON İPUÇLARI
Sanal POS uygulaması entegrasyonu yapan müşterilerimizin aşağıdaki hususlara dikkat etmesi önem arz
etmektedir.
❖ Bankamız Sanal POS uygulaması 3D Secure(MPI) ve Provizyon aşaması olmak üzere 2
aşamadan oluşmaktadır.
❖ 3D Secure entegrasyonu yapan müşterilerimizin finansal kayıp yaşamamak adına provizyon
aşaması entegrasyonunu da mutlaka yapmaları gerekmektedir.
❖ Yukarıdaki dokümanlar 3D Secure ödeme almak isteyen işyerleri için 3DS yöntemiyle
hazırlanmıştır.
❖ 3D Secure aşaması tamamlandıktan sonra provizyon aşaması xml mesaj oluştururken 3DS ile
ödeme almak isteyen müşterilerimiz ECI ve CAVV değerlerini isteğe bağlı olarak mesaja
ekleyebilirler. Bu iki parametrenin gönderimi opsiyonludur.
❖ 3DS ile ödeme almak isteyen müşterilerimiz; Kart No(pan), Kart Vadesi(expiry),
Tutar(CurrencyAmount), Para kodu ( CurrencyCode) bilgilerini provizyon mesajına eklememeleri
gerekmektedir.
❖ 3DS ödeme ile ödeme alınan tüm işlem tiplerinde, Kart No(pan), Kart Vadesi(expiry),
Tutar(CurrencyAmount), Para kodu ( CurrencyCode) bilgilerini provizyon mesajına
eklenmemelidir.
❖ Provizyon aşaması entegrasyonu tamamlanmayan müşteriler finansal kayıp yaşayabilirler. 3D
Secure doğrulamasından sonra provizyon aşaması mutlaka tamamlanmalıdır.
❖ “VAKIFBANK ÖRNEK SAYFALARI” klasöründe yer alan kodlar örnek mahiyetindedir. Üye
işyerlerimiz kendi eklemelerini (loglama, sonuçların gösterimi, isteklerin gönderilme şekli vb.) kendi
uygulama standartlarına göre, istedikleri şekilde yapabilirler.
❖ VPOS Request isteklerinizde kullanmanız gereken yöntem Pox Request yöntemidir. İsteklerimiz
için Pox Request yöntemini kullanmamızın temel sebebi, farklı işletim sistemlerinde koşan farklı
dillerde yazılmış uygulamaların, nerdeyse tamamının bu yöntemi desteklemesi sebebiyledir.
❖ Aşağıda sizlere sunacağımız çözüm önerilerimiz, Windows sunucularda koşan php 5 ve üzeri
kullanan, iis 7 ve üzeri sunucularda host edilen üye işyerleri için işe yarayacaktır. Ancak Unix
üzerinde, apache, server kullanan, php versiyonu farklı olan üye işyerleri için, daha farklı sıkıntılar
ortaya çıkabilir. Tüm üye işyerlerimiz için aynı çözüm önerileri işe yaramayacaktır. Farklı şekillerde
implemantasyon ihtiyaçları doğacaktır. Bu ve bunun gibi farklı durumlar için, üye işyeri
yazılımcılarının, googling yapması onları neticeye götürecektir.
Gizli / Kişisel Veri
109
Problem 1 : prmstr değişkeni içerisindeki xml datası sanal POS servisine gönderildiğinde,
Sanal POS sunucuları bu isteğe cevap vermemektedir
❖ İsteğiniz api servisi url adresine veriler boş bir şekilde post edildiğinde cevap alınmasına rağmen
veya veri dahil edilmeden get yönetimyle sayfa çağrıldığında sorunsuz bir şekilde "istek httpos
şeklinde yapılmalıdır" hatası alınmasına rağmen, prmstr değişkeni içerisindeki xml datası
gönderildiğinde servis cevap dönmüyorsa:
İlgili işlem sürecinizin kesilmesi PHP versiyonunuzun güncelleştirilmesi ile çözümlenecektir. Php
5.5.0 üzeri olmalı ve curl 5.5.19 ve üzeri versiyonda olmalıdır. Bunların yanıdında PHP geliştirme
için;
Üye işyeri sanalpos entegrasyonu yapıyorsa
curl_setopt($ch, CURLOPT_URL,$PostUrl);
curl_setopt($ch, CURLOPT_POST, 1);
curl_setopt($ch, CURLOPT_POSTFIELDS,$PosXML);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 5);
curl_setopt($ch, CURLOPT_TIMEOUT, 59);
// curl_setopt($ch,
curl.options,array("CURLOPT_SSLVERSION"=>"CURL_SSLVERSION_TLSv1_1")); //Dip Not: 2
// curl_setopt ($ch, CURLOPT_CAINFO, "c:/php/ext/cacert.pem"); //Dip Not: 3
curl_setopt($cHandler, CURLOPT_SSL_VERIFYHOST, false); //Dip Not: 4
curl_setopt($cHandler, CURLOPT_SSL_VERIFYPEER, false); //Dip Not: 4
3D Secure entegrasyonu yapıyorsa;
curl_setopt($ch, CURLOPT_URL,$PostUrl);
curl_setopt($ch, CURLOPT_POST, 1);
curl_setopt($ch, CURLOPT_POSTFIELDS,$PosXML);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, 5);
//curl_setopt ($ch, CURLOPT_CAINFO, "c:/wamp/www/cacert.pem");
curl_setopt($ch,curl.options,array("CURLOPT_SSLVERSION"=>"CURL_SSLVERSION_TLSv1_1")
);
curl_setopt($ch, CURLOPT_TIMEOUT, 59);
$result = curl_exec($ch);
curl_close($ch);
Şekilinde kullanılması genel manada yaşanan sıkıntıları engelleyecektir.
$result = curl_exec($ch);
// if($errno = curl_errno($ch)) { //Dip Not: 4
// $error_message = curl_strerror($errno);
// echo "cURL error ({$errno}):\n {$error_message}";
// }
curl_close($ch);
//phpinfo(); //Dip Not: 5
echo '<h1>Vpos Response</h1>';
echo '<textarea rows="15" cols="60">'.$result.'</textarea>';
Dip Not: 1
Https ile çalışan bir sisteme HTTP POST yöntemiyle istek göndermenin en kolay yolu curl
fonksiyonudur. curl ün php sunucunuzda çalışır durumda olması gerekir. bunun için, php.ini
dosyasında, extension=ext/php_curl.dll satırının başındaki ; ün kaldırılmış olduğunu teyit ediniz.
Dip Not: 2
TLS 1.1 in altındaki ssl versiyonlarının -güvenlik açıkları sebebiyle- yakın bir zamanda desteği
kapatılacaktır. Bu sebeple, SSL Versiyonu nun CURL_SSLVERSION_TLSv1_1 olarak iletilmesi
gerekmektedir. Ancak bu TLS 1.1 desteği PHP 5.5.0 da gelmiştir. PHP versiyonunuz 5.5.0 ın altında
ise, TLS 1.1 kullanamayacaksınız. Bu sebeple, geçici olarak, bu satırı kapatabilirsiniz.
Dip Not: 3
Https servislere erişim için, cacert.pem dosyasına ihtiyaç duyulmaktadır. bu dosyaya
http://curl.haxx.se/ca/cacert.pem adresinden erişebilirsiniz. Download edilen sertifika Sunucuda
Gizli / Kişisel Veri
110
herhangi bir dizine koyulur. Örnekte: c:/php/ext/ dizinine koyulduğu varsayılmıştır. php nin bu
sertifikayı istekte kullanabilmesi için iki alternatif vardır:
❖ Alternatif1: curl_exec fonksiyonu çağrılmadan önce, curl_setopt ($ch, CURLOPT_CAINFO,
"c:/php/ext/cacert.pem"); satırının eklenmesi
❖ Alternatif 2: php.ini dosyasında tüm isteklerde kullanılmak üzere, aşağıdaki düzenlenmenin
yapılması
❖ [curl]
❖ curl.cainfo = c:\php\ext\cacert.pem
Dip Not: 4
Herhangi bir sebeple, sunucudan halen yanıt alamadığınızı düşünüyorsanız, nerede sorun
olduğunu bulmak için, curl detaylı hatalarına, bu kod bloğu ile erişebilirsiniz. Ancak curl_strerror
fonksiyonu curl 5.5.19 nolu curl sürümü ile gelmiştir. Daha düşük bir curl versiyonu yüklü ise, bu
özelliği kullanmayınız, aksi takdirde undefined function hatası alırsınız.
Dip Not: 5
Halen İstek göndermekte veya cevap almakta başarısız oluyorsanız, phpinfo bilgisini bize iletiniz.
Aşağıdaki kontrolleri yapınız:
1) https://onlineodeme.vakifbank.com.tr:4443/VposService/v3/Vposreq.aspx adresini uygulamanın
kurulu olduğu sunucudaki tarayıcı ile açınız. 6001 cevabının alınıyor olması gerekiyor. Alınmıyor
ise, sunucunuzun güvenlik duvarı 4443 portundan dışarıya çıkışlara izin verilmiyorolabilir ya da
banka güvenlik duvarında, sizin denemiş olduğunuz ip ye erişim izni verilmemiştir. Bankaya
ilettiğiniz ip yi kontrol ediniz.
2) curl eklentisinin php tarafından kullanılabilir olduğunu kontrol ediniz (Dip Not 1)
3) curl versiyonunun ne olduğunu bize iletiniz.
Problem 2 : Kod bloğu hosttan post edilemiyor
Bağlantınızı kontrol edebilmek için
https://onlineodeme.vakifbank.com.tr:4443/VposService/v3/Vposreq.aspx adresini tarayıcıdan
açmaya çalışın. Hata mesajı veriyorsa erişim yok, aşağıdaki ekrandaki xml cevabı alıyorsanız
erişiminiz var demektir.
Bağlantılarınızda sorun yoksa aşağıdaki kontrolleri yapmalısınız.
1. Host tarafında Proxy tanımlaması olup olmadığı kontrol edilmelidir. Eğer Proxy tanımlaması varsa
kod bloğundaki curl metoduna aşağıdaki adımın eklenmesi yeterli olacaktır.
curl_setopt($ch,curl.options,array("CURLOPT_SSLVERSION"=>"CURL_SSLVERSION_TLSv1_1")
);
2. Proxy tanımı olmamasına veya Proxy tanımı olup kod bloğunda gerekli düzenleme yapılmasına
rağmen sorun devam ediyorsa hata firewall sisteminizle ilgilidir. 4443 nolu porta erişim izniniz olup
olmadığını kontrol etmeniz gerekmektedir.
3. Yukarıdaki iki duruma rağmen sorun devam ediyorsa sorun Sanal POS isteğinizin kendi
makinanızdan çıkamadığı olarak tespit ediyoruz. Sanal POS isteğinizin makinanızdan çıkmamasının
bilimum sebepleri olabilir. Bunlar:
❖ üye işyeri php versiyonu,
❖ php.nin konfigürasyon hataları,
❖ üye işyeri iis yapılandırmasının sorunlu olması,
❖ üye işyeri sunucusunda kullanılan herhangi bir 3. parti yazılım kaynaklı erişim önlemeleri
❖ üye işyeri sunucusunun dış sisteme çıkış problem
❖ üye işyeri sunucusunun internete bağlı olmaması vb.
❖ Bu tarz konulara ise teknik destek vermiyoruz. Yine de aşağıda belirttiğimiz maddelerin tarafınızca
kontrol edilmesi uygun olacaktır. Tecrübelerimize istinaden özellikle sarı ile işaretlediğimiz
kontrollerin yapılmasını öneriyoruz.
Gizli / Kişisel Veri
111
Curl ile HttpPost işlemi:
Https bağlantılara curl isteği yapılabilmesi için,
Php.ini dosyasına CURLOPT_CAINFO parametresinde sertifika path i verilmelidir.
[curl]
curl.cainfo = c:\php\ext\cacert.pem
Alternatif olarak, her curl isteğinde de bu değer gönderilebilir.
curl_setopt ($ch, CURLOPT_CAINFO, "c:/php/ext/cacert.pem");
Cacert.pem dosyasına şu bağlantıdan erişilebilir: http://curl.haxx.se/ca/cacert.pem
Php Curl extension ının kullanılabilmesi için öncelikle php.ini dosyasında php_curl.dll inin
extension olarak gösterilmesi gerekir.
extension=ext/php_curl.dll
Curl hatalarının detaylı olarak görüntülenebilmesi için curl_exec metodunun altına aşağıdaki şekilde
bir ekleme yapılabilir:
// curl http post işlemi sırasında bir hata olması durumunda bu alanda hata gösterilir.
if($errno = curl_errno($ch)) {
$error_message = curl_strerror($errno);
echo "cURL error ({$errno}):\n {$error_message}";
}
Satis.php sayfasını açmaya çalışırken, http 405.0 hatası alınırsa,
❖ İis handler mappings te
❖ http://dotnetstock.com/technical/http-error-405-0-method-not-allowed-invalid-method-http-verbwhen-posting-a-form-in-asp-net
Satis.php sayfasını açmaya çalışrken http 404.3 hatası alınırsa,
❖ İis te satis.php nin host edildiği uygulamanın handler mapping lerine *.php sayfaları için module
mapping eklemesinin yapılması gerekir
❖ Request path: *.php Module: FastCgiModule Executable: C:\[path to php install]\php-cgi.exe Name:
PHP_via_FastCGI
Satis.php sayfasını açmaya çalışırken curl hatası olarak aşağıdaki hata düşüyorsa:
❖ CURLE_SSL_CACERT (60) PEER CERTIFICATE CANNOT BE AUTHENTICATED WITH KNOWN
CA CERTIFICATES.
Cacert.pem sertifika path i php.ini dosyasında adreslenmelidir